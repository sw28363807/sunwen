!function(){"use strict";class t{constructor(){}static getSign(t){return t>=0?1:-1}static randomSign(){return Math.random()>.5?-1:1}static randomExt(t){let e=Math.random();return Math.floor(e*t)}static randomExt2(e,i){let s=i-e;return e+t.randomExt(s)}static randomRangePoint(e,i){let s=e.x+t.randomSign()*t.randomExt(i),a=e.y+t.randomSign()*t.randomExt(i);return new Laya.Point(s,a)}static calcRandomWeight(e,i){let s=i;if(!s){s=0;for(const t of e)s+=t.w}let a=t.randomExt(s),n={w:-1},r=null;for(const t of e){if(a>=n.w&&a<t.w+n.w){r=t;break}n.w+=t.w}return r}static map2Obj(t){let e=Object.create(null);for(let[i,s]of t)e[i]=s;return e}static obj2Map(t){let e=new Map;for(let i of Object.keys(t))e.set(i,t[i]);return e}static fadeout(t,e,i){t.alpha=1,Laya.Tween.to(t,{alpha:0},e,null,i,0)}static fadein(t,e,i){t.alpha=0,Laya.Tween.to(t,{alpha:1},e,null,i,0)}}class e{constructor(){this._templetMap=new Map,this._waitingMap=new Map}clear(){this._templetMap.clear(),this._waitMap.clear()}purge(){for(const[t,e]of this._templetMap)this._waitingMap.has(t)||0==e.referenceCount&&(e.destroy(),this._templetMap.delete(t))}static getInstance(){return e.instance?e.instance:e.instance=new e}load(t,e,i,s){let a=e?t+"_"+e:t+"_"+(i?1:0),n=this._templetMap.get(a);if(n){let t=this._waitingMap.get(a);t?null!=s&&t.push(s):null!=s&&s.runWith([n,i])}else{(n=new Laya.Templet).on(Laya.Event.COMPLETE,this,this.onTempletLoaded,[a,i]),n.on(Laya.Event.ERROR,this,this.onTempletLoadError,[a,i]),n.loadAni(t),this._templetMap.set(a,n);let e=new Array;this._waitingMap.set(a,e),null!=s&&e.push(s)}}onTempletLoaded(t,e){let i=this._templetMap.get(t),s=this._waitingMap.get(t);if(i&&s)for(const t of s)t.runWith(i,e);this._waitingMap.delete(t)}onTempletLoadError(t,e){let i=this._templetMap.get(t);i&&(i.destroy(),this._templetMap.delete(t)),this._waitingMap.delete(t)}}class i extends Laya.Skeleton{constructor(t=null){super(),this.skin=t,this.loop=!0,this.curAnim="",this.loadedHandlers=new Array,this.eventHandlers=new Array,this.completeHandlers=new Array}addLoadedHandler(t){this.loadedHandlers.push(t)}addCompleteHandler(t){this.completeHandlers.push(t)}addEventHandlers(t){this.eventHandlers.push(t)}loadAnim(t,i,s){i&&(this.skin=i),e.getInstance().load(t,this.skin,s,Laya.Handler.create(this,this.onLoadedExt))}playAnim(t,e=!0){this._inited&&this.play(t,!0),this.loop=e,this.curAnim=t}stopAnim(){this._inited&&this.stop(),this.loop=null,this.curAnim=null}getCurAnim(){return this.curAnim}onCompleteExt(){this.completeHandlers.forEach(function(t){t()}),this.loop&&this.play(this.curAnim,!1)}onEventExt(t){this.eventHandlers.forEach(function(e){e(t)})}onLoadedExt(t,e){this.init(t,e?1:0),this.skin?this.showSkinByName(this.skin):this.showSkinByIndex(1),this._inited=!0,this.curAnim&&this.play(this.curAnim,this.loop),this.loadedHandlers.forEach(function(t){t()})}}class s extends i{constructor(t){super(),this.catData=t,this.maskAnim=null,this.activeAI=!1,this.zOrder=50}get buildingId(){return this._buildingId}set buildingId(t){this._buildingId=t}get spaceId(){return this._spaceId}set spaceId(t){this._spaceId=t}getId(){return this.catData.getCatId()}getIsActive(){return this.activeAI}setIsActive(t){this.activeAI=t}getData(){return this.catData}onLoadedExt(t,e){super.onLoadedExt(t,e),this.initMaskAnim()}registerMouseDown(t,e){let i=new Laya.Panel;i.mouseThrough=!0,i.width=200,i.height=200,i.centerX=.5,i.y=-200,i.on(Laya.Event.MOUSE_DOWN,t,e),this.panel=i,this.addChild(i)}initMaskAnim(){let t=new i;this.maskAnim=t,t.y=-250,t.visible=!1;let e=this;t.addLoadedHandler(function(){e.maskAnimLoaded=!0,e.addChild(t)}),t.loadAnim("anim/UIdonghua.sk",null,0)}showMaskAnim(t,e,i){this.maskAnim&&(this.maskAnim.visible=!0),this.maskAnimLoaded&&this.maskAnim.play(t,!0),e?Laya.timer.once(e,this,this.hideMaskAnim,[i]):Laya.timer.clear(this,this.hideMaskAnim)}hideMaskAnim(t){this.maskAnimLoaded&&(this.maskAnim.stop(),this.maskAnim.visible=!1),null!=t&&t.run()}onDestroy(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}}class a{constructor(){this.eventDispatcher=new Laya.EventDispatcher}static getInstance(){return a.instance?a.instance:a.instance=new a}postEvent(t,e){this.eventDispatcher.event(t,e)}registEvent(t,e,i){this.removeEvent(t,e,i),this.eventDispatcher.on(t,e,i)}removeEvent(t,e,i){this.eventDispatcher.off(t,e,i,!1)}removeAllEvent(){this.eventDispatcher.offAll(eventName)}}let n=".txt";class r{constructor(){this._Protobuf=protobuf,this._configs=new Map,this.configClassMap=new Map,this._registClass()}static getInstance(){return r.instance?r.instance:r.instance=new r}_registClass(){this.configClassMap.set("Const",pattern.Const),this.configClassMap.set("ActionEvent",pattern.ActionEvent),this.configClassMap.set("Role",pattern.Role),this.configClassMap.set("BuildingBase",pattern.BuildingBase),this.configClassMap.set("Building",pattern.Building),this.configClassMap.set("Scene",pattern.Scene),this.configClassMap.set("Translate",pattern.Translate),this.configClassMap.set("Foods",pattern.Foods),this.configClassMap.set("FoodsList",pattern.FoodsList),this.configClassMap.set("Task",pattern.Task),this.configClassMap.set("TaskList",pattern.TaskList),this.configClassMap.set("FishingBaits",pattern.FishingBaits),this.configClassMap.set("FishingFishes",pattern.FishingFishes),this.configClassMap.set("FishingResult",pattern.FishingResult),this.configClassMap.set("FishingHitZone",pattern.FishingHitZone),this.configClassMap.set("NauticalFoods",pattern.NauticalFoods)}getConfigList(){let t=new Array;return this.configClassMap.forEach((e,i)=>{t.push(i)}),t}getConfigCount(){return this.configClassMap.size}loadConfig(t,e){if(this._configs.has(t))return void(e&&e.runWith(this._configs.get(t)));let i=this.configClassMap.get(t);i?Laya.loader.load("config/"+t+n,Laya.Handler.create(this,this._onBufferLoaded,[i,t,e]),null,Laya.Loader.BUFFER):console.debug("不存在的proto: "+t+"请在_registClass中注册!")}getConfig(t){return this._configs.has(t)?this._configs.get(t):(this.loadConfig(t),null)}getItemById(t,e){let i=this.getConfig(t);return i?i.get(e):null}_onBufferLoaded(t,e,i,s){let a=new Map,n=new Laya.Byte(s);for(n.endian=Laya.Byte.BIG_ENDIAN;n.pos<n.length;){let e=n.readInt16(),i=n.readUint8Array(n.pos,e),s=t.decode(i);a.set(s.Id,s)}this._configs.set(e,a),null!=i&&i.runWith(a)}}class o{constructor(t){this.config=r.getInstance().getItemById("Role",String(t)),this.catId=++o.catIdMax;let e=new Map;for(let t=0;t<this.config.FavorFoodsList.length;++t){let i=this.config.FavorFoodsList[t].split(":");e.set(String(i[1]),Number(i[0]))}this.foodWeighted=0,this.foodWeightedArray=new Array;let i=this;e.forEach(function(t,e){i.foodWeighted+=t,i.foodWeightedArray.push({c:e,w:Number(t)})}),i.foodWeightedArray.sort(function(t,e){return t.w<e.w}),this.sceneId=0,this.eventCount=0}setSceneId(t){this.sceneId=t}getSceneId(){return this.sceneId}setParams(t){this.params=t}getParams(){return this.params}randomFood(){let e=t.calcRandomWeight(this.foodWeightedArray,this.foodWeighted);return e?e.c:null}getCatId(){return this.catId}getConfigId(){return this.config.Id}getSource(){return this.config.Source}getSkin(){return this.config.Skin}getEventVisit(){return this.config.EventVisit}getEventTravel(){return this.config.EventTravel}getValueBase(){return this.config.ValueBase}getStarBase(){return this.config.StarBase}}o.catIdMax=0;class h extends o{setPos(t){this.x=t.x,this.y=t.y}getX(){return this.x}getY(){return this.y}pos(t,e){this.x=t,this.y=e}}class l extends o{setEvent(t){this.params?this.params.event=t:this.params={event:t}}}class c{}c.LoginSceneId=0,c.CoffeeSceneId=1,c.BeachSceneId=2,c.NauticalSceneId=3,c.FishingSceneId=20,c.TaskType={kDaily:2,kTrophy:1},c.TaskStatus={kRewarded:-1,kCompleted:1,kRunning:0},c.RedDotType={kTask:100,kCollect:200},c.RewardType={FISH:"FISH",STAR:"STAR"},c.FetchType={DIRECT:0,AD:1},c.ItemType={Currency:"Currency",NauticalFoods:"NauticalFoods",NauticalTools:"NauticalTools",FishingBaits:"FishingBaits"},c.SyncDelay=1e4,c.LetterBoxInterval=6e4,c.NetError=7770001;class d{constructor(){this.catMap=new Map}static getInstance(){return d.instance?d.instance:d.instance=new d}addCatData(t,e){let i=null;return e==c.CoffeeSceneId?i=new h(t):e==c.BeachSceneId&&(i=new l(t)),this.catMap.set(i.getCatId(),i),i.setSceneId(e),i}getCatCountBySceneId(t){let e=0;return this.catMap.forEach((i,s)=>{i.getSceneId()==t&&e++}),e}getCatsBySceneId(t){let e=new Array;return this.catMap.forEach((i,s)=>{i.getSceneId()==t&&e.push(i)}),e}removeCatData(t){this.catMap.delete(t)}getCatData(t){return this.catMap.get(t)}dump(){let t=new Array,e=new Array;return this.catMap.forEach((i,s)=>{1==i.getSceneId()?0==i.eventCount&&t.push({id:i.getConfigId(),params:i.getParams()}):2==i.getSceneId()&&0==i.eventCount&&e.push({id:i.getConfigId(),params:i.getParams()})}),{scene1:t,scene2:e}}clear(){this.catMap.clear()}}class g{constructor(){this.scene1BasePath=new Array,this.scene1ExtPath0=new Array,this.scene1ExtPath1=new Array,this.scene1ExtPath2=new Array,this.scene1ExtPath3=new Array}static getInstance(){return g.instance?g.instance:g.instance=new g}getZOrderPathPoint(){return 14}getStartPathPoint(){return this.scene1BasePath[0]}_dealPath(e){let i=t.randomExt(2),s=new Array;for(let a=0;a<i+1;++a){let i=t.randomExt(e.length);s.push(e[i])}return s}randomPath(t){let e=new Array;if(1==Number(t)){let t=this._dealPath(this.scene1ExtPath0),i=this._dealPath(this.scene1ExtPath1),s=this._dealPath(this.scene1ExtPath2),a=this._dealPath(this.scene1ExtPath3);for(let t=0;t<=8;++t)e.push(this.scene1BasePath[t]);t.forEach(t=>{e.push(t)});for(let t=9;t<=11;++t)e.push(this.scene1BasePath[t]);i.forEach(t=>{e.push(t)});for(let t=12;t<=16;++t)e.push(this.scene1BasePath[t]);s.forEach(t=>{e.push(t)});for(let t=17;t<=19;++t)e.push(this.scene1BasePath[t]);a.forEach(t=>{e.push(t)}),e.push(this.scene1BasePath[20])}return e}load(){Laya.loader.create("prefab/path/Scene1Path.prefab",Laya.Handler.create(this,function(t){let e=t.create();for(let t=0;t<100;++t){let i=e.getChildByName("b"+String(t));if(null==i)break;this.scene1BasePath.push({i:t,x:i.x,y:i.y})}for(let t=0;t<100;++t){let i=e.getChildByName("p0"+String(t));if(null==i)break;this.scene1ExtPath0.push({i:-1,x:i.x,y:i.y})}for(let t=0;t<100;++t){let i=e.getChildByName("p1"+String(t));if(null==i)break;this.scene1ExtPath1.push({i:-1,x:i.x,y:i.y})}for(let t=0;t<100;++t){let i=e.getChildByName("p2"+String(t));if(null==i)break;this.scene1ExtPath2.push({i:-1,x:i.x,y:i.y})}for(let t=0;t<100;++t){let i=e.getChildByName("p3"+String(t));if(null==i)break;this.scene1ExtPath3.push({i:-1,x:i.x,y:i.y})}}))}}class u{static getTimeNowOnServer(){return+new Date+this.serverTsModify}static updateServerTime(t){let e=this.getTimeNowOnServer()-t;Math.abs(e)<2e3?(this.averageDelay=Math.trunc((this.averageDelay*this.calcCount+e)/(this.calcCount+1)),this.calcCount++,this.calcCount>1e3&&(this.calcCount=100)):(this.averageDelay=50,this.calcCount=0),this.serverTsModify=t+this.averageDelay-+new Date}}u.serverTsModify=0,u.calcCount=0,u.averageDelay=50;class p{static init(){a.getInstance().registEvent("CUSTOMDATA_CAT_RESTORE",null,p.restore),a.getInstance().registEvent("REMOVE_CAT",null,p.removeCatData)}static addCatData(t,e,i){let s=d.getInstance().addCatData(t,e);return s.setParams(i),a.getInstance().postEvent("SIMULATOR_SEND_CMD",[e,"ADD_CAT",s.getCatId()]),s}static getCatsBySceneId(t){return d.getInstance().getCatsBySceneId(t)}static getCatCountBySceneId(t){return d.getInstance().getCatCountBySceneId(t)}static removeCatData(t,e){d.getInstance().removeCatData(t,e);a.getInstance().postEvent("SIMULATOR_SEND_CMD",[e,"REMOVE_CAT",t])}static getCatData(t){return d.getInstance().getCatData(t)}static restore(t,e,i){a.getInstance().postEvent("SIMULATOR_CREATE_SESSION",c.CoffeeSceneId),a.getInstance().postEvent("SIMULATOR_CREATE_SESSION",c.BeachSceneId),console.debug("restore cats",t),t&&t.scene1&&t.scene1.forEach(t=>{p.addCatData(t.id,c.CoffeeSceneId,t.params)});let s=u.getTimeNowOnServer();if(e&&e>0?a.getInstance().postEvent("SIMULATOR_SEND_CMD",[c.BeachSceneId,"SET_TIME",e]):a.getInstance().postEvent("SIMULATOR_SEND_CMD",[c.BeachSceneId,"SET_TIME",s]),t&&t.scene2&&t.scene1.forEach(t=>{p.addCatData(t.id,c.BeachSceneId,t.params)}),a.getInstance().postEvent("SIMULATOR_SEND_CMD",[c.BeachSceneId,"REFRESH_FOOD",i]),e&&e>0){let t=s-e;null!=i&&s>Math.max(i,e)+6e4&&(t=Math.max(i,e)+6e4-e),a.getInstance().postEvent("SIMULATOR_SIMULATE_SESSION",[c.BeachSceneId,t])}a.getInstance().postEvent("SIMULATOR_SEND_CMD",[c.BeachSceneId,"SET_TIME",s]),a.getInstance().postEvent("SIMULATOR_RUN_SESSION",c.CoffeeSceneId),a.getInstance().postEvent("SIMULATOR_RUN_SESSION",c.BeachSceneId)}}class I{constructor(){this.topUI=null,this.bottomUI=null,this.leftUI=null,this.arrowUI=null}static getInstance(){return I.instance?I.instance:I.instance=new I}showCommonUI(t,e){let i=Laya.Handler.create(this,function(){null!=this.topUI&&null!=this.bottomUI&&null!=this.leftUI&&null!=this.arrowUI&&null!=e&&e()},null,!1);1==t?(this.showTopUI(i),this.showBottomUI(i),this.showLeftUI(i),this.showArrowUI(t,i)):2==t?(this.showTopUI(i),this.showBottomUI(),this.showLeftUI(),this.showArrowUI(t,i)):(this.hideBottomUI(),this.hideArrowUI(),this.hideLeftUI())}showTopUI(t){null!=this.topUI?(this.topUI.visible=!0,null!=t&&t.run()):this.loadResource("topUI","prefab/ui/TopUI.prefab",t)}hideTopUI(){null!=this.topUI&&(this.topUI.visible=!1)}showBottomUI(t){null!=this.bottomUI?(this.bottomUI.visible=!0,null!=t&&t.run()):this.loadResource("bottomUI","prefab/ui/BottomUINew.prefab",t)}hideBottomUI(){null!=this.bottomUI&&(this.bottomUI.visible=!1)}showLeftUI(t){null!=this.leftUI?(this.leftUI.visible=!0,null!=t&&t.run()):this.loadResource("leftUI","prefab/ui/LeftUI.prefab",t)}hideLeftUI(){null!=this.leftUI&&(this.leftUI.visible=!1)}showArrowUI(t,e){null!=this.arrowUI?(this.arrowUI.visible=!0,a.getInstance().postEvent("switch_arrow_btn",null),null!=e&&e.run()):this.loadResource("arrowUI","prefab/ui/ArrowUI.prefab",e)}hideArrowUI(){null!=this.arrowUI&&(this.arrowUI.visible=!1)}loadResource(t,e,i){-1!=e.indexOf(".prefab")&&Laya.loader.create(e,Laya.Handler.create(this,function(e){if("topUI"==t)this.topUI=e.create(),this.topUI.x=0,this.topUI.y=0,Laya.stage.addChild(this.topUI);else if("bottomUI"==t)this.bottomUI=e.create(),this.bottomUI.x=0,this.bottomUI.y=2136,Laya.stage.addChild(this.bottomUI);else if("leftUI"==t)this.leftUI=e.create(),this.leftUI.x=0,this.leftUI.y=0,Laya.stage.addChild(this.leftUI);else{if(!(t="arrowUI"))return;this.arrowUI=e.create(),this.arrowUI.x=0,this.arrowUI.y=1141,Laya.stage.addChild(this.arrowUI)}null!=i&&i.run()}))}clear(){this.topUI=null,this.bottomUI=null,this.leftUI=null,this.arrowUI=null}}class m{constructor(){this.sceneMap=new Map}static getInstance(){return m.instance?m.instance:m.instance=new m}getSceneUrl(t){return 1==t?"scene/CoffeeScene.scene":2==t?"scene/BeachScene.scene":3==t?"scene/NauticalScene.scene":20==t?"scene/FishingScene.scene":0==t?"scene/Login.scene":void 0}getScene(t){return this.sceneMap.get(t)}getCurrentSceneId(){return this.currentSceneId}loadScene(t,e){let i=this.sceneMap.get(t);if(null!=i)return i.visible=!0,i.open(),void I.getInstance().showCommonUI(t,function(){null!=e&&e.runWith(i)});{let s=this.getSceneUrl(t);for(let a=0;a<Laya.Scene.unDestroyedScenes.length;++a){let n=Laya.Scene.unDestroyedScenes[a];if(s==n.url)return n.open(),n.visible=!0,void I.getInstance().showCommonUI(t,function(){null!=e&&e.runWith(i)})}Laya.Scene.open(s,!1,null,Laya.Handler.create(this,function(i){this.sceneMap.set(t,i),i.visible=!0,I.getInstance().showCommonUI(t,function(){null!=e&&e.runWith(i)})}))}}switchScene(t,e){this.currentSceneId!=t&&(this.currentSceneId=t,this.loadScene(t,e))}closeAllScene(){for(let t=Laya.Scene.unDestroyedScenes.length-1;t>=0;--t){Laya.Scene.unDestroyedScenes[t].destroy()}this.sceneMap.clear(),Laya.Scene.gc()}}class f{constructor(){this.buildingRoot=null,this.move=null,this.isBusy=!1,this.isFlip=!1,this.buildingExtInfoMgr=null}setBuildingExtInfoMgr(t){this.buildingExtInfoMgr=t}getBuildingExtInfoMgr(){return this.buildingExtInfoMgr}addToBuildingRoot(t){null!=this.buildingRoot&&this.buildingRoot.addChild(t)}setBuildingRoot(t){this.buildingRoot=t,null!=this.buildingRoot&&(this.buildingRoot.mouseThrough=!0)}getBuildingRoot(){return this.buildingRoot}setMove(t){this.move=t.split(":")}getMove(){return this.move}getBuildingRootWidth(){return this.buildingRoot.width}getBuildingRootHalfWidth(){return this.getBuildingRootWidth()/2}getBuildingRootHeight(){return this.buildingRoot.height}getBuildingRootHalfHeight(){return this.getBuildingRootHeight()/2}randomCatMove(){if(null!=this.move){let e=t.randomExt(this.move.length);return this.move[e]}return null}setIsFlip(t){this.isFlip=t}getIsFlip(){return this.isFlip}cleanBuildingExtInfo(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}}class y{constructor(){}setData(t,e,i,s,a){this._catConfigId=e,this._buildingId=i,this._reward=s,this._rewardType=a,this._id=t}restore(t){if(this._id=t.id,this._catConfigId=t.roleId,this._buildingId=t.buildingId,t.rewards&&t.rewards.rewards)for(const e of t.rewards.rewards)this._reward=e.amount,this._rewardType=e.id}get fetched(){return this._fetched}fetch(){this._fetched=!0}get id(){return this._id}get catConfigId(){return this._catConfigId}get buildingId(){return this._buildingId}get reward(){return[this._reward,this._rewardType]}dump(){return{id:this._id,name:"",buildingId:this._buildingId,rewards:{rewards:[{type:"Currency",id:this._rewardType,amount:this._reward}]},roleId:String(this._catConfigId)}}clear(){}}class _{constructor(){this._cacheFishMap=new Map,this._cacheStarMap=new Map,this._fishReward=0,this._starReward=0,this._scene2ExhaustTime=null,this._visitorRewardCache=new Array,this._visitorRewardStash=new Array,this._visitorGift=null}static getInstance(){return _.instance?_.instance:_.instance=new _}getCachedFish(t){let e=this._cacheFishMap.get(t);return e||0}addCachedFish(t,e){let i=this.getCachedFish(t);i+=e,this._cacheFishMap.set(t,i)}getCachedStar(t){let e=this._cacheStarMap.get(t);return e||0}addCachedStar(t,e){let i=this.getCachedStar(t);i+=e,this._cacheStarMap.set(t,i)}collectReward(t){let e=this.getCachedFish(t);this._cacheFishMap.delete(t),this._fishReward+=e;let i=this.getCachedStar(t);return this._cacheStarMap.delete(t),this._starReward+=i,[e,i]}dumpRewards(){return this._fishReward>0&&this._starReward>0?{rewards:[{type:"Currency",id:c.RewardType.FISH,amount:this._fishReward},{type:"Currency",id:c.RewardType.STAR,amount:this._starReward}]}:this._fishReward>0?{rewards:[{type:"Currency",id:c.RewardType.FISH,amount:this._fishReward}]}:this._starReward>0?{rewards:[{type:"Currency",id:c.RewardType.STAR,amount:this._starReward}]}:void 0}dropRewards(){this._fishReward=0,this._starReward=0}dumpCachedFish(){let t=new Array;for(const[e,i]of this._cacheFishMap)i>0&&t.push([e,i]);return t}restoreFish(t){if(this.clear(),t)for(const e of t)this._cacheFishMap.set(e[0],e[1])}getScene2ExhaustTime(){return this._scene2ExhaustTime?this._scene2ExhaustTime:0}addScene2Food(t,e){return!this._scene2ExhaustTime||this._scene2ExhaustTime<u.getTimeNowOnServer()+1e3*t?(this._scene2ExhaustTime=u.getTimeNowOnServer()+1e3*t,this._scene2ExhaustTime):null}restoreScene2ExhaustTime(t,e){this._scene2ExhaustTime=t}cacheVisitorReward(t,e,i,s,a){let n=new y,r="00000"+String(t);r=String(u.getTimeNowOnServer())+r.substr(r.length-4),n.setData(r,e,i,s,a),this._visitorRewardCache.push(n)}dumpVisitorRewardsCache(){for(const t of this._visitorRewardCache)this._visitorRewardStash.push(t.dump());return this._visitorRewardCache.length=0,this._visitorRewardStash}dropVisitorRewardsCache(){this._visitorRewardStash.length=0}updateVisitorGift(t){this._visitorGift||(this._visitorGift=new Array),this._visitorGift.length=0;for(const e of t){let t=new y;t.restore(e),this._visitorGift.push(t)}}clearVisitorGift(){this._visitorGift&&(this._visitorGift.length=0)}getVisitorGifts(){return this._visitorGift}clear(){this._cacheFishMap.clear(),this._fishReward=0,this._visitorRewardCache.length=0,this._visitorRewardStash.length=0,this._visitorGift=null}}class C{constructor(){this.cacheFish=0}static getInstance(){return C.instance?C.instance:C.instance=new C}getCapacity(){return this.capacity}setCapacity(t){this.capacity=t}getCacheFish(){return this.cacheFish}setCacheFish(t){this.cacheFish=t}setLastUpdateTime(t){this.lastUpdateMillis=t}getLastUpdateTime(){return this.lastUpdateMillis}clear(){this.cacheFish=0}}class S{constructor(t,e){this.configId=t,this.config=e||r.getInstance().getItemById("Role",String(t)),this.intimacy=0,this.visitTimes=0,this.adopted=!1,this.newCome=!0,this.redPointStatus=0}setIntimacy(t){this.intimacy=t,this.canAdopt()&&0==this.redPointStatus&&(this.setRedPointStatus(1),a.getInstance().postEvent("REDPOINT_REFRESH",["collect"]),a.getInstance().postEvent("UPDATE_PETS"))}getIntimacy(){return this.intimacy?this.intimacy:0}addIntimacy(t){this.intimacy+=t,this.canAdopt()&&0==this.redPointStatus&&(this.setRedPointStatus(1),a.getInstance().postEvent("REDPOINT_REFRESH",["collect"]),a.getInstance().postEvent("UPDATE_PETS"))}setVisitTimes(t){this.visitTimes=t}getVisitTimes(){return this.visitTimes}addVisitTimes(t){this.visitTimes+=t}setAdopted(t){this.adopted=!!t}getAdopted(){return this.adopted}setNewCome(t){this.newCome=!!t}getNewCome(){return this.newCome}getRedPointStatus(){return this.redPointStatus}setRedPointStatus(t){this.redPointStatus=t}needRedPoint(){return this.canAdopt()&&1==this.redPointStatus}getId(){return this.configId}getSource(){return this.config.Source}getName(){return this.config.Name}getDefaultAction(){return this.config.DefaultAction}getNormalPic(){return this.config.Icon}getGrayPic(){return this.config.IconShadow}getAdopLimit(){return this.adoptLimit||(this.adoptLimit=JSON.parse(this.config.AdoptLimit)),this.adoptLimit}canAdopt(){if(this.getAdopted())return!1;let t=this.getAdopLimit().Intimacy;return this.intimacy>=t}getIntimacyGrade(){let t=this.getIntimacy();for(const e in this.config.Intimacy){if(t<this.config.Intimacy[e])return e-1}return this.config.Intimacy.length-1}clear(){this.intimacy=0,this.visitTimes=0,this.adopted=!1}}class B{constructor(t){this.id=t,this.intimacyIncr=0,this.visitTimesIncr=0}addIntimacy(t){this.intimacyIncr+=t}addVisitTimes(t){this.visitTimesIncr+=t}dumpAndStash(){return this.stash&&(this.intimacyIncr+=this.stash.intimacyIncr?this.stash.intimacyIncr:0,this.visitTimesIncr+=this.stash.visitTimesIncr?this.stash.visitTimesIncr:0),this.stash=null,this.intimacyIncr>0||this.visitTimesIncr>0?(this.stash={intimacyIncr:this.intimacyIncr,visitTimesIncr:this.visitTimesIncr},this.stash):null}dropStash(){return this.stash=null,this.intimacyIncr>0||this.visitTimesIncr>0}clear(){this.intimacyIncr=0,this.visitTimesIncr=0}}class T{constructor(){this._petsMap=new Map,this._petRewards=new Map,this.initPets()}static getInstance(){return T.instance?T.instance:T.instance=new T}initPets(){let t=r.getInstance().getConfig("Role"),e=this._petsMap;for(const[i,s]of t){let t=new S(i,s);e.set(i,t)}}clear(){this._petsMap.forEach(t=>{t.clear()}),this._petRewards.clear()}getPet(t){return this._petsMap.get(t)}updatePet(t,e,i,s,a){let n=this.getPet(t);return!!n&&(e&&n.setIntimacy(e),i&&n.setVisitTimes(i),s&&n.setAdopted(s),void 0!==a&&null!=a&&n.setNewCome(a),n)}getPetReward(t){let e=this._petRewards.get(t);return e||(e=new B(t),this._petRewards.set(t,e)),e}addIntimacy(t,e){let i=this.getPet(t);return!(!i||null==e||0==e)&&(i.addIntimacy(e),this.getPetReward(t).addIntimacy(e),!0)}addVisitTimes(t,e){let i=this.getPet(t);return!(!i||null==e||0==e)&&(i.addVisitTimes(e),this.getPetReward(t).addVisitTimes(e),!0)}adoptPet(t){let e=this.getPet(t);return!!e&&(e.setAdopted(!0),!0)}dumpAndStashPetRewards(){let t=null;for(const[e,i]of this._petRewards){let s=i.dumpAndStash();s&&(t||(t={}),t[e]=s)}return t}dropPetRewardsStash(){for(const[t,e]of this._petRewards)e.dropStash()}clearPetRewards(){this._petRewards.clear()}needRedPoint(){let t=!1;for(const[e,i]of this._petsMap)t=t||i.needRedPoint();return t}clearAllRedPoint(){for(const[t,e]of this._petsMap)1==e.getRedPointStatus()&&e.setRedPointStatus(2)}}class L{static init(){}static scheduleUpdate(){Laya.timer.loop(c.SyncDelay,L,L.updateSceneInfo,[],!0,!1)}static forceUpdate(t){L.updateSceneInfo(t),L.scheduleUpdate()}static updateSceneInfo(t){let e=JSON.stringify({lastTime:u.getTimeNowOnServer(),scene2ExhaustTime:_.getInstance().getScene2ExhaustTime(),cats:d.getInstance().dump(),fish:_.getInstance().dumpCachedFish()}),i=_.getInstance().dumpRewards(),s=T.getInstance().dumpAndStashPetRewards(),n=_.getInstance().dumpVisitorRewardsCache();a.getInstance().postEvent("SERVICE_UPDATE_SCENE_INFO",[e,i,s,n,t])}static dropCache(){_.getInstance().dropRewards(),T.getInstance().dropPetRewardsStash(),_.getInstance().dropVisitorRewardsCache()}static getScene2ExhaustTime(){return _.getInstance().getScene2ExhaustTime()}static addScene2Food(t,e){let i=_.getInstance().addScene2Food(t,e);null!=i&&(a.getInstance().postEvent("SIMULATOR_SEND_CMD",[c.BeachSceneId,"REFRESH_FOOD",i]),a.getInstance().postEvent("REFRESH_FOOD",[i]))}static cacheVisitorReward(t,e,i,s,a){_.getInstance().cacheVisitorReward(t,e,i,s,a)}static findVisitorGift(t){a.getInstance().postEvent("SERVICE_FIND_VISITOR_GIFT",[t])}static getVisitorGiftAll(t,e){a.getInstance().postEvent("SERVICE_GET_VISITOR_GIFT_ALL",[t,e])}static getVisitorGiftSingle(t,e){a.getInstance().postEvent("SERVICE_GET_VISITOR_GIFT_SINGLE",[t,e])}static clearVisitorGift(){_.getInstance().clearVisitorGift()}static updateVisitorGift(t){_.getInstance().updateVisitorGift(t)}static getVisitorGifts(){return _.getInstance().getVisitorGifts()}static restoreCustomData(t){let e=t?JSON.parse(t):{},i=e.lastTime,s=e.scene2ExhaustTime;_.getInstance().restoreScene2ExhaustTime(s),_.getInstance().restoreFish(e.fish),a.getInstance().postEvent("UPDATE_DROPFISH_ALL",[]),a.getInstance().postEvent("CUSTOMDATA_CAT_RESTORE",[e.cats,i,s])}static getCachedFish(t){return _.getInstance().getCachedFish(t)}static getCachedStar(t){return _.getInstance().getCachedStar(t)}static addCachedFish(t,e){_.getInstance().addCachedFish(t,e)}static addCachedStar(t,e){_.getInstance().addCachedStar(t,e)}static collectReward(t){let e=_.getInstance().collectReward(t),i=e[0],s=e[1];i>0&&a.getInstance().postEvent("REFRESH_FISH",i),s>0&&a.getInstance().postEvent("REFRESH_STAR",s)}static getLetterBoxInfo(t){a.getInstance().postEvent("SERVICE_GET_LETTER_BOX_INFO",[t])}static fetchLetterBox(t){a.getInstance().postEvent("SERVICE_FETCH_LETTER_BOX",[t])}static updateLetterBox(t){if(null!=t.capacity&&C.getInstance().setCapacity(t.capacity),C.getInstance().setCacheFish(t.fishToReward||0),t.lastUpdateMillis){let e=t.lastUpdateMillis;0==e&&null==(e=C.getInstance().getLastUpdateTime())&&(e=u.getTimeNowOnServer()),C.getInstance().setLastUpdateTime(e)}a.getInstance().postEvent("UPDATE_LETTER_BOX")}static setCacheFish(t){C.getInstance().setCacheFish(t)}static getCacheFish(){return C.getInstance().getCacheFish()}static getCacheFishCapacity(){return C.getInstance().getCapacity()}static getLetterBoxNextUpdateInterval(){return(C.getInstance().getLastUpdateTime()||u.getTimeNowOnServer())+c.LetterBoxInterval-u.getTimeNowOnServer()}static clear(){Laya.timer.clear(null,L.updateSceneInfo)}}class w{constructor(t){this.buildingData=t,this.dropPoint=null,this.dropFish=null,this.buildingExtInfoArray=new Array}pushBuildingExtInfo(t){t.setBuildingExtInfoMgr(this),this.buildingExtInfoArray.push(t)}getBuildingExtInfo(t){return this.buildingExtInfoArray[t]}getBuildingExtInfoCount(){return this.buildingExtInfoArray.length}setDropFishPoint(e){this.dropPoint=e,null!=this.dropPoint&&this.dropPoint.on(Laya.Event.MOUSE_DOWN,this,function(){let e=this.dropFish;if(this.dropFish=null,e){L.collectReward(this.buildingData.getId()),e.onClick(),e.zOrder=9999999;let i=400+t.randomExt(400);Laya.Tween.to(e,{x:1550,y:73},i,null,Laya.Handler.create(this,function(){e.destroy()}),0)}})}setDropFish(t){this.dropFish=t}getDropFish(){return this.dropFish}getDropFishPoint(){return this.dropPoint}getDropFishPointPosition(){return new Laya.Point(this.dropPoint.width/2,this.dropPoint.height/2)}cleanBuildingExtInfoMgr(){for(let t=0;t<this.buildingExtInfoArray.length;++t)this.buildingExtInfoArray[t].cleanBuildingExtInfo();let t=this.getDropFish();t&&t.destroy()}}class v{constructor(){this.lastBaitId="",this.remainTimes=0,this.maxTimes=0,this.nextUpdateTs=0}getLastBaitId(){return this.lastBaitId}setLastBaitId(t){this.lastBaitId=t}getRemainTimes(){return this.remainTimes}setRemainTimes(t){this.remainTimes=t}addRemainTimes(t){this.remainTimes+=t,this.remainTimes>this.maxTimes&&(this.remainTimes,this.maxTimes)}getMaxTimes(){return this.maxTimes}setMaxTimes(t){this.maxTimes=t}getNextUpdateTime(){return this.nextUpdateTs}setNextUpdateTime(t){this.nextUpdateTs=t}}class E{constructor(t,e){this.configId=t,this.config=e||ConfigMgr.getInstance().getItemById("FishingFishes",String(t)),this.acquireTimes=0,this.newCome=!0,this.maxSize=0}getId(){return this.configId}getAcquireTimes(){return this.acquireTimes}setAcquireTimes(t){this.acquireTimes=t}getNewCome(){return this.newCome}setNewCome(t){this.newCome=t}getMaxSize(){return this.maxSize}setMaxSize(t){this.maxSize=t}getName(){return this.config.name}getSource(){return this.config.img}getGrayPic(){return this.config.imgShadow}}class b{constructor(){this.fishingBaseData=new v,this.fishingCollectDatas=new Map,this.initCollects()}static getInstance(){return b.instance?b.instance:b.instance=new b}initCollects(){let t=r.getInstance().getConfig("FishingFishes"),e=this.fishingCollectDatas;for(const[i,s]of t){let t=new E(i,s);e.set(i,t)}}getBaseData(){return this.fishingBaseData}getCollectById(t){return this.fishingCollectDatas.get(t)}updateCollectData(t,e,i,s){let a=this.getCollectById(t);return!!a&&(e&&a.setAcquireTimes(e),i&&a.setMaxSize(i),void 0!==s&&null!=s&&a.setNewCome(s),a)}clear(){this.fishingBaseData=new v,this.fishingCollectDatas.clear()}}class R{static init(){}static clear(){b.getInstance().clear()}static updateBaseData(t){let e=b.getInstance().getBaseData();e.setLastBaitId(t.lastBaitsId),e.setRemainTimes(t.remainTimes),e.setMaxTimes(t.maxTimes),e.setNextUpdateTime(t.nextUpdateTs)}static updateCollectData(t){Object.getOwnPropertyNames(t).forEach(e=>{let i=t[e],s=i.fishId,a=i.acquireTimes,n=i.maxSize,r=i.newCome;b.getInstance().updateCollectData(s,a,n,r)})}static getMaxTimes(){return b.getInstance().getBaseData().getMaxTimes()}static setMaxTimes(t){b.getInstance().getBaseData().setMaxTimes(t)}static getRemainTimes(){return b.getInstance().getBaseData().getRemainTimes()}static addRemainTimes(t){b.getInstance().getBaseData().addRemainTimes(t)}static getNextUpdateTs(){return b.getInstance().getBaseData().getNextUpdateTime()}static setNextUpdateTs(t){b.getInstance().getBaseData().setNextUpdateTime(t)}static getLastBaitId(){return b.getInstance().getBaseData().getLastBaitId()}static setLastBaitId(t){b.getInstance().getBaseData().setLastBaitId(t)}static getAndUpdateTimes(){let t=this.getNextUpdateTs();if(-1==t)return-1;if(u.getTimeNowOnServer()>=t){this.addRemainTimes(1);let t=1e3*r.getInstance().getItemById("Const","FishingTimeIncrease").Value;this.getRemainTimes()>=this.getMaxTimes()?this.setNextUpdateTs(-1):this.setNextUpdateTs(this.getNextUpdateTs()+t)}return this.getNextUpdateTs()}static getNextUpdateSecs(){let t=this.getAndUpdateTimes();return t<=0?-1:Math.ceil((t-u.getTimeNowOnServer())/1e3)}static getCollectById(t){return b.getInstance().getCollectById(t)}static updateServerCollectsInfo(t){a.getInstance().postEvent("SERVICE_GET_FISHING_COLLECTS",[t])}static updateServerBaseInfo(t){a.getInstance().postEvent("SERVICE_GET_FISHING_BASE_INFO",[t])}static finishGameToServer(t,e,i,s,n,r){a.getInstance().postEvent("SERVICE_FINISH_FISHING_GAME",[t,e,i,s,n,r])}}class x extends Laya.Tree{constructor(){super(),this.buildingData=null,this.anim=null,this.prefab=null,this.buildingExtInfoMgr=null,this.mouseThrough=!0,this.loaded=!1}isLoaded(){return this.loaded}getId(){return this.buildingData.getId()}setData(t){this.buildingData=t,this.buildingExtInfoMgr=new w(this.buildingData)}getData(){return this.buildingData}onDisable(){}cleanBuilding(){this.getBuildingExtInfoMgr().cleanBuildingExtInfoMgr()}getBuildingExtInfoMgr(){return this.buildingExtInfoMgr}judgeTouch(){let t=this.prefab.getChildByName("touch");null!=t&&t.on(Laya.Event.CLICK,this,this.onClick)}judgeAnim(){for(let t=0;t<5;++t){let e=this.prefab.getChildByName("spineAnim_"+String(t));if(null==e||null==e.text||""==e.text)break;{let s=e.text.split(":"),a=s[0],n=s[1],r=s[2],o=new i;o.addLoadedHandler(function(){o.x=e.x,o.y=e.y,o.zOrder=e.zOrder,o.play(n,!0)}),this.prefab.addChild(o),o.name="_spineAnim_"+String(t),o.loadAnim(a,r,0)}}}judgeDropPoint(){let t=this.prefab.getChildByName("dropPoint");t&&this.buildingExtInfoMgr.setDropFishPoint(t)}judgeBuildingRoot(){for(let t=0;t<5;++t){let e=new f,i=this.prefab.getChildByName("buildingRoot_"+String(t)),s=this.prefab.getChildByName("move_"+String(t)),a=1;if(null!=this.prefab.getChildByName("flip_"+String(t))&&(a=-1),null==i)break;e.setBuildingRoot(i),e.setMove(s.text),e.setIsFlip(a),this.buildingExtInfoMgr.pushBuildingExtInfo(e)}}loadResource(t,e){-1!=t.indexOf(".prefab")&&Laya.loader.create(t,Laya.Handler.create(this,function(t){this.prefab=t.create(),this.prefab.mouseThrough=!0,this.width=this.prefab.width,this.height=this.prefab.height,this.pivotX=this.prefab.width/2,this.pivotY=this.prefab.height/2,this.addChild(this.prefab),this.judgeDropPoint(),this.judgeTouch(),this.judgeAnim(),this.judgeBuildingRoot(),this.loaded=!0,null!=e&&e()}))}onClick(){let t=Laya.Handler.create(this,function(){m.getInstance().switchScene(c.FishingSceneId),a.getInstance().postEvent("NEXT_GUIDE")});R.updateServerBaseInfo(t)}}class k{constructor(){this._fish=0,this._star=0}update(t){this.updateFish(t.fish),this.updateStar(t.star)}updateFish(t){this._fish=Number(t)}updateStar(t){this._star=Number(t)}getStar(){return this._star}getFish(){return this._fish}}class A{constructor(){this._player=new k}static getInstance(){return A.instance?A.instance:A.instance=new A}getFish(){return this._player.getFish()}updateFish(t){this._player.updateFish(t)}getStar(){return this._player.getStar()}updateStar(t){this._player.updateStar(t)}clear(){this._player=new k}}class N{static init(){a.getInstance().registEvent("REFRESH_FISH",null,N.cumulateFish),a.getInstance().registEvent("REFRESH_STAR",null,N.cumulateStar),A.getInstance().clear()}static getFish(){return A.getInstance().getFish()}static cumulateFish(t,e){N.updateFish(N.getFish()+t)}static updateFish(t){A.getInstance().updateFish(t),a.getInstance().postEvent("UPDATE_FISH",t)}static getStar(){return A.getInstance().getStar()}static updateStar(t){A.getInstance().updateStar(t),a.getInstance().postEvent("UPDATE_STAR",t)}static cumulateStar(t){N.updateStar(N.getStar()+t)}static clear(){A.getInstance().clear()}}class D{constructor(){this.locationData=null,this._curBuildingId=null}setData(t){this.locationData=t}getId(){return this.locationData.Id}getX(){return Number(this.locationData.Pos[0])}getY(){return Number(this.locationData.Pos[1])}getSelectionX(){return Number(this.locationData.PosSelection[0])}getSelectionY(){return Number(this.locationData.PosSelection[1])}getOrder(){return Number(this.locationData.Order)}getBaseType(){return this.locationData.BaseType}getZOrder(){return Number(this.locationData.ZOrder)}getListName(){return this.locationData.ListName}getBaseSize(){return this.locationData.BaseSize}getPathPointIndex(){return Number(this.locationData.PathPointIndex)}getFixedBuildings(){return this.locationData.FixedBuildings}getBelongScene(){return this.locationData.BelongScene}checkBuildingAvailable(t){let e=this.getFixedBuildings(),i=!1;for(let s of e)if(s==t)return i=!0,!0;return i}setBuildingId(t){this._curBuildingId=t}getBuildingId(){return this._curBuildingId}checkIsHigher(t){if(1!=this.getBaseType())return!0;{let e=this.getFixedBuildings();if(!this._curBuildingId)return!0;for(let i of e){if(i==this._curBuildingId)return!0;if(i==t)return!1}}}clear(){this._curBuildingId=null}}class M{constructor(){this.locationMap=new Map,this.initLocations()}static getInstance(){return M.instance?M.instance:M.instance=new M}initLocations(){let t=r.getInstance().getConfig("BuildingBase"),e=this;t.forEach(function(t){let i=new D;i.setData(t),e.locationMap.set(Number(t.Id),i)})}clear(){this.locationMap.forEach(t=>{t.clear()})}getLocation(t){return this.locationMap.get(Number(t))}getLocationsByBaseType(t){let e=new Array;return this.locationMap.forEach(i=>{i.getBaseType()==t&&e.push(i)}),e.sort(function(t,e){return t.getOrder()-e.getOrder()}),e}}class F{constructor(t){this.catWeightedMap=new Map,this.catWeightedSum=0,this.config=r.getInstance().getItemById("Building",String(t)),this.config.CustomerInvite.forEach(t=>{if(""!=t){let e=t.split(":");this.catWeightedMap.set(String(e[0]),Number(e[1])),this.catWeightedSum+=Number(e[1])}}),this.locationData=null,this.spaceMap=new Map,this.attractCD=null}getCatWeightedSum(){return this.catWeightedSum}getId(){return this.config.Id}getSource(){return this.config.Source}getLocationData(){return this.locationData}setLocationData(t){if(this.locationData=t,null==t){for(const[t,e]of this.spaceMap)a.getInstance().postEvent("REMOVE_CAT",[catId,this.getBelongScene()]);this.spaceMap.clear(),this.attractCD=null}}getCatWeightedMap(){return this.catWeightedMap}getCatWeightedArray(){let t=new Array;return this.catWeightedMap.forEach((e,i)=>{t.push({w:e,n:i})}),t.sort(function(t,e){return t.w<e.w}),t}getBelongScene(){return this.config.BelongScene}getCost(){return this.config.Cost}getStar(){return this.config.StarReward}getLimit(){return this.config.Limit}getSpecialTpye(){return this.config.SpecialTpye}getSpecialValue(){return this.config.SpecialValue}getAutoIncome(){let t=0;return null!=this.config.AutoIncome&&(t=Number(this.config.AutoIncome)),t}canStay(){return null!=this.getLocationData()&&this.getCapacity()>0}getCapacity(){return this.config.PointCount}hasSpace(){for(let t=0;t<this.getCapacity();++t)if(!this.spaceMap.get(t))return!0;return!1}getSpaces(){let t=new Array;for(let e=0;e<this.getCapacity();++e)this.spaceMap.get(e)||t.push(e);return 0==t.length?null:t}occupy(t,e){if((t=Number(t))>=this.getCapacity()||t<0)return!1;let i=this.spaceMap.get(t);return i?i==e:(this.spaceMap.set(t,e),!0)}leave(t,e){if((t=Number(t))>=this.getCapacity()||t<0)return!1;let i=this.spaceMap.get(t);return!(!i||i!=e)&&(this.spaceMap.delete(t),!0)}isSupportAction(t){for(let e=0;e<this.config.SupportActions.length;++e){let i=this.config.SupportActions[e];if(null!=i&&""!=i&&t==i)return!0}return!1}}class P{constructor(){this.buildingMap=new Map,this.buildingMap.set(1,{weighted:0,list:new Array,catWeightedMap:new Map,autoIncome:0}),this.buildingMap.set(2,{weighted:0,list:new Array,catWeightedMap:new Map,autoIncome:0}),this.buildingMap.set(3,{weighted:0,list:new Array,catWeightedMap:new Map,autoIncome:0})}static getInstance(){return P.instance?P.instance:P.instance=new P}getSceneIdByBid(t){return r.getInstance().getItemById("Building",String(t)).BelongScene}getBuildingDataListInfo(t){return this.buildingMap.get(Number(t))}getBuildingDataByBid(t){let e=this.getBuildingDataListInfo(this.getSceneIdByBid(t));for(let i=0;i<e.list.length;++i){let s=e.list[i];if(String(s.getId())==String(t))return s}return null}removeBuildingDataByBid(t){let e=this.getBuildingDataListInfo(this.getSceneIdByBid(t));if(null!=e)for(let i=0;i<e.list.length;++i){let s=e.list[i];if(String(t)==s.getId()){let t=s.getCatWeightedMap(),a=s.getAutoIncome();return e.autoIncome=e.autoIncome-a,t.forEach(function(t,i){e.weighted=e.weighted-t;let s=e.catWeightedMap.get(i)-t;e.catWeightedMap.set(i,s)}),e.list.splice(i,1),s}}}addBuildingDataByBid(t){let e=this.getSceneIdByBid(t),i=this.getBuildingDataByBid(t);if(null!=i)return i;let s=(i=new F(String(t))).getCatWeightedMap(),a=i.getAutoIncome(),n=this.buildingMap.get(e);return n.autoIncome=n.autoIncome+a,s.forEach(function(t,e){if(n.weighted=n.weighted+t,n.catWeightedMap.get(e)){let i=n.catWeightedMap.get(e)+t;n.catWeightedMap.set(e,i)}else n.catWeightedMap.set(e,t)}),n.list.push(i),i}getCatWeightedMap(t){return this.buildingMap.get(t).catWeightedMap}getCatWeightedArray(t){let e=this.getCatWeightedMap(t),i=new Array;return e.forEach((t,e)=>{i.push({w:t,n:e})}),i.sort(function(t,e){return t.w<e.w}),i}getAutoIncomeSum(){let t=this.buildingMap.get(1),e=this.buildingMap.get(2);return Number(t.autoIncome)+Number(e.autoIncome)}clear(){}}class O{static init(){}static clear(){P.getInstance().clear(),M.getInstance().clear()}static addBuildingDataByBid(t){P.getInstance().addBuildingDataByBid(t)}static replaceBuildingData(t,e){let i=M.getInstance().getLocation(Number(e));if(null==i)return;let s=i.getBuildingId();if(null!=s){let t=P.getInstance().getBuildingDataByBid(s);a.getInstance().postEvent("REMOVE_BUILDING",t),O.removeBuildingDataByPid(e)}let n=P.getInstance().addBuildingDataByBid(t);if(null==n)return;let r=n.getLocationData();r&&(a.getInstance().postEvent("REMOVE_BUILDING",n),r.setBuildingId(null)),i.setBuildingId(t),n.setLocationData(i),a.getInstance().postEvent("ADD_BUILDING",n)}static getBuildingDataByPid(t){let e=M.getInstance().getLocation(Number(t));if(null==e)return null;let i=e.getBuildingId();return null==i?null:P.getInstance().getBuildingDataByBid(i)}static removeBuildingDataByPid(t){let e=M.getInstance().getLocation(Number(t)),i=e.getBuildingId();if(i){P.getInstance().getBuildingDataByBid(i).setLocationData(null),e.setBuildingId(null)}return null}static randomVisitBuilding(e,i){let s=new Array,a=new Array;if(P.getInstance().getBuildingDataListInfo(e).list.forEach(t=>{null!=t&&t.canStay()&&t.isSupportAction(i)&&(t.hasSpace()?s.push(t):a.push(t))}),0==s.length&&0==a.length)return null;if(s.length>0){let e=t.randomExt(s.length);return s[e]}if(a.length>0){let e=t.randomExt(a.length);return a[e]}}static getAvailableBuilding(t){let e=new Array;return P.getInstance().getBuildingDataListInfo(t).list.forEach(t=>{null!=t&&t.canStay()&&t.hasSpace()&&e.push(t)}),0==e.length?null:e}static getTotalSpaceCountInScene(t){let e=0;return P.getInstance().getBuildingDataListInfo(t).list.forEach(t=>{null!=t&&t.canStay()&&(e+=t.getCapacity())}),e}static getEmptySpaceCountInScene(t){let e=0;return P.getInstance().getBuildingDataListInfo(t).list.forEach(t=>{null!=t&&t.canStay()&&t.hasSpace()&&(e+=t.getSpaces().length)}),e}static getBuildingDataListInfo(t){return P.getInstance().getBuildingDataListInfo(t)}static getLocationsByBaseType(t){return M.getInstance().getLocationsByBaseType(t)}static hasBuildingDataByBid(t){let e=P.getInstance().getBuildingDataListInfo(P.getInstance().getSceneIdByBid(t));for(let i=0;i<e.list.length;++i){let s=e.list[i];if(String(t)==s.getId())return!0}return!1}static getBuildingDataByBid(t){return P.getInstance().getBuildingDataByBid(t)}static getCatWeightedArray(t){return P.getInstance().getCatWeightedArray(t)}static getAutoIncomeSum(){return P.getInstance().getAutoIncomeSum()}static checkBuildingUnlocked(t){if(O.hasBuildingDataByBid(t))return!0;let e=new F(t);return!(N.getStar()<e.getLimit())}static checkBuyBuildingAvailable(t){if(O.hasBuildingDataByBid(t))return!1;let e=new F(t);return!(N.getFish()<e.getCost())}static checkPlaceBuildingAvailable(t,e){if(!M.getInstance().getLocation(e).checkBuildingAvailable(t))return!1}static buyBuilding(t,e){if(O.checkBuyBuildingAvailable(t)){let i=function(){P.getInstance().addBuildingDataByBid(t),e&&e()};a.getInstance().postEvent("SERVICE_PUT_BUILDING",[t,"",Laya.Handler.create(null,i)])}}static buyBuildingAndPlace(t,e){if(O.checkBuyBuildingAvailable(t)){let i=function(){O.replaceBuildingData(t,e);let i=M.getInstance().getLocation(e);m.getInstance().switchScene(i.getBelongScene())};a.getInstance().postEvent("SERVICE_PUT_BUILDING",[t,e,Laya.Handler.create(null,i)])}}static placeBuilding(t,e){a.getInstance().postEvent("SERVICE_PUT_BUILDING",[t,e,Laya.Handler.create(null,function(){O.replaceBuildingData(t,e);let i=M.getInstance().getLocation(e);m.getInstance().switchScene(i.getBelongScene())})])}}class U extends Laya.Script{constructor(){super(),this.costText=null,this.letterTip=null}onEnable(){this.autoIncomeLimit=L.getCacheFishCapacity()||this.owner.getData().getSpecialValue(),this.letterTip=this.owner.prefab.getChildByName("letter_tip"),this.bg=this.owner.prefab.getChildByName("_spineAnim_1"),this.costText=this.letterTip.getChildByName("cost_text"),this.letterTip.on(Laya.Event.MOUSE_DOWN,this,this.onClickTip),a.getInstance().registEvent("UPDATE_LETTER_BOX",this,this.updateLetterBox),this.updateLetterBox()}onClickTip(){if(L.getCacheFish()>0){this.costText.text=String(0),this.letterTip.visible=!1,this.bg.visible=!1,L.fetchLetterBox();let t=L.getLetterBoxNextUpdateInterval()+500;for(;t<=5e3;)t+=c.LetterBoxInterval;Laya.timer.once(t,this,this.onAddCatTip,[],!0)}}onAddCatTip(){let t=O.getAutoIncomeSum(),e=L.getCacheFish(),i=Number(e)+Number(t);i>=this.autoIncomeLimit&&(i=this.autoIncomeLimit),L.setCacheFish(i),this.costText.text=String(i),this.letterTip.visible=!0,this.bg.visible=!0,L.getLetterBoxInfo();let s=L.getLetterBoxNextUpdateInterval()+500;for(;s<=5e3;)s+=c.LetterBoxInterval;Laya.timer.once(s,this,this.onAddCatTip,[],!0)}updateLetterBox(){let t=L.getCacheFish();this.costText.text=String(t),t>0?(this.letterTip.visible=!0,this.bg.visible=!0):(this.letterTip.visible=!1,this.bg.visible=!1);let e=L.getLetterBoxNextUpdateInterval()+500;for(;e<=0;)e+=c.LetterBoxInterval;Laya.timer.once(e,this,this.onAddCatTip,[],!0)}onDisable(){a.getInstance().removeEvent("UPDATE_LETTER_BOX",this,this.updateLetterBox),Laya.timer.clear(this,this.onAddCatTip)}}class G{constructor(){}static getInstance(){return G.instance?G.instance:G.instance=new G}createBuilding(e,i,s){var a=new x;return a.setData(e),a.loadResource(e.getSource(),function(){i.addChild(a);let n=e.getLocationData();a.pos(Number(n.getX()),Number(n.getY())),a.zOrder=Number(n.getZOrder());let r=e.getBelongScene();r==c.CoffeeSceneId||c.BeachSceneId,1==e.getSpecialTpye()&&a.addComponent(U),t.fadein(a,1e3,Laya.Handler.create(this,function(){null!=s&&s.runWith(a)}))}),a}static createBuildingBaseSelector(t,e){let i=new Laya.Sprite;return i.loadImage("facility/jianzhu"+(t.getBaseSize()+1)+".png"),i.mouseEnabled=!0,e.addChild(i),i.pos(Number(t.getSelectionX()),Number(t.getSelectionY())),i.zOrder=Number(t.getZOrder()),i}}class H{}class V{constructor(){this._catMap=new Map}static getInstance(){return V.instance?V.instance:V.instance=new V}addCat(t){this._catMap.set(t.getId(),t)}removeCat(t){this._catMap.delete(t)}getCat(t){return this._catMap.get(t)}idleCatsInBuilding(t){let e=new Array;for(const[i,s]of this._catMap)s.buildingId==t&&null==s.parent&&e.push(s);return e}clear(){}}class q extends Laya.Scene{constructor(){super(),this.sceneId=c.BeachSceneId,this.buildingMap=new Map}onAwake(){a.getInstance().registEvent("ADD_BUILDING",this,this.addBuilding),a.getInstance().registEvent("REMOVE_BUILDING",this,this.removeBuilding),a.getInstance().registEvent("PLACE_BUILDING",this,this.placeBuilding),this.root=this.getChildByName("root"),this.onBg(),this.onInitBuilding(),this.chooseLayer.on(Laya.Event.CLICK,this,this.onChooseLayerClick),H.PlacingBuilding&&this.placeBuilding(H.PlacingBuilding)}onBg(){this.bgAnim=new Laya.Skeleton,this.bgAnim.load("anim/skeleton.sk",Laya.Handler.create(this,function(){this.root.addChild(this.bgAnim),this.bgAnim.scaleX=1.2,this.bgAnim.scaleY=1.2,this.bgAnim.x=890,this.bgAnim.y=1075}))}onInitBuilding(){let t=O.getBuildingDataListInfo(this.sceneId).list;for(var e=0;e<t.length;++e){let i=t[e],s=i.getId();if(null==this.buildingMap.get(s)&&null!=i.getLocationData()){let t=G.getInstance().createBuilding(i,this.root,Laya.Handler.create(this,this._buildingLoaded));this.buildingMap.set(s,t)}}}_buildingLoaded(t){let e=t.getId(),i=V.getInstance().idleCatsInBuilding(e);for(const t of i){let i=t.spaceId;this.addCatToBuilding(t,e,i)}}addCatToBuilding(e,i,s){let a=this.getSpaceInfo(i,s);null!=a&&(a.addToBuildingRoot(e),e.x=a.getBuildingRootHalfWidth(),e.y=a.getBuildingRootHalfHeight(),e.scaleX=a.getIsFlip()*Math.abs(e.scaleX),t.fadein(e,500,Laya.Handler.create(this,function(){e.alpha=1,e.playAnim(a.randomCatMove())})))}onEnable(){Laya.SoundManager.playSound("sound/beachWave.mp3",0)}onDisable(){Laya.SoundManager.stopSound("sound/beachWave.mp3")}addBuilding(t){if(t.getBelongScene()==this.sceneId){let e=G.getInstance().createBuilding(t,this.root,Laya.Handler.create(this,this._buildingLoaded));this.buildingMap.set(t.getId(),e)}}removeBuilding(t){if(t.getBelongScene()==this.sceneId&&this.buildingMap.has(t.getId())){this.buildingMap.get(t.getId()).destroy(),this.buildingMap.delete(t.getId())}}placeBuilding(t){let e=O.getLocationsByBaseType(2),i=new Array;e.forEach(e=>{e.getBelongScene()==this.sceneId&&e.checkBuildingAvailable(t)&&i.push(e)}),i.length>0&&(H.PlacingBuilding=null,this.showLocationSelect(i,t))}getBuilding(t){for(var[e,i]of this.buildingMap)if(Number(e)==Number(t))return i.isLoaded()?i:null;return null}getSpaceInfo(t,e){let i=this.getBuilding(t);if(i)return i.getBuildingExtInfoMgr().getBuildingExtInfo(e)}showLocationSelect(t,e){this.chooseLayer.removeChildren(),this.chooseLayer.visible=!0,t.forEach(t=>{let i=G.createBuildingBaseSelector(t,this.chooseLayer);i.baseId=t.getId(),i.buildingId=e,i.on(Laya.Event.CLICK,this,this.onClick)})}onClick(t){let e=t.currentTarget.buildingId,i=t.currentTarget.baseId;O.placeBuilding(e,i),this.chooseLayer.visible=!1,Laya.SoundManager.playSound("sound/placeBuilding.mp3",1)}onChooseLayerClick(){this.chooseLayer.visible=!1}}class W{constructor(){}static get(t){return r.getInstance().getItemById("Const",String(t)).Value}static getArray(t){let e=W.get(t);return JSON.parse(e)}}let j=function(t,e,i){if(t%e==0)return String(t/e)+i;{let s=String(parseInt(10*t/e));return s.slice(0,-2)+"."+s.slice(-1)+i}};class K{static get(t){let e=r.getInstance().getItemById("Translate",t);if(null!=e)return e.zh_CH}static short(t){return t<1e3?String(t):t<=1e6?j(t,1e3,"k"):void 0}}class X extends Laya.Box{constructor(){super(),this.visible=!1}update(){let t=L.getScene2ExhaustTime(),e=u.getTimeNowOnServer(),i=Number(W.get("CatFoodKeepTime")),s=Number(W.get("CatFoodNotFull"));if(null==t||t<=e)"common/bowl_0.png"!=this._image.texture&&(this._image.texture="common/bowl_0.png"),this._progress.value=0;else{let a=(t-e)/1e3/i;this._progress.value=a,a>s?"common/bowl_2.png"!=this._image.texture&&(this._image.texture="common/bowl_2.png"):"common/bowl_1.png"!=this._image.texture&&(this._image.texture="common/bowl_1.png")}this._image.visible=!0,this._progress.visible=!0}onEnable(){this._image=this.getChildByName("image"),this._progress=this.getChildByName("bar"),0==this.visible&&(this.visible=!0,this._image.visible=!1,this._progress.visible=!1),Laya.timer.loop(1e3,this,this.update,null,!0,!0),a.getInstance().registEvent("REFRESH_FOOD",this,this.update),this.on(Laya.Event.CLICK,this,this.onClick)}onClick(){let t=L.getScene2ExhaustTime(),e=u.getTimeNowOnServer(),i=Number(W.get("CatFoodKeepTime")),s=Number(W.get("CatFoodNotFull"));if(t&&(t-e)/1e3/i>s)return void a.getInstance().postEvent("SHOW_TIPS",K.get("tid#catFoodFillFail"));L.addScene2Food(i);a.getInstance().postEvent("SHOW_TIPS",K.get("tid#catFoodFillSuccess")),this.update()}onDisable(){Laya.timer.clearAll(this),this.offAll(),a.getInstance().removeEvent("REFRESH_FOOD",this,this.update)}}class z extends Laya.Script{constructor(){super(),this.align=0}onStart(){if(this.owner)if(0==this.align){let t=Laya.Browser.height/2436,e=1827*t;this.owner.x=(Laya.Browser.width/2-e/2)/t}else 1==this.align&&this.owner.popup()}}class J extends Laya.Script{constructor(){super(),this.guideAnim=null,a.getInstance().registEvent("NEXT_GUIDE",this,this.onNextGuide)}onAwake(){this.guideAnim=new Laya.Skeleton,this.guideAnim.load("anim/maozhua.sk",Laya.Handler.create(this,function(){this.guideAnim.x=406,this.guideAnim.y=2051,this.guideAnim.scaleX=.6,this.guideAnim.scaleY=.6,this.guideAnim.play("2",!0)})),this.owner.getChildByName("root").addChild(this.guideAnim)}onEnable(){}onNextGuide(){this.guideAnim.stop(),this.guideAnim.visible=!1}onDisable(){}}class Z extends Laya.Script{constructor(){super(),this.alignment=1,this.offsetX=0}onEnable(){let t=Laya.Browser.height/2436;1==this.alignment?this.owner.x=Laya.Browser.width/t+this.offsetX:2==this.alignment&&(this.owner.x=this.offsetX)}onDisable(){}}class Y extends Laya.Script{constructor(){super()}onAwake(){this.owner.on(Laya.Event.CLICK,this,this.onClick)}onEnable(){}onClick(){L.findVisitorGift(Laya.Handler.create(this,this.openDialog))}openDialog(){Laya.Dialog.open("ui/visitorGiftPop.scene")}onDisable(){}}class Q{constructor(){this._catMap=new Map}static getInstance(){return Q.instance?Q.instance:Q.instance=new Q}addCat(t){this._catMap.set(t.getId(),t)}removeCat(t){this._catMap.delete(t)}getCat(t){return this._catMap.get(t)}allCatsInScene(t){let e=new Array;for(const[i,s]of this._catMap)s.parent==t&&e.push(s);return e}clear(){}}class $ extends Laya.Sprite{constructor(t){super(),this._buildingId=t,this.prefab=null,this.countText=null,this.dropFishCount=0}onEnable(){Laya.loader.create("prefab/component/drop_fish.prefab",Laya.Handler.create(this,function(e){this.prefab=e.create(),this.width=this.prefab.width,this.height=this.prefab.height,this.pivotX=this.prefab.width/2,this.pivotY=this.prefab.height/2,this.addChild(this.prefab),this.countText=this.prefab.getChildByName("coutText"),t.fadein(this,3e3),this.countText.visible=this.dropFishCount>0,this.countText.text="+"+String(this.dropFishCount)}))}onClick(){this.countText&&(this.countText.visible=!1,Laya.SoundManager.playSound("sound/clickReward.mp3",1))}addDropFish(t){this.setDropFish(this.dropFishCount+t)}setDropFish(t){this.dropFishCount=t,this.countText&&(this.countText.visible=t>0,this.countText.text="+"+String(this.dropFishCount)),this.visible=t>0}onDisable(){}}class tt extends Laya.Scene{constructor(){super(),this.sceneId=c.CoffeeSceneId,this.buildingMap=new Map}onAwake(){a.getInstance().registEvent("ADD_BUILDING",this,this.addBuilding),a.getInstance().registEvent("REMOVE_BUILDING",this,this.removeBuilding),a.getInstance().registEvent("UPDATE_DROPFISH",this,this.updateDropFish),a.getInstance().registEvent("UPDATE_DROPFISH_ALL",this,this.updateDropFishAll)}onInitBuilding(){let t=O.getBuildingDataListInfo(this.sceneId).list;for(var e=0;e<t.length;++e){let i=t[e],s=i.getId();if(null==this.buildingMap.get(s)&&null!=i.getLocationData()){let t=G.getInstance().createBuilding(i,this.root,Laya.Handler.create(this,this._updateDropFish));this.buildingMap.set(s,t)}}}onEnable(){Laya.SoundManager.playMusic("sound/bgm1.mp3",0),this.root=this.getChildByName("root"),this.onInitBuilding(),Laya.timer.loop(500,this,this.sortCatZOrder)}updateDropFish(t,e){let i=this.getBuilding(t);null!=i&&this._updateDropFish(i)}_updateDropFish(t){let e=t.getId(),i=L.getCachedFish(e),s=t.getBuildingExtInfoMgr();if(null==s.getDropFishPoint());else{let a=s.getDropFish();if(a)a.setDropFish(i);else{let a=new $(e);s.setDropFish(a),a.setDropFish(i);let n=this,r=s.getDropFishPointPosition(),o=new Laya.Point(r.x,r.y);s.getDropFishPoint().localToGlobal(o,!1,n.root),n.root.addChild(a),a.x=o.x,a.y=o.y,a.zOrder=t.zOrder}}}updateDropFishAll(){for(var[t,e]of this.buildingMap)this._updateDropFish(e)}sortCatZOrder(){let t=new Array,e=new Array;for(const i of Q.getInstance().allCatsInScene(this.root))i.zOrder>=999999?t.push(i):e.push(i);function sortByOrder(t,e){return t.y>=e.y}t.sort(sortByOrder),e.sort(sortByOrder);for(let e=0;e<t.length;++e)t[e].zOrder=999999+e;for(let t=0;t<e.length;++t)e[t].zOrder=50+t}addBuilding(t){if(t.getBelongScene()==this.sceneId){let e=G.getInstance().createBuilding(t,this.root,Laya.Handler.create(this,this._updateDropFish));this.buildingMap.set(t.getId(),e)}}removeBuilding(t){if(t.getBelongScene()==this.sceneId&&this.buildingMap.has(t.getId())){let e=this.buildingMap.get(t.getId());e.cleanBuilding(),this.buildingMap.delete(t.getId()),e.destroy()}}getBuilding(t){for(var[e,i]of this.buildingMap)if(Number(e)==Number(t))return i.isLoaded()?i:null;return null}getSpaceInfo(t,e){let i=this.getBuilding(t);if(i)return i.getBuildingExtInfoMgr().getBuildingExtInfo(e)}}class et extends Laya.Script{constructor(){super(),this.maxCount=Number(W.get("CatInviteClickTimes")),this.count=this.maxCount}onAwake(){this.progressBar=this.owner.getChildByName("bar")}onEnable(){this.progressBar.value=1-this.count/this.maxCount,this.owner.on(Laya.Event.MOUSE_DOWN,this,function(){p.getCatCountBySceneId(c.CoffeeSceneId)>=15?a.getInstance().postEvent("SHOW_TIPS","场景内猫的数量达到上限15只"):(this.count--,0==this.count&&(this.count=this.maxCount,a.getInstance().postEvent("FORCE_ATTRACT_COFFEE_CAT")),this.progressBar.value=1-this.count/this.maxCount,Laya.SoundManager.playSound("sound/clickSound.mp3",1))})}onDisable(){}}class it extends Laya.Scene{constructor(){super(),this.remainTimes=0,this.maxTimes=0,this.nextUpdateSecs=0,this.tickTimer=new Laya.Timer,this.refresh_time_ticker=new Laya.Timer}onAwake(){this.root=this.getChildByName("root"),this.startBtn=this.root.getChildByName("start_btn"),this.endBtn=this.root.getChildByName("end_btn"),this.fishVernier=this.root.getChildByName("fish_vernier"),this.closeBtn=this.root.getChildByName("close"),this.collectBtn=this.root.getChildByName("collect"),this.baitBtn=this.root.getChildByName("baits"),this.timesFont=this.root.getChildByName("times_show"),this.tips=this.root.getChildByName("tips"),this.slider0=this.root.getChildByName("slider_0"),this.slider1=this.root.getChildByName("slider_1"),this.slider2=this.root.getChildByName("slider_2"),this.leftLimit=this.root.getChildByName("left_limit").x,this.rightLimit=this.root.getChildByName("right_limit").x,this.targetX=0,this.speed=0,this.velocity=-3.001,this.initSpeed=40,this.gameState=1,this.initDefaultBaitId(),this.initLimit(),this.initAnims(),this.resetGame(),this.tickTimer.loop(30,this,this.onUpdate),a.getInstance().registEvent("FISHING_BAITS_SELECTED_CHANGE",this,this.initFishingSlideData)}initDefaultBaitId(){if(""==R.getLastBaitId()){let t=N.getStar(),e=r.getInstance().getConfig("FishingBaits");for(const[i,s]of e)if(t>=s.StarLimit){R.setLastBaitId(i);break}}}onOpened(){this.startBtn.on(Laya.Event.CLICK,this,this.onClickStartGame),this.endBtn.on(Laya.Event.CLICK,this,this.onClickEndGame),this.closeBtn.on(Laya.Event.CLICK,this,this.onCloseBtn),this.collectBtn.on(Laya.Event.CLICK,this,this.onShowCollect),this.baitBtn.on(Laya.Event.CLICK,this,this.onShowBaitsSelect),this.remainTimes=R.getRemainTimes(),this.maxTimes=R.getMaxTimes(),this.nextUpdateSecs=R.getNextUpdateSecs(),this.timesFont.value=this.remainTimes.toString()+"/"+this.maxTimes.toString(),this.remainTimes>=this.maxTimes||this.nextUpdateSecs<0?(this.tips.visible=!1,this.refresh_time_ticker.clear(this,this.tickerRefresh)):(this.showTimeTips(),this.refresh_time_ticker.loop(1e3,this,this.tickerRefresh)),this.initFishingSlideData()}tickerRefresh(){this.nextUpdateSecs=R.getNextUpdateSecs(),this.remainTimes=R.getRemainTimes(),this.maxTimes=R.getMaxTimes(),this.nextUpdateSecs>0&&this.maxTimes>this.remainTimes?this.showTimeTips():(this.tips.visible=!1,this.refresh_time_ticker.clear(this,this.tickerRefresh)),this.timesFont.value=this.remainTimes.toString()+"/"+this.maxTimes.toString()}showTimeTips(){this.tips.visible=!0;let t=parseInt(this.nextUpdateSecs/60),e=this.nextUpdateSecs%60;this.tips.text=t>0?"下次免费: "+t.toString()+"分"+e.toString()+"秒":"下次免费: "+e.toString()+"秒"}initAnims(){this.animCat=new Laya.Skeleton,this.root.addChild(this.animCat),this.animCat.load("anim/diaoyu.sk",Laya.Handler.create(this,function(){this.animCat.x=600,this.animCat.y=900,this.animCat.stop()}));let t=new Laya.Skeleton;t.load("anim/diaoyuchangjing.sk",Laya.Handler.create(this,function(){t.play("changjing",!0),t.x=600,t.y=1200})),this.root.addChild(t)}initFishingSlideData(t){this.dataMap?this.dataMap.clear():this.dataMap=new Map;let e=t||R.getLastBaitId(),i=r.getInstance().getItemById("FishingBaits",e);this.speed=10*i.speed;let s=r.getInstance().getItemById("FishingHitZone",i.hitZoneID),a=this.rightLimit-this.leftLimit,n=this.leftLimit+a/2;s.HitZone.length>=2?(this.slider2.x=this.leftLimit+s.HitZone[1]*a/2,this.slider2.width=(1-s.HitZone[1])*a):this.slider2.width=0,s.HitZone.length>=3?(this.slider1.x=this.leftLimit+s.HitZone[2]*a/2,this.slider1.width=(1-s.HitZone[2])*a):this.slider1.width=0,s.HitZone.length>=4?(this.slider0.x=this.leftLimit+s.HitZone[3]*a/2,this.slider0.width=(1-s.HitZone[3])*a):this.slider0.width=0;let o=0==this.slider2.width?n:this.slider2.x,h=0==this.slider2.width?n:this.slider2.x+this.slider2.width,l=0==this.slider1.width?n:this.slider1.x,c=0==this.slider1.width?n:this.slider1.x+this.slider1.width,d=0==this.slider0.width?n:this.slider0.x,g=0==this.slider0.width?n:this.slider0.x+this.slider0.width,u=new Array;u.push({min:d,max:g}),this.dataMap.set(1,u);let p=new Array;p.push({min:l,max:d}),p.push({min:g,max:c}),this.dataMap.set(2,p);let I=new Array;I.push({min:o,max:l}),I.push({min:c,max:h}),this.dataMap.set(3,I);let m=new Array;m.push({min:h,max:99999}),m.push({min:-99999,max:o}),this.dataMap.set(4,m)}getResult(){let t=0,e=this.fishVernier.x;return this.dataMap.forEach((i,s)=>{for(let a=0;a<i.length;++a){let n=i[a];if(e<=n.max&&e>=n.min){t=s;break}}}),t}getReward(e,i){let s=r.getInstance().getItemById("FishingBaits",e),a=r.getInstance().getItemById("FishingResult",String(i)),n=1;t.randomExt(100)<a.specialRate&&(n=2);let o=new Map,h=new Array,l=s.normal;2==n&&(l=s.special);for(let t=0;t<l.length;++t){let e=l[t].split(":");o.set(e[1],Number(e[0]))}let c=0;o.forEach((t,e)=>{c+=Number(t),h.push({w:t,n:e})}),h.sort(function(t,e){return t.w<e.w});let d=t.calcRandomWeight(h,c).n,g=r.getInstance().getItemById("FishingFishes",String(d)),u=a.sizeIncrease[0],p=a.sizeIncrease[1],I=t.randomExt2(Number(100*u),Number(100*p))/100,m=Number(g.size)+Math.floor(I*Number(g.size)*Number(g.sizeTimes)),f=a.incomeIncrease[0],y=a.incomeIncrease[1],_=t.randomExt2(Number(100*f),Number(100*y))/100,C=Number(g.income)+Math.floor(_*Number(g.income)*Number(g.incomeTimes)),S=null;if(t.randomExt(100)<g.NauticalFoodsRate){let e=new Map,i=new Array,s=JSON.parse(g.NauticalFoods);for(let t=0;t<s.length;++t){let i=s[t];e.set(i,i.weight)}let a=0;e.forEach((t,e)=>{a+=Number(t),i.push({w:t,n:e})}),i.sort(function(t,e){return t.w<e.w}),S=t.calcRandomWeight(i,a).n}return[d,m,C,S]}startGame(){this.resetGame(),this.gameState=1,this.startBtn.visible=!1,this.timesFont.visible=!1,this.endBtn.visible=!0,this.animCat.visible=!0,this.targetX=this.rightLimit,this.animCat.play("diaoyu1",!0),(new Laya.Timer).once(1300,this,function(){this.animCat.play("diaoyu2",!0)}),this.tickTimer.resume(),this.closeBtn.off(Laya.Event.CLICK,this,this.onCloseBtn),this.collectBtn.off(Laya.Event.CLICK,this,this.onShowCollect),this.baitBtn.off(Laya.Event.CLICK,this,this.onShowBaitsSelect),this.refresh_time_ticker.clear(this,this.tickerRefresh),this.tips.visible=!1}onCloseBtn(){this.close(),m.getInstance().switchScene(c.BeachSceneId)}onShowBaitsSelect(){Laya.Dialog.open("ui/FishingBaitsSelect.scene")}onShowCollect(){let t=Laya.Handler.create(null,function(){Laya.Dialog.open("ui/FishingCollectPop.scene")});R.updateServerCollectsInfo(t)}onUpdate(){let e=t.getSign(this.targetX-this.fishVernier.x);this.fishVernier.x+=e*(this.speed+1e-4),this.fishVernier.x>this.rightLimit&&(this.fishVernier.x=this.rightLimit,this.targetX=this.leftLimit),this.fishVernier.x<this.leftLimit&&(this.fishVernier.x=this.leftLimit,this.targetX=this.rightLimit),2==this.gameState&&(this.speed+=this.velocity,this.speed<=0&&(this.gameState=3,this.tickTimer.pause(),this.animCat.play("diaoyu3",!0),(new Laya.Timer).once(900,this,function(){this.animCat.stop();let t=this.getResult(),e=R.getLastBaitId(),i=this.getReward(e,t);console.log("--------- ---------"),console.log(i);let s=Laya.Handler.create(this,function(t){console.log("++++++++++  +++++++++"),console.log(t),Laya.Dialog.open("ui/FishingDialog.scene",!1,{reward:i,res:t})}),a=Laya.Handler.create(this,function(t){console.log("====== fishing game error ======= "+t),this.close(),m.getInstance().switchScene(c.BeachSceneId)}),n={type:"Currency",id:c.RewardType.FISH,amount:i[2]},r=null==i[3]?{rewards:[n]}:{rewards:[n,i[3]]};R.finishGameToServer(i[0],e,r,i[1],s,a)})))}resetGame(){this.tickTimer.pause(),this.gameState=0,this.fishVernier.x=this.leftLimit,this.targetX=this.rightLimit,this.startBtn.visible=!0,this.endBtn.visible=!1,this.animCat.visible=!1,this.timesFont.visible=!0}initLimit(){let t=this.root.getChildByName("left_limit"),e=this.root.getChildByName("right_limit");this.leftLimit=t.x,this.rightLimit=e.x}onClickStartGame(){0==this.gameState&&this.remainTimes>0&&this.startGame()}onClickEndGame(){this.gameState=2}onEnable(){this.resetGame()}onDisable(){this.resetGame()}}class st extends Laya.Script{constructor(){super(),this.align=0}onStart(){if(this.owner)if(null==this.owner.x_bak&&(this.owner.x_bak=this.owner.x,this.owner.width_bak=this.owner.width),1==this.align){let t=Laya.Browser.height/2436,e=1827*t;this.owner.x=this.owner.x_bak-Math.min(0,(Laya.Browser.width/2-e/2)/t)}else if(2==this.align){let t=Laya.Browser.height/2436,e=1827*t;this.owner.x=this.owner.x_bak+this.owner.width_bak-this.owner.width+Math.min(0,(Laya.Browser.width/2-e/2)/t)}}}class at{constructor(t,e){this._level=e,this._unlocked=!1,this._config=t}unlock(){this._unlocked=!0}isLocked(){return!this._unlocked}getId(){return this._config.Id}getName(){return this._config.Name}getDesc1(){return this._config.Desc1}get Source(){return this._config.Source}getShopItems(){return this._config.ShopItems}getLimit(){return this._config.Limit}getCost(){return this._config.Cost}getIncome(){return this._config.Income}getCookingTime(){return this._config.CookingTime}getLevel(){return this._level}clear(){this._unlocked=!1}}class nt{constructor(){this._foodsMap=new Map,this.foodListMap=new Map,this.cookBook=new Map,this.initFoods()}static getInstance(){return nt.instance?nt.instance:nt.instance=new nt}initFoods(){let t=r.getInstance().getConfig("FoodsList"),e=r.getInstance().getConfig("Foods"),i=this;t.forEach(function(t){let s=new Array;JSON.parse(t.foodsList).forEach(t=>{let a=String(t.foodId),n=Number(t.lv),r=new at(e.get(a),n);i._foodsMap.set(a,r),s.push(r)}),s.sort(function(t,e){return t.getLevel()-e.getLevel()}),i.foodListMap.set(t.Id,s),i.cookBook.set(t.Id,s[0])})}clear(){this._foodsMap.forEach(t=>{t.clear()});let t=this;this.foodListMap.forEach((e,i)=>{t.cookBook.set(i,e[0])})}getFood(t){return this._foodsMap.get(t)}getFoodList(t){return this.foodListMap.get(t)}getCurFoodInList(t){return this.cookBook.get(String(t))}updateFood(t,e){let i=this.foodListMap.get(t),s=this.cookBook.get(t);if(s.isLocked()&&s.getLevel()==e)return s.unlock(),!0;if(s.getLevel()!=e){let s=i[e-1];if(s){this.cookBook.set(t,s);for(let t=0;t<=e-1;t++)i[t].unlock();return!0}}return!1}getNextLevelUpFoodInList(t){let e=this.getCurFoodInList(t);if(e.isLocked())return e;return this.getFoodList(t)[e.getLevel()]}getAvailableFood(t){let e=this.cookBook.get(t);return e.isLocked()?null:e}}class rt{static init(){}static clear(){nt.getInstance().clear()}static updateFoods(t){if(t.menu){let e=!1;Object.getOwnPropertyNames(t.menu).forEach(i=>{let s=t.menu[i];e=nt.getInstance().updateFood(i,s)||e}),e&&a.getInstance().postEvent("UPDATE_FOODS")}}static getFood(t){return nt.getInstance().getFood(t)}static getFoodList(t){return nt.getInstance().getFoodList(t)}static getCurFoodInList(t){return nt.getInstance().getCurFoodInList(t)}static getAvailableFood(t){return nt.getInstance().getAvailableFood(t)}static getNextLevelUpFoodInList(t){return nt.getInstance().getNextLevelUpFoodInList(t)}static checkLevelUpUnAvailable(t){let e=rt.getNextLevelUpFoodInList(t);return e.getLimit()>N.getStar()?"评价不足":e.getCost()>N.getFish()&&"还差"+String(e.getCost()-N.getFish())+"鱼干"}static getPlayerFoodMenu(t){a.getInstance().postEvent("SERVICE_GET_PLAYER_FOOD_MENU",[t])}static foodLevelUp(t,e){a.getInstance().postEvent("SERVICE_FOOD_LEVELUP",[t,e])}}class ot{constructor(t){this.config=r.getInstance().getItemById("Task",t)}getId(){return this.config.Id}getName(){return this.config.Name}getDesc(){return this.config.Desc}setProgress(t,e){return(t!=this.current||e!=this.target||1==this.rewarded)&&(this.current=t,this.target=e,this.rewarded=!1,!0)}getCurrent(){return this.current?this.current>this.getTarget()?this.getTarget():this.current:0}getTarget(){return this.target?this.target:this.config.ConditionValue}getRewardType(){return this.config.RewardType}getReward(){return this.config.Reward}getStatus(){return this.rewarded?c.TaskStatus.kRewarded:this.getCurrent()>=this.getTarget()?c.TaskStatus.kCompleted:c.TaskStatus.kRunning}setRewarded(){return!this.rewarded&&(this.rewarded=!0,this.current=this.getTarget(),!0)}}class ht{constructor(){this.dailyTaskMap=new Map,this.trophyTaskMap=new Map,this.initTasks()}initTasks(){let t=r.getInstance().getConfig("TaskList"),e=this;t.forEach(function(t,i){let s=e.dailyTaskMap;t.TaskType==c.TaskType.kTrophy&&(s=e.trophyTaskMap),s.set(t.Id,new ot(t.List[0]))})}static getInstance(){return ht.instance?ht.instance:ht.instance=new ht}setDirty(t){this.dirtyFlag=t}hasCompletedTask(){if(1==this.dirtyFlag)return!0;if(-1==this.dirtyFlag)return!1;return this.hasCompletedDailyTask()||this.hasCompletedTrophyTask()}hasCompletedDailyTask(){let t=!1;return this.dailyTaskMap.forEach(function(e,i){e.getStatus()==c.TaskStatus.kCompleted&&(t=!0)}),t}hasCompletedTrophyTask(){let t=!1;return this.trophyTaskMap.forEach(function(e,i){e.getStatus()==c.TaskStatus.kCompleted&&(t=!0)}),t}getCurrentTask(t){let e=r.getInstance().getItemById("TaskList",t),i=this.dailyTaskMap;return e.TaskType==c.TaskType.kTrophy&&(i=this.trophyTaskMap),i.get(t)}updateTask(t,e,i,s,a){a&&a.delete(t);let n=r.getInstance().getItemById("TaskList",t),o=this.dailyTaskMap;n.TaskType==c.TaskType.kTrophy&&(o=this.trophyTaskMap);let h=o.get(t);return h.getId()==e?h.setProgress(i,s):((h=new ot(e)).setProgress(i,s),o.set(t,h),!0)}getChecklist(){let t=new Map;return r.getInstance().getConfig("TaskList").forEach(function(e,i){t.set(i,!0)}),t}setUnUpdatedTaskCompleted(t){let e=!1;if(t){let i=this;t.forEach(function(t,s){if(t){let t=r.getInstance().getItemById("TaskList",s),a=i.dailyTaskMap;t.TaskType==c.TaskType.kTrophy&&(a=i.trophyTaskMap);let n=a.get(s);n.getId()==t.List[t.List.length-1]?n.setRewarded()&&(e=!0):((n=new ot(t.List[t.List.length-1])).setRewarded(),a.set(s,n),e=!0)}})}return e}clear(){this.dailyTaskMap.clear(),this.trophyTaskMap.clear(),this.initTasks()}}class lt{static init(){}static setDirty(t){ht.getInstance().setDirty(t)}static updateTasks(t){ht.getInstance().setDirty(null);let e=t.dailyTasks,i=t.trophyTasks,s=ht.getInstance().getChecklist(),n=!1;[e,i].forEach(t=>{t&&Object.getOwnPropertyNames(t).forEach(e=>{let i=t[e],a=i.id,r=i.taskListId,o=i.current,h=i.target;n=ht.getInstance().updateTask(r,a,o,h,s)||n})}),(n=ht.getInstance().setUnUpdatedTaskCompleted(s)||n)&&a.getInstance().postEvent("UPDATE_TASKS"),a.getInstance().postEvent("REDPOINT_REFRESH",["task"])}static hasCompletedTask(){return ht.getInstance().hasCompletedTask()}static hasCompletedDailyTask(){return ht.getInstance().hasCompletedDailyTask()}static hasCompletedTrophyTask(){return ht.getInstance().hasCompletedTrophyTask()}static getCurrentTask(t){return ht.getInstance().getCurrentTask(t)}static getAllTasks(t){a.getInstance().postEvent("SERVICE_GET_ALLTASKS",[t])}static getDailyTaskReward(t,e){a.getInstance().postEvent("SERVICE_GET_DAILY_TASK_REWARD",[t,e])}static getTrophyTaskReward(t,e){a.getInstance().postEvent("SERVICE_GET_TROPHY_TASK_REWARD",[t,e])}}class ct{constructor(){this.redPointMap=new Map}static getInstance(){return ct.instance?ct.instance:ct.instance=new ct}registerObject(t,e){let i=this.redPointMap.get(t);null==i&&(i=new Map,this.redPointMap.set(t,i)),i.set(e,!0)}unregisterObject(t,e){let i=this.redPointMap.get(t);null!=i&&i.delete(e)}refreshRedPoint(t,e){let i=this.redPointMap.get(t);console.debug("refresh red point map",i),null!=i&&i.forEach((t,i)=>{i.refreshRedPoint(e)})}clear(){this.redPointMap.clear()}}class dt{static init(){a.getInstance().registEvent("REDPOINT_REFRESH",null,dt.refreshRedPoint)}static registerObject(t,e){ct.getInstance().registerObject(t,e)}static unregisterObject(t,e){ct.getInstance().unregisterObject(t,e)}static refreshRedPoint(t,e){ct.getInstance().refreshRedPoint(t,e)}}let gt=50;class ut{start(){this._frameCounter=0,this._actime=0,this._frameInterval=gt,this._paused=!1,this._interpreter.start(),this._simulator.start()}pause(){this._paused=!0}update(t){let e=this._frameInterval,i=this._actime+t,s=this._simulator,a=this._interpreter;for(this._actime=i;i>=e;){if(i-=e,this._actime=i,this._paused)return"paused";this._frameCounter++,s&&s.tick(e,this._frameCounter),a&&a.update(this._frameCounter)}}flush(){this._interpreter.flush()}setSimulator(t){this._simulator=t}setInterpreter(t){this._interpreter=t}setInterpreterMode(t){this._interpreter.setMode(t)}}class pt{setRecorder(t){this._recorder=t}getRecorder(){return this._recorder}setRandomizer(t){this._randomizer=t}getRandomizer(){return this._randomizer}random(){}randomExt(t){}newTimeline(t,e){this._recorder.newTimeline(t,e)}recordEvent(t,e,i){this._recorder.recordEvent(t,e,i)}recordMetaEvent(t,e,i,s){this._recorder.recordMetaEvent(t,e,i,s)}removeTimeline(t){this._recorder.setTimelineRemovable(t)}newMainLine(){this._mainlineCreated||(this._recorder.newTimeline("Main","MainLine"),this._mainlineCreated=!0)}recordMainEvent(t,e){this.newMainLine(),this._recorder.recordEvent("Main",t,e)}}class It{constructor(){}start(){this._context=new pt,this._context.setRecorder(this._recorder),this._recorder.start(),this._logic.start(this._context)}setLogic(t){this._logic=t}setRecorder(t){this._recorder=t}setController(t){this._controller=t}tick(t,e){this._recorder.gotoFrame(e),this._processInputs(this._controller,this._logic),this._controller.cleanUp(),this._logic.step(t)}_processInputs(t,e){if(e.isReadyForInput())for(;;){let i=t.nextInput();if(null==i)return;e.handlerInput(i)}}}class mt{constructor(){this._inputs=new Array,this._processingIndex=0}sendOpCommand(t,e,i){if(null==this._inputs)return null;let s={frame:this._currentFrame,op:t,args:e,handler:i};return this._inputs.push(s),!0}nextInput(){return this._inputs[this._processingIndex++]}cleanUp(){this._inputs.length=0,this._processingIndex=0}}class ft{start(){this._timelineDict=new Map,this._timelineArray=new Array,this._eventsOnFrames=new Map,this._currentFrame=0}gotoFrame(t){this._currentFrame=t}getCurrentFrame(){return this._currentFrame}newTimeline(t,e){return this.newTimelineAtFrame(t,this._currentFrame,e)}recordEvent(t,e,i){this.recordEventAtFrame(t,this._currentFrame,e,i)}recordMetaEvent(t,e,i,s){this.newTimeline(t,s),this.recordEvent(t,e,i)}newTimelineAtFrame(t,e,i){if(this._timelineDict.get(t))return void console.debug("ERROR!!!!!!objId not unique",t);let s={id:t,type:i,start:e,end:e};return this._timelineDict.set(t,s),this._timelineArray.push(s),s}recordEventAtFrame(t,e,i,s){let a=this._timelineDict.get(t);if(null==a)return void console.debug("ERROR!!!!!!objId not exists",t);(null==a.ended||a.ended<e)&&(a.ended=e);let n=this._eventsOnFrames.get(e);null==n&&(n=new Array,this._eventsOnFrames.set(e,n)),n.push({id:t,e:i,d:s})}allNewTimelinesAtFrame(t){let e=null,i=this._timelineArray;for(let s=0;s<i.length;++s){let a=i[s];a.start==t&&(null==e&&(e=new Array),e.push([a.id,a.type]))}return e}allRecordsAtFrame(t){let e=this._eventsOnFrames.get(t);if(null==e)return null;let i=new Array;for(let t=0;t<e.length;++t){let s=e[t];i.push([s.id,s.e,s.d])}return i}setTimelineRemovable(t){this._timelineDict.get(t).removable=!0}cleanUpBeforeFrame(t){for(const[e,i]of this._eventsOnFrames)e<t&&this._eventsOnFrames.delete(e);let e=this._timelineArray,i=this._timelineDict;for(let s=e.length-1;s>=0;--s){let a=e[s];a.removable&&a.start<t&&(e.splice(s,1),i.delete(a.id))}}}class yt{setId(t){this._id=t}getId(){return this._id}setInterpreter(t){this._interpreter=t}getInterpreter(){return this._interpreter}getTLInterpreterById(t){return null==this._interpreter?null:this._interpreter.findTLInterpreter(t)}_removeSelf(){return null==this._interpreter?null:this._interpreter.removeTLInterpreter(this._id)}doAction(t,e,i){let s=this[t];if(null!=s)return s.bind(this)(t,e,i);console.debug("warning","'"+this._id+"' skipped action '"+t+"'")}}class _t extends yt{DropFish(t,e,i){let s=e.buildingId,n=(e.reward,e.sceneId);a.getInstance().postEvent("UPDATE_DROPFISH",[s,n])}DropStar(t,e,i){e.buildingId,e.reward,e.sceneId}flush(){}}class Ct{constructor(){}static getInstance(){return Ct.instance?Ct.instance:Ct.instance=new Ct}createCoffeeCat(e,i,a,n,r){let o=new s(e);return o.pos(a,n),o.addLoadedHandler(function(){i.addChild(o),o.playAnim("lick1",!0),t.fadein(o,500,Laya.Handler.create(this,function(){null!=r&&r()}))}),o.loadAnim(e.getSource()+".sk",e.getSkin(),0),o}createBeachCat(t,e,i,a){let n=new s(t);return n.buildingId=e,n.spaceId=i,n.addLoadedHandler(function(){null!=a&&a.runWith(n)}),n.loadAnim(t.getSource()+".sk",t.getSkin(),0),n}}class St{constructor(t,e,i,s,a){this.cat=t,this.foodId=e,Laya.loader.create("prefab/component/cat_menu_tip.prefab",Laya.Handler.create(this,function(t){this._destroyed||(this.menuTipPrefab=t.create(),this.buildingExtInfo=i,this.time=s,this.handler=a,this.initCatMenuTip())}))}destroy(){this.menuTipPrefab&&this.menuTipPrefab.destroy(),this.panel&&this.panel.destroy(),this._destroyed=!0}initCatMenuTip(){this.handler;let t=this.cat,e=this.cat.getData();this.menuTipPrefab;this.cat.addChild(this.menuTipPrefab);let i=rt.getFood(this.foodId),s=this.menuTipPrefab.getChildByName("meals_img");s.loadImage(i.Source,Laya.Handler.create(this,function(){s.x-=s.width/2*s.scaleX,s.y-=s.height/2*s.scaleY})),this.menuTipPrefab.y=-405.5,this.menuTipPrefab.x=-83,t.scaleX<0&&(this.menuTipPrefab.scaleX=-1,this.menuTipPrefab.x=83);let n=new Laya.Panel;n.width=200,n.height=200,n.centerX=.5,n.y=-n.height,this.cat.addChild(n),this.panel=n,n.on(Laya.Event.CLICK,this,function(){1!=this.menuTipPrefab.isClicked&&a.getInstance().postEvent("SIMULATOR_SEND_CMD",[c.CoffeeSceneId,"CAT_EAT",e.getCatId()])})}}let Bt={Left:1,Right:-1};class Tt extends yt{AddCat(t,e,i){if(1==i){let t=e,i=p.getCatData(t),s=i.getX(),a=i.getY(),n=m.getInstance().getScene(c.CoffeeSceneId),r=Ct.getInstance().createCoffeeCat(i,n.root,s,a,null);this._cat=r}Q.getInstance().addCat(this._cat)}RemoveCat(t,e,i){if(1==i){let t=this._cat;null!=t&&(Q.getInstance().removeCat(this._cat.getId()),t.destroy()),this._removeSelf()}}MoveTo(e,i,s){let a=i.x,n=i.y,r=i.time,o=i.zOrder,h=this._cat;if(1==s){let e=t.randomRangePoint({x:a,y:n},20),i=Laya.Tween.to(h,{x:e.x,y:e.y},r,null,Laya.Handler.create(this,function(){o&&(h.zOrder=o,h.updateZOrder())}),0);var l=h.getCurAnim();e.y-h.y>0?"move1"!=l&&h.playAnim("move1",!0):e.y-h.y<0&&"move2"!=l&&h.playAnim("move2",!0);let s=Bt.Left;return e.x-h.x>0&&(s=Bt.Right),h.scaleX=Math.abs(h.scaleX)*s,i}}RandomStand(e,i,s){if(1==s){let e=this._cat,i=new Array("lick1","rest1","rest2"),s=i[t.randomExt(i.length)];null!=e&&e.getCurAnim()!=s&&e.playAnim(s,!0)}}Wait(t,e,i){if(1==i){let t=this._cat;null!=t&&"lick1"!=t.getCurAnim()&&t.playAnim("lick1",!0)}}IntoBuilding(e,i,s){if(1==s){let e=this._cat,s=i.type,a=i.buildingId,n=i.spaceId,r=i.food,o=m.getInstance().getScene(c.CoffeeSceneId).getSpaceInfo(a,n),h=i.time;e.playAnim("lick1"),e.showMaskAnim("tanhao",400,Laya.Handler.create(this,function(){t.fadeout(e,500,Laya.Handler.create(this,function(){if(null!=o){e.removeSelf();let t=e;return o.addToBuildingRoot(t),t.alpha=1,t.playAnim(o.randomCatMove()),t.x=o.getBuildingRootHalfWidth(),t.y=o.getBuildingRootHalfHeight(),t.scaleX=o.getIsFlip()*Math.abs(t.scaleX),1==s&&(e.catMenuTips&&(e.catMenuTips.destroy(),e.catMenuTips=null),e.showMaskAnim("chifan1"),e.catMenuTips=new St(t,r,o,h,null)),t}}))}))}}OutBuilding(e,i,s){if(1==s){let e=this._cat;e.catMenuTips&&(e.catMenuTips.destroy(),e.catMenuTips=null),e.hideMaskAnim(),e.stopAnim(),e.removeSelf(),e.playAnim("lick1"),m.getInstance().getScene(c.CoffeeSceneId).root.addChild(e);let s=i.pos;e.pos(s.x,s.y);let a=s.zOrder;a&&(e.zOrder=a,e.updateZOrder()),t.fadein(e,500)}}CatEat(t,e,i){let s=this._cat;s.playAnim("lick1"),s.catMenuTips&&(s.catMenuTips.menuTipPrefab.isClicked=!0,s.catMenuTips.menuTipPrefab.visible=!1,s.showMaskAnim("chifan2"))}WaitEatTimeOut(t,e,i){let s=this._cat;s.catMenuTips&&(s.catMenuTips.menuTipPrefab.isClicked=!0,s.catMenuTips.menuTipPrefab.visible=!1,s.showMaskAnim("shengqi"))}RemoveFade(e,i,s){if(1==s){let e=this._cat;Q.getInstance().removeCat(e.getId()),null!=e.parent?t.fadeout(e,500,Laya.Handler.create(this,function(){e.destroy()})):e.destroy()}}flush(){}}class Lt extends yt{AddCat(t,e,i){this._catId=e.catId,this._buildingId=e.buildingId,this._spaceId=e.spaceId,1==i&&this._createCat()}_createCat(){if(this._catId){let t=p.getCatData(this._catId),e=Ct.getInstance().createBeachCat(t,this._buildingId,this._spaceId,Laya.Handler.create(this,this._addCatToBuildingExt));this._cat=e,V.getInstance().addCat(this._cat)}}_addCatToBuildingExt(t){let e=m.getInstance().getScene(c.BeachSceneId);e&&t&&null==t.parent&&e.addCatToBuilding(t,t.buildingId,t.spaceId)}RemoveCat(t,e,i){if(1==i&&this._cat){let t=this._cat;null!=t&&(V.getInstance().removeCat(t.getId()),t.destroy())}this._cat=null,this._catId=null,this._removeSelf()}RemoveFade(e,i,s){if(1==s&&this._cat){let e=this._cat;V.getInstance().removeCat(e.getId()),1==s&&null!=e.parent?t.fadeout(e,500,Laya.Handler.create(this,function(){e.destroy()})):e.destroy()}this._cat=null,this._catId=null,this._removeSelf()}flush(){this._createCat()}}class wt{static createTLInterpreter(t){let e=null;switch(t){case"MainLine":e=new _t;break;case"CoffeeCatLine":e=new Tt;break;case"BeachCatLine":e=new Lt}return e}}class vt{constructor(){this._mode=1}setMode(t){this._mode=t}setRecordsProvider(t){this._recordsProvider=t}getRecordsProvider(){return this._recordsProvider}addTLInterpreter(t,e){let i=wt.createTLInterpreter(e);return null==i?null:(i.setId(t),i.setInterpreter(this),this._timelineInterpreters.set(t,i),i)}removeTLInterpreter(t){this._timelineInterpreters.delete(t)}findTLInterpreter(t){if(this._timelineInterpreters)return this._timelineInterpreters.get(t)}start(){this._timelineInterpreters=new Map,this._lastIndex=-1}update(t){let e=this._lastIndex?this._lastIndex:0;if(!(t<=e)){for(let i=e+1;i<=t;++i)this._lastIndex=i,this._processOneFrame(i);this._recordsProvider.cleanUpBeforeFrame(t)}}_processOneFrame(t){let e=this._recordsProvider;if(null==e)return;let i=e.allNewTimelinesAtFrame(t);null!=i&&i.forEach(t=>{this.addTLInterpreter(t[0],t[1])});let s=this._timelineInterpreters,a=e.allRecordsAtFrame(t);null!=s&&null!=a&&a.forEach(t=>{let e=s.get(t[0]);null!=e&&e.doAction(t[1],t[2],this._mode)})}flush(){this._timelineInterpreters&&this._timelineInterpreters.forEach(t=>{t.flush()})}}class Et{start(t){this._context=t}step(t){}handlerInput(t){}isReadyForInput(){return!0}}class bt{static init(){}static clear(){T.getInstance().clear()}static getPetInfo(t){return T.getInstance().getPet(t)}static addIntimacy(t,e){T.getInstance().addIntimacy(t,e)}static addVisitTimes(t,e){T.getInstance().addVisitTimes(t,e)}static doAdoptPet(t){T.getInstance().adoptPet(t)}static dumpAndStashPetRewards(){return T.getInstance().dumpAndStashPetRewards()}static clearPetRewards(){T.getInstance().clearPetRewards()}static updatePets(t){Object.getOwnPropertyNames(t).forEach(e=>{let i=t[e],s=i.id,a=i.intimacy,n=i.visitTimes,r=i.adopted,o=i.newCome;T.getInstance().updatePet(s,a,n,r,o)})}static adoptPet(t,e){a.getInstance().postEvent("SERVICE_ADOPT_PET",[t,e])}static getPetsInfo(t){a.getInstance().postEvent("SERVICE_GET_PETSINFO",[t])}static needRedPoint(){return T.getInstance().needRedPoint()}static clearAllRedPoint(){T.getInstance().clearAllRedPoint()}}class Rt{static getFishReward(e,i){let s=e.CompleteReward,a=new Array,n=0;for(const t in s){let e=s[t];if(null!=e&&""!=e){let t=e.split(":"),i=Number(t[0]),s=Number(t[1]);a.push({w:i,reward:s}),n+=i}}let r=t.calcRandomWeight(a,n);return r?r.reward*i:null}static getStarReward(t,e){let i=null,s=JSON.parse(t.SCompleteReward);return Math.random()<Number(s.rate)&&(i=Number(s.times)*e),i}static randomNextEvent(e,i){if(0==i.NextEvent.length)return null;let s=new Array;for(let t=0;t<i.NextEvent.length;++t){let a=i.NextEvent[t];null!=O.randomVisitBuilding(e,a)&&s.push(a)}return 0==s.length?null:s[t.randomExt(s.length)]}static randomNextEventInBuilding(e,i){if(0==i.NextEvent.length)return null;let s=new Array;for(let t=0;t<i.NextEvent.length;++t){let a=i.NextEvent[t];e.isSupportAction(a)&&s.push(a)}return 0==s.length?null:s[t.randomExt(s.length)]}static findCatMoveBlock(e,i){let s=O.getBuildingDataByBid(e);if(null==s||s.getCapacity()<=0)return{t:3,s:null};let a=s.getSpaces();if(null==a||0==a.length)return{t:2,s:null};let n=a[t.randomExt(a.length)];return null!=n?{t:1,s:n}:{t:2,s:null}}}class xt{constructor(t){this.catData=t,this.activeAI=!1,this.eventActionConfig=r.getInstance().getConfig("ActionEvent"),this.targetBuildingData=null,this.speed=180,this.path=g.getInstance().randomPath(c.CoffeeSceneId),this.pathIndex=-1,this.upOrder=999999,this.downOrder=50,this._eventStack=new Array}getId(){return this.catData.getCatId()}getConfigId(){return this.catData.getConfigId()}restore(t){}getIsActive(){return this.activeAI}setIsActive(t){this.activeAI=t}getData(){return this.catData}_popEvent(){let t=this._eventStack.pop();t&&(this._setNextStep(t.event,t.delay,t.args),this.update(0))}_stackEvent(t,e,i){this._eventStack.push({event:t,delay:e,args:i})}_setNextStep(t,e,i){this._scheduleTime=e,this._nextEvent=t,this._nextEventArgs=i}start(e){let i=g.getInstance().getStartPathPoint();this.catData.setPos(t.randomRangePoint(new Laya.Point(i.x,i.y),100)),this._context=e,this._state="start",this._setNextStep("onActive",2e3),this._context.recordMetaEvent(this.getId(),"AddCat",this.getId(),"CoffeeCatLine")}update(t){if(this._scheduleTime&&this._scheduleTime>0)this._scheduleTime-=t;else if(this._nextEvent){let t=this._nextEvent;switch(this._nextEvent=null,t){case"onActive":this._onActive(this._nextEventArgs);break;case"gotoTargetIndex":this._gotoTargetIndex(this._nextEventArgs);break;case"gotoTargetIndexAndStand":this._gotoTargetIndexAndStand(this._nextEventArgs);break;case"waitEmpty":this._waitEmpty(this._nextEventArgs);break;case"intoBuilding":this._intoBuilding(this._nextEventArgs);break;case"outBuilding":this._outBuilding(this._nextEventArgs);break;case"newDecision":this._newDecision(this._nextEventArgs);break;case"remove":this._remove(this._nextEventArgs);break;case"waitEatTimeOut":this._waitEatTimeOut(this._nextEventArgs)}}}eat(){if("waitEat"==this._state){let t=this._eatInfo[3],e=rt.getFood(t);if(e.isLocked())return void this._waitEatTimeOut(this._eatInfo);let i=e.getIncome();this._eatInfo[4]=i,this._state="eating",this._setNextStep("outBuilding",1e3*e.getCookingTime(),this._eatInfo),this._context.recordEvent(this.getId(),"CatEat",null)}}remove(){return!this._context||"leaving"!=this._state&&(this._context.recordEvent(this.getId(),"RemoveCat",null),!0)}_onActive(){let t=O.getTotalSpaceCountInScene(c.CoffeeSceneId);this._context._roleMgr.getActiveRoleCount()<=t+2?(this._resetToVisitEvent(),this.setIsActive(!0)):this._setNextStep("onActive",2e3)}_resetToVisitEvent(){let t=this.catData.getEventVisit();this._doActionEvent(t)}_doActionEvent(t){this._genTarget(t);let e=this.eventActionConfig.get(t);null==e?null!=this.targetBuildingData||this._doLeave():this._doWork(e)}_doLeave(){this.setIsActive(!1),this._stackEvent("remove"),this._gotoTargetIndex(0),this._state="leaving"}_remove(){p.removeCatData(this.getId(),c.CoffeeSceneId),this._context.recordEvent(this.getId(),"RemoveFade",null),this._context._roleMgr.removeRole(this.getId())}_genTarget(t){this.targetBuildingData=null;let e=O.randomVisitBuilding(c.CoffeeSceneId,t);null!=e&&(this.targetBuildingData=e)}_gotoBuilding(t){let e=t.getLocationData().getPathPointIndex();for(let t=0;t<this.path.length;++t){if(this.path[t].i==e){e=t;break}}this._gotoTargetIndexAndStand(e)}_gotoTargetIndexAndStand(e){if(t.randomExt(100)>97){let i=3e3+t.randomExt(6e3);this._state="randomStand",this._context.recordEvent(this.getId(),"RandomStand",null),this._setNextStep("gotoTargetIndex",i,e)}else this._gotoTargetIndex(e)}_gotoTargetIndex(t){if(this.pathIndex!=t){-1==this.pathIndex&&(this.pathIndex=0);let e=t-this.pathIndex;e>0?this.pathIndex++:e<0&&this.pathIndex--;let i=this.path[this.pathIndex],s=this.catData.getX()-i.x,a=this.catData.getY()-i.y,n=Math.sqrt(s*s+a*a)/this.speed*1e3,r=null;i.i==g.getInstance().getZOrderPathPoint()&&(t>this.pathIndex?r=this.upOrder:t<this.pathIndex&&(r=this.downOrder)),this.zOrder=r,this.catData.setPos(i),this._state="moving",this._context.recordEvent(this.getId(),"MoveTo",{x:i.x,y:i.y,time:n,zOrder:r}),this._setNextStep("gotoTargetIndexAndStand",n,t)}else this._popEvent()}_getCurrentPos(){let t=this.path[this.pathIndex];return{x:t.x,y:t.y,zOrder:this.zOrder}}_doWork(t){"VISIT"==t.Type?this._doActionEvent(Rt.randomNextEvent(c.CoffeeSceneId,t)):(this._stackEvent("waitEmpty",0,t),this._gotoBuilding(this.targetBuildingData))}_waitEmpty(t){this._state="waitEmpty",this._context.recordEvent(this.getId(),"Wait",{anim:"lick1"});let e=this.targetBuildingData.getId(),i=Rt.findCatMoveBlock(e,c.CoffeeSceneId);1==i.t?null!=i.s&&this._setNextStep("intoBuilding",0,[t,e,i.s]):2==i.t?this._setNextStep("waitEmpty",1e3):this._setNextStep("intoBuilding",0)}_intoBuilding(t){if(t&&t[0]&&t[1]){let e=t[0],i=t[1],s=t[2];O.getBuildingDataByBid(i).occupy(s,this.getId());let a=1;if("REST"==e.Type&&(a=2),1==a){this._state="waitEat";let e=this.catData.randomFood(),n=rt.getCurFoodInList(e);console.debug("randomfood",e,n),t[3]=n.getId(),this._eatInfo=t;let r=1e3*Number(W.get("CookingOvertime"));this._setNextStep("waitEatTimeOut",r+900,t),this._context.recordEvent(this.getId(),"IntoBuilding",{type:a,time:10900,buildingId:i,spaceId:s,food:n.getId()})}else 2==a&&(this._state="rest",this._setNextStep("outBuilding",6900,t),this._context.recordEvent(this.getId(),"IntoBuilding",{type:a,time:6900,buildingId:i,spaceId:s}))}else this._resetToVisitEvent()}_waitEatTimeOut(t){this._state="waitEatTimeOut",this._setNextStep("outBuilding",1e3,t),this._context.recordEvent(this.getId(),"WaitEatTimeOut",null)}_outBuilding(t){let e=t[0],i=t[1],s=t[2],a=t[4];if(O.getBuildingDataByBid(i).leave(s,this.getId()),"waitEatTimeOut"!=this._state){0==this.catData.eventCount&&bt.addVisitTimes(this.getConfigId(),1),bt.addIntimacy(this.getConfigId(),e.IntimacyUp);let t=Rt.getStarReward(e,this.catData.getStarBase());t&&t>0?(L.addCachedStar(i,t),this._context.recordMainEvent("DropStar",{buildingId:i,reward:t,sceneId:c.CoffeeSceneId})):(t=Rt.getFishReward(e,this.catData.getValueBase()))&&t>0&&(L.addCachedFish(i,t),this._context.recordMainEvent("DropFish",{buildingId:i,reward:t,sceneId:c.CoffeeSceneId})),"eating"==this._state&&a&&(L.addCachedFish(i,a),this._context.recordMainEvent("DropFish",{buildingId:i,reward:a,sceneId:c.CoffeeSceneId}))}this._state="idle",this.catData.eventCount++,this._context.recordEvent(this.getId(),"OutBuilding",{time:500,buildingId:i,spaceId:s,pos:this._getCurrentPos()}),this._setNextStep("newDecision",500,e)}_newDecision(t){this.catData.eventCount>=2?this._doLeave():this._doActionEvent(Rt.randomNextEvent(c.CoffeeSceneId,t))}destroy(){this._context.removeTimeline(this.getId())}}class kt{constructor(){this._roleMap=new Map,this._roleList=new Array,this._roleStack=new Array}addCat(t){let e=new xt(t);return this._roleMap.set(Number(t.getCatId()),e),this._roleStack.push(e),e}removeRole(t){this._roleMap.delete(Number(t));for(const e in this._roleList){let i=this._roleList[e];if(i.getId()==t)return i.destroy(),this._roleList.splice(e,1),i}for(const e in this._roleStack){let i=this._roleStack[e];if(i.getId()==t)return i.destroy(),void this._roleStack.splice(e,1)}}showRole(){let t=this._roleStack.shift();return t&&this._roleList.push(t),t}getRoleById(t){return this._roleMap.get(t)}getRoles(){return this._roleList.slice(0)}getRoleCount(){return this._roleMap.size}getRoleListCount(){return this._roleList.length}getStackRoleCount(){return this._roleStack.length}getActiveRoleCount(){let t=0;for(const e of this._roleList)e.getIsActive()&&t++;return t}}let At=2e3;class Nt extends Et{constructor(){super(),this._roleMgr=new kt}start(t){this._context=t,this._calcAttractCD(),this._showCD=At,this._immediateShow=!1,t._roleMgr=this._roleMgr,this._context.newMainLine()}step(t){let e=this._roleMgr.getRoles();for(const i of e)i.update(t);this._attractCD-=t,this._attractCD<=0&&(this._calcAttractCD(),this._attractCat()),this._showCD-=t,this._showCD<=0&&(this._showCD=At,this._showCat()),this._immediateShow&&(this._immediateShow=!1,this._showCat())}_calcAttractCD(){let e=W.getArray("CatVisitGaps");this._attractCD=1e3*t.randomExt2(Number(e[0]),Number(e[1]))}_attractCat(){let e=O.getCatWeightedArray(c.CoffeeSceneId),i=O.getBuildingDataListInfo(c.CoffeeSceneId).weighted,s=t.calcRandomWeight(e,i);if(null!=s){if(this._roleMgr.getRoleCount()<30){if(null!=g.getInstance().getStartPathPoint()){let t=s.n;p.addCatData(t,c.CoffeeSceneId,{})}}}}_showCat(){if(this._roleMgr.getStackRoleCount()>0){let t=O.getTotalSpaceCountInScene(c.CoffeeSceneId);if(this._roleMgr.getRoleListCount()<t+6){this._roleMgr.showRole().start(this._context)}}}handlerInput(t){let e=t.op,i=t.args,s=t.handler;switch(e){case"ADD_CAT":this._addCat(i,s);break;case"REMOVE_CAT":this._removeCat(i,s);break;case"FORCE_ATTRACT_CAT":this._forceAttractCat();break;case"RESTORE_CAT":this._restoreCat(i,s);break;case"CAT_EAT":this._catEat(i)}}_addCat(t,e){let i=t,s=p.getCatData(i);this._roleMgr.addCat(s)}_restoreCat(t,e){}_removeCat(t,e){let i=t,s=this._roleMgr.getRoleById(i);s&&s.remove()&&this._roleMgr.removeRole(i)}_forceAttractCat(){this._attractCat(),this._immediateShow=!0}_catEat(t){let e=t;this._roleMgr.getRoleById(e).eat()}}let Dt=50;class Mt{static getOrCreateSession(){return H.coffeeSession?H.coffeeSession:(H.coffeeSession=new Mt,H.coffeeSession.build(),H.coffeeSession.prepare(),H.coffeeSession)}static runSession(){Mt.getOrCreateSession().startLoop()}static sendOpCommand(t,e,i){Mt.getOrCreateSession()._sendOpCommand(t,e,i)}static simulate(t){Mt.getOrCreateSession()._simulate(t)}static clear(){H.coffeeSession&&(H.coffeeSession.destroy(),H.coffeeSession=null)}constructor(){this._director=new ut,this._simulator=new It,this._logic=new Nt,this._controller=new mt,this._recorder=new ft,this._interpreter=new vt}build(){this._director.setSimulator(this._simulator),this._director.setInterpreter(this._interpreter),this._interpreter.setRecordsProvider(this._recorder),this._simulator.setRecorder(this._recorder),this._simulator.setLogic(this._logic),this._simulator.setController(this._controller)}prepare(){this._director.start(),a.getInstance().registEvent("FORCE_ATTRACT_COFFEE_CAT",this,this.onForceAttractCat)}onForceAttractCat(){this._sendOpCommand("FORCE_ATTRACT_CAT")}startLoop(){Laya.timer.loop(Dt,this,this._update,[],!0,!0)}_update(){this._director.update(Dt)}_simulate(t){this._director.setInterpreterMode(2),this._director.update(t),this._director.flush(),this._director.setInterpreterMode(1)}_sendOpCommand(t,e,i){this._controller.sendOpCommand(t,e,i)}destroy(){Laya.timer.clearAll(this),a.getInstance().removeEvent("FORCE_ATTRACT_COFFEE_CAT",this,this.onForceAttractCat)}}class Ft{constructor(t){this.catData=t,this.eventActionConfig=r.getInstance().getConfig("ActionEvent"),this.targetEvent=null,this._eventStack=new Array}getId(){return this.catData.getCatId()}getConfigId(){return this.catData.getConfigId()}getData(){return this.catData}_popEvent(){let t=this._eventStack.pop();t&&(this._setNextStep(t.event,t.delay,t.args),this.update(0))}_stackEvent(t,e,i){this._eventStack.push({event:t,delay:e,args:i})}_setNextStep(t,e,i){this._scheduleTime=e,this._nextEvent=t,this._nextEventArgs=i}start(t,e){let i=this.catData.getParams();if(this.buildingId=i.BuildingId,this.spaceId=i.SpaceId,this.travelTime=i.TravelTime,this.startTime=i.StartTime,null==this.buildingId)return void p.removeCatData(this.getId(),c.BeachSceneId);let s=this.travelTime;e&&this.startTime&&(s=this.travelTime-e+this.startTime)<0&&(s=0);let a=O.getBuildingDataByBid(this.buildingId);a.occupy(this.spaceId,this.getId());let n=i.event;n||(n=this.catData.getEventTravel());let r=this.eventActionConfig.get(n);if("VISIT"==r.Type&&null==(n=Rt.randomNextEventInBuilding(a,r)))return a.leave(this.spaceId,this.getId()),void p.removeCatData(this.getId(),c.BeachSceneId);this._context=t,this._state="inBuilding",this._eventString=n,this.catData.setEvent(n),this._context.recordMetaEvent(this.getId(),"AddCat",{catId:this.getId(),buildingId:this.buildingId,spaceId:this.spaceId,event:n},"BeachCatLine"),this._setNextStep("travelEnd",s),this.update(0)}update(t){if(this._scheduleTime&&this._scheduleTime>0)this._scheduleTime-=t;else if(this._nextEvent){let t=this._nextEvent;switch(this._nextEvent=null,t){case"travelEnd":this._travelEnd(this._nextEventArgs);break;case"remove":this._remove(this._nextEventArgs)}}}remove(){if(!this._context)return!0;if("leaving"!=this._state){return O.getBuildingDataByBid(this.buildingId).leave(this.spaceId,this.getId()),this._context.recordEvent(this.getId(),"RemoveCat",null),!0}return!1}_travelEnd(){if(this._eventString){let t=this.eventActionConfig.get(this._eventString);0==this.catData.eventCount&&bt.addVisitTimes(this.getConfigId(),1),bt.addIntimacy(this.getConfigId(),t.IntimacyUp);let e=Rt.getStarReward(t,this.catData.getStarBase()),i=c.RewardType.STAR;e&&e>0?L.cacheVisitorReward(this.getId(),this.getConfigId(),this.buildingId,e,i):(e=Rt.getFishReward(t,this.catData.getValueBase()),i=c.RewardType.FISH,e&&e>0&&L.cacheVisitorReward(this.getId(),this.getConfigId(),this.buildingId,e,i))}this._state="leaving",this.catData.eventCount++,this._context.recordEvent(this.getId(),"RemoveFade",null),this._setNextStep("remove",500)}_remove(){O.getBuildingDataByBid(this.buildingId).leave(this.spaceId,this.getId()),p.removeCatData(this.getId(),c.BeachSceneId),this._context._roleMgr.removeRole(this.getId())}destroy(){this._context&&this._context.removeTimeline(this.getId())}}class Pt{constructor(){this._roleMap=new Map,this._roleList=new Array}addCat(t){let e=new Ft(t);return this._roleMap.set(Number(t.getCatId()),e),this._roleList.push(e),e}removeRole(t){this._roleMap.delete(Number(t));for(const e in this._roleList){let i=this._roleList[e];if(i.getId()==t)return i.destroy(),this._roleList.splice(e,1),i}}getRoleById(t){return this._roleMap.get(t)}getRoles(){return this._roleList.slice(0)}getRoleCount(){return this._roleList.length}}let Ot=2e3;class Ut extends Et{constructor(){super(),this._roleMgr=new Pt,this._currentTime=0,this._exhaustTime=null}start(t){this._context=t,this._attractCD=1e4,this._showCD=Ot,this._immediateShow=!1,t._roleMgr=this._roleMgr}step(t){this._currentTime+=t;let e=this._roleMgr.getRoles();for(const i of e)i.update(t);this._attractCat(t)}_attractCat(e){if(null==this._exhaustTime||this._exhaustTime<this._currentTime)return;let i=O.getAvailableBuilding(c.BeachSceneId);if(i)for(const s of i){let i=s.getId();if(!s.attractCD){let e=W.getArray("TravelTriggerGaps");s.attractCD=1e3*t.randomExt2(Number(e[0]),Number(e[1]))}if(s.attractCD-=e,s.attractCD<=0){let e=t.calcRandomWeight(s.getCatWeightedArray(),s.getCatWeightedSum());if(null!=e){let a=e.n,n=s.getSpaces(),r=n[t.randomExt(n.length)];if(null!=r){let e=W.getArray("TravelKeepTime"),n=1e3*t.randomExt2(Number(e[0]),Number(e[1])),o=p.addCatData(a,c.BeachSceneId,{BuildingId:i,SpaceId:r,TravelTime:n,StartTime:this._currentTime});s.occupy(r,o.getCatId())}}s.attractCD=null}}}handlerInput(t){let e=t.op,i=t.args,s=t.handler;switch(e){case"ADD_CAT":this._addCat(i,s);break;case"REMOVE_CAT":this._removeCat(i,s);break;case"CAT_EAT":this._catEat(i);break;case"SET_TIME":this._setTime(i);break;case"REFRESH_FOOD":this._refreshFood(i)}}_addCat(t,e){let i=t,s=p.getCatData(i);this._roleMgr.addCat(s).start(this._context,this._currentTime)}_removeCat(t,e){let i=t,s=this._roleMgr.getRoleById(i);s&&s.remove()&&this._roleMgr.removeRole(i)}_catEat(t){let e=t;this._roleMgr.getRoleById(e).eat()}_setTime(t){this._currentTime=t}_refreshFood(t){this._exhaustTime=t}}let Gt=50;class Ht{static getOrCreateSession(){return H.beachSession?H.beachSession:(H.beachSession=new Ht,H.beachSession.build(),H.beachSession.prepare(),H.beachSession)}static runSession(){Ht.getOrCreateSession().startLoop()}static sendOpCommand(t,e,i){Ht.getOrCreateSession()._sendOpCommand(t,e,i)}static simulate(t){Ht.getOrCreateSession()._simulate(t)}static clear(){H.beachSession&&(H.beachSession.destroy(),H.beachSession=null)}constructor(){this._director=new ut,this._simulator=new It,this._logic=new Ut,this._controller=new mt,this._recorder=new ft,this._interpreter=new vt}build(){this._director.setSimulator(this._simulator),this._director.setInterpreter(this._interpreter),this._interpreter.setRecordsProvider(this._recorder),this._simulator.setRecorder(this._recorder),this._simulator.setLogic(this._logic),this._simulator.setController(this._controller)}prepare(){this._director.start()}onForceAttractCat(){this.sendOpCommand("FORCE_ATTRACT_CAT")}startLoop(){Laya.timer.loop(Gt,this,this._update,[],!0,!0)}_update(){this._director.update(Gt)}_simulate(t){this._director.setInterpreterMode(2),this._director.update(t),this._director.flush(),this._director.setInterpreterMode(1)}_sendOpCommand(t,e,i){this._controller.sendOpCommand(t,e,i)}destroy(){Laya.timer.clearAll(this)}}class Vt{static init(){a.getInstance().registEvent("SIMULATOR_SEND_CMD",null,Vt.sendOpCommand),a.getInstance().registEvent("SIMULATOR_CREATE_SESSION",null,Vt.CreateSession),a.getInstance().registEvent("SIMULATOR_RUN_SESSION",null,Vt.RunSession),a.getInstance().registEvent("SIMULATOR_SIMULATE_SESSION",null,Vt.SimulateSession)}static clear(){Mt.clear(),Ht.clear()}static CreateSession(t){t==c.CoffeeSceneId?Mt.getOrCreateSession():t==c.BeachSceneId&&Ht.getOrCreateSession()}static SimulateSession(t,e){t==c.CoffeeSceneId?Mt.simulate(e):t==c.BeachSceneId&&Ht.simulate(e)}static RunSession(t){t==c.CoffeeSceneId?Mt.runSession():t==c.BeachSceneId&&Ht.runSession()}static sendOpCommand(t,e,i,s){t==c.CoffeeSceneId?Mt.sendOpCommand(e,i,s):t==c.BeachSceneId&&Ht.sendOpCommand(e,i,s)}}class qt{constructor(t){this._config=t,this._count=0}get Id(){return this._config.Id}get Name(){return this._config.Name}get Desc(){return this._config.Desc}get Icon(){return this._config.Icon}get PointRate(){return this._config.PointRate}get IntimacyRate(){return this._config.IntimacyRate}get count(){return this._count}set count(t){this._count=t}clear(){this._count=0}}class Wt{constructor(t){this._config=t,this._count=0}get Id(){return this._config.Id}get Name(){return this._config.Name}get Desc(){return this._config.Desc}get Icon(){return this._config.Icon}get Point(){return this._config.Point}get Intimacy(){return this._config.Intimacy}get UpgradeLine(){return this._config.UpgradeLine}get count(){return this._count>0?this._count:0}set count(t){this._count=t}clear(){this._count=0}}class jt{constructor(){this._inTrip=!1,this._startSec=null,this._endSec=null,this._team=new Array,this._foods=new Map,this._tools=new Array}update(t){this._inTrip=t.inTrip,this._startSec=t.tripStartSec,this._endSec=t.tripEndSec,this._team.length=0,this._foods.clear(),this._tools.length=0;let e=t.team;if(e)for(const t of e)this._team.push(t);let i=t.foodInTrip;if(i)for(const[t,e]of i)this._foods.set(t,e);let s=t.toolInTrip;if(s)for(const t of s)this._tools.push(t)}get inTrip(){return this._inTrip}get startSec(){return this._startSec}get endSec(){return this._endSec}get team(){return this._team}get foods(){return this._foods}get tools(){return this._tools}getFoodCount(t){let e=this._foods.get(t);return e||0}addPet(t){if(!this._inTrip){for(const e of this._team)if(e==t)return!1;return this._team.push(t),!0}}removePet(t){if(!this._inTrip){for(let e=0;e<this._team.length;++e)if(this._team[e]==t)return this._team.splice(e,1),!0;return!1}}addFood(t){if(!this._inTrip){for(const[e,i]of this._foods)if(e==t)return this._foods.set(e,i+1),!0;return this._foods.set(t,1),!0}}removeFood(t){if(!this._inTrip){for(const[t,e]of this._foods)if(t==foodId)return e-1>0?this._foods.set(t,e+1):this._foods.delete(t),!0;return!1}}addTool(t){if(!this._inTrip){for(const e of this._tools)if(e==t)return!1;return this._team.push(t),!0}}removeTool(t){if(!this._inTrip){for(let e=0;e<this._tools.length;++e)if(this._tools[e]==t)return this._tools.splice(e,1),!0;return!1}}dumpStartReqInfo(){return{catIds:this._team,foodInTrip:Utils.map2Obj(this._foods),toolInTrip:this._tools}}clear(){this._inTrip=!1,this._startSec=null,this._endSec=null,this._team.length=0,this._foods.clear(),this._tools.length=0}}class Kt{constructor(){this._foodsMap=new Map,this._toolsMap=new Map,this._foodsList=new Array,this._toolsList=new Array,this._petIds=new Array,this._nauticalInfo=new jt,this.init()}static getInstance(){return Kt.instance?Kt.instance:Kt.instance=new Kt}init(){this._foodsMap.clear(),this._toolsMap.clear();let t=r.getInstance().getConfig("NauticalFoods");for(const[e,i]of t)this._foodsMap.set(i.Id,new Wt(i));let e=r.getInstance().getConfig("NauticalTools");for(const[t,i]of e)this._toolsMap.set(i.Id,new qt(i))}getNauticalInfo(){return this._nauticalInfo}getAvailablePets(){return this._petIds.slice(0)}getFoods(){return this._foodsList.slice(0)}getTools(){return this._toolsList.slice(0)}getFood(t){return this._foodsMap.get(t)}getTool(t){return this._toolsMap.get(t)}updateUsage(t){t.team;let e=t.foods;t.tools;for(let t=this._foodsList.length-1;t>=0;--t){let i=this._foodsList[t],s=e.get(i.Id);s&&(i.count=i.count-s,0==i.count&&this._foodsList.splice(t,1))}}_clearFoods(){for(const[t,e]of this._foodsMap)e.clear();this._foodsList.length=0}_clearTools(){for(const[t,e]of this._toolsMap)e.clear();this._toolsList.length=0}updateNauticalFoods(t){if(this._clearFoods(),t)for(const[e,i]of t){let t=this._foodsMap.get(i.id);t&&(t.count=i.amount,this._foodsList.push(t))}}updateNauticalTools(t){if(this._clearTools(),t)for(const[e,i]of t){let t=this._toolsMap.get(i.id);t&&(t.count=i.amount,this._toolsList.push(t))}}updateAvailablePets(t){if(this._petIds.length=0,t)for(const e of t)this._petIds.push(e)}updateNauticalInfo(t){this._nauticalInfo.clear(),t&&this._nauticalInfo.update(t)}clear(){this._clearFoods(),this._clearTools(),this._nauticalInfo.clear(),this._petIds.length=0}}class Xt{static init(){}static clear(){Kt.getInstance().clear()}static updateAll(t,e,i,s){let a=Kt.getInstance();a.updateNauticalInfo(t),a.updateAvailablePets(e),a.updateNauticalFoods(i),a.updateNauticalTools(s)}static updateNauticalInfo(t){Kt.getInstance().updateNauticalInfo(t)}static get NauticalInfo(){return Kt.getInstance().getNauticalInfo()}static get Pets(){return Kt.getInstance().getAvailablePets()}static get Foods(){return Kt.getInstance().getFoods()}static get Tools(){return Kt.getInstance().getTools()}static getFoodById(t){return Kt.getInstance().getFood(t)}static getToolById(t){return Kt.getInstance().getTool(t)}static getNauticalInfoReq(t){a.getInstance().postEvent("SERVICE_GET_NAUTICAL_INFO",[t])}static mergeNauticalFood(t,e,i){a.getInstance().postEvent("SERVICE_MERGE_NAUTICAL_FOOD",[t,e,i])}static startNauticalTrip(t){let e=Xt.NauticalInfo,i=e.dumpStartReqInfo();a.getInstance().postEvent("SERVICE_START_NAUTICAL_TRIP",[i,Laya.Handler.create(null,function(i){Kt.getInstance().updateUsage(e),t&&t.runWith([i])})])}static finishNauticalTrip(t){a.getInstance().postEvent("SERVICE_FINISH_NAUTICAL_TRIP",[t])}}class zt{static stringToByte(t){var e,i,s=new Array;e=t.length;for(var a=0;a<e;a++)(i=t.charCodeAt(a))>=65536&&i<=1114111?(s.push(i>>18&7|240),s.push(i>>12&63|128),s.push(i>>6&63|128),s.push(63&i|128)):i>=2048&&i<=65535?(s.push(i>>12&15|224),s.push(i>>6&63|128),s.push(63&i|128)):i>=128&&i<=2047?(s.push(i>>6&31|192),s.push(63&i|128)):s.push(255&i);return s}static byteToString(t){if("string"==typeof t)return t;for(var e="",i=t,s=0;s<i.length;s++){var a=i[s].toString(2),n=a.match(/^1+?(?=0)/);if(n&&8==a.length){for(var r=n[0].length,o=i[s].toString(2).slice(7-r),h=1;h<r;h++)o+=i[h+s].toString(2).slice(2);e+=String.fromCharCode(parseInt(o,2)),s+=r-1}else e+=String.fromCharCode(i[s])}return e}static bytesToHexString(t){return Array.from(t,function(t){return("0"+(255&t).toString(16)).slice(-2)}).join("")}static hexString2Bytes(t){var e=0,i=t.length;if(i%2!=0)return null;i/=2;for(var s=new Array,a=0;a<i;a++){var n=t.substr(e,2),r=parseInt(n,16);s.push(r),e+=2}return s}static base64ToBytes(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var i=[],s=0,a=0;s<t.length;a=++s%4)0!=a&&i.push((e.indexOf(t.charAt(s-1))&Math.pow(2,-2*a+8)-1)<<2*a|e.indexOf(t.charAt(s))>>>6-2*a);return i}static base64_encode(t){for(var e,i,s,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,r=t.length,o="";n<r;){if(e=255&t.charCodeAt(n++),n==r){o+=a.charAt(e>>2),o+=a.charAt((3&e)<<4),o+="==";break}if(i=t.charCodeAt(n++),n==r){o+=a.charAt(e>>2),o+=a.charAt((3&e)<<4|(240&i)>>4),o+=a.charAt((15&i)<<2),o+="=";break}s=t.charCodeAt(n++),o+=a.charAt(e>>2),o+=a.charAt((3&e)<<4|(240&i)>>4),o+=a.charAt((15&i)<<2|(192&s)>>6),o+=a.charAt(63&s)}return o}static byteToBase64String(t){for(var e="",i=new Uint8Array(t),s=i.byteLength,a=0;a<s;a++)e+=String.fromCharCode(i[a]);return zt.base64_encode(e)}static Int8parse(t){for(var e=t.length,i=[],s=0;s<e;s++)i[s>>>2]|=(255&t[s])<<24-s%4*8;return CryptoJS.lib.WordArray.create(i,e)}static rsaIntToBytes(t,e){for(var i=t.toByteArray(),s=0;s<i.length&&0==i[s];)++s;if(i.length-s!=e-1||2!=i[s])return null;for(++s;0!=i[s];)if(++s>=i.length)return null;for(var a=[];++s<i.length;){var n=255&i[s];a.push(n)}return a}static createRandom16Bytes(){for(var t=new Int8Array(16),e=0;e<16;e++){var i=Math.floor(65536*Math.random());t[e]=255&i}return t}static paddingBytesTo16Times(t){var e=t instanceof Array?t.length:t.byteLength;if(e%16==0)return new Int8Array(t);var i=new Int8Array(e+16-e%16);if(t instanceof Array)for(var s=0;s<e;s++)i[s]=t[s];else i.set(new Int8Array(t),0);for(s=0;s<16-e%16;s++)i[e+s]=0;return i}static aesEncrypt(t,e){var i=new Laya.Byte;i.endian=Laya.Socket.BIG_ENDIAN;var s=zt.paddingBytesTo16Times(t),a=CRC32.buf(new Uint8Array(t)),n=zt.createRandom16Bytes(),r=CryptoJS.AES.encrypt(zt.Int8parse(s),e,{iv:CryptoJS.lib.WordArray.create(n,16),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.NoPadding}),o=zt.base64ToBytes(r.toString());return i.writeInt32(a),i.writeInt32(t.byteLength),i.writeArrayBuffer(n,0,n.length),i.writeArrayBuffer(o,0,o.length),i.buffer}static aesDecrypt(t,e,i,s,a){var n=CryptoJS.AES.decrypt(zt.byteToBase64String(new Int8Array(s)),a,{iv:CryptoJS.lib.WordArray.create(new Int8Array(i),16),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.NoPadding}),r=zt.hexString2Bytes(n.toString()),o=new Laya.Byte(r).readArrayBuffer(e);return CRC32.buf(new Uint8Array(o))!=t?null:o}}class Jt{constructor(){}static getRequestMap(){var t={};return t["Player.LoginReq"]=[10001,Player.LoginReq],t["Player.LogoutReq"]=[10002,Player.LogoutReq],t["Player.OnlineCrossDayReq"]=[10003,Player.OnlineCrossDayReq],t["Player.FullBagReq"]=[10004,Player.FullBagReq],t["Building.GetAllBuildingReq"]=[10101,Building.GetAllBuildingReq],t["Building.PutBuildingReq"]=[10102,Building.PutBuildingReq],t["Building.RemoveBuildingReq"]=[10103,Building.RemoveBuildingReq],t["Scene.UpdateSceneInfoReq"]=[10201,Scene.UpdateSceneInfoReq],t["Scene.FetchLetterBoxReq"]=[10202,Scene.FetchLetterBoxReq],t["Scene.GetLetterBoxInfoReq"]=[10203,Scene.GetLetterBoxInfoReq],t["Scene.FindVisitorGiftReq"]=[10204,Scene.FindVisitorGiftReq],t["Scene.GetVisitorGiftAllReq"]=[10205,Scene.GetVisitorGiftAllReq],t["Scene.GetVisitorGiftSingleReq"]=[10208,Scene.GetVisitorGiftSingleReq],t["Task.GetAllTasksReq"]=[10301,Task.GetAllTasksReq],t["Task.getDailyTaskRewardReq"]=[10302,Task.getDailyTaskRewardReq],t["Task.getTrophyTaskRewardReq"]=[10303,Task.getTrophyTaskRewardReq],t["Food.GetPlayerFoodMenuReq"]=[10401,Food.GetPlayerFoodMenuReq],t["Food.FoodLevelUpReq"]=[10402,Food.FoodLevelUpReq],t["Pet.GetPlayerPetsInfoReq"]=[10501,Pet.GetPlayerPetsInfoReq],t["Pet.AdoptPetReq"]=[10502,Pet.AdoptPetReq],t["Nautical.GetNauticalInfoReq"]=[10601,Nautical.GetNauticalInfoReq],t["Nautical.MergeNauticalFoodReq"]=[10602,Nautical.MergeNauticalFoodReq],t["Nautical.GetNauticalInfoReq"]=[10603,Nautical.StartNauticalTripReq],t["Nautical.MergeNauticalFoodReq"]=[10604,Nautical.FinishNauticalTripReq],t["FishingGame.GetFishGameInfoReq"]=[10701,FishingGame.GetFishGameInfoReq],t["FishingGame.PlayFishGameReq"]=[10702,FishingGame.PlayFishGameReq],t["FishingGame.GetFishingFishInfoReq"]=[10703,FishingGame.GetFishingFishInfoReq],t}static getResponseMap(){var t={};return t[10001]=["Player.LoginRes",Player.LoginRes],t[10002]=["Player.LogoutRes",Player.LogoutRes],t[10003]=["Player.OnlineCrossDayRes",Player.OnlineCrossDayRes],t[10004]=["Player.FullBagRes",Player.FullBagRes],t[10101]=["Building.GetAllBuildingRes",Building.GetAllBuildingRes],t[10102]=["Building.PutBuildingRes",Building.PutBuildingRes],t[10103]=["Building.RemoveBuildingRes",Building.RemoveBuildingRes],t[10201]=["Scene.UpdateSceneInfoRes",Scene.UpdateSceneInfoRes],t[10202]=["Scene.FetchLetterBoxRes",Scene.FetchLetterBoxRes],t[10203]=["Scene.GetLetterBoxInfoRes",Scene.GetLetterBoxInfoRes],t[10204]=["Scene.FindVisitorGiftRes",Scene.FindVisitorGiftRes],t[10205]=["Scene.GetVisitorGiftAllRes",Scene.GetVisitorGiftAllRes],t[10208]=["Scene.GetVisitorGiftSingleRes",Scene.GetVisitorGiftSingleRes],t[10301]=["Task.GetAllTasksRes",Task.GetAllTasksRes],t[10302]=["Task.getDailyTaskRewardRes",Task.getDailyTaskRewardRes],t[10303]=["Task.getTrophyTaskRewardRes",Task.getTrophyTaskRewardRes],t[10401]=["Food.GetPlayerFoodMenuRes",Food.GetPlayerFoodMenuRes],t[10402]=["Food.FoodLevelUpRes",Food.FoodLevelUpRes],t[10501]=["Pet.GetPlayerPetsInfoRes",Pet.GetPlayerPetsInfoRes],t[10502]=["Pet.AdoptPetRes",Pet.AdoptPetRes],t[10601]=["Nautical.GetNauticalInfoRes",Nautical.GetNauticalInfoRes],t[10602]=["Nautical.MergeNauticalFoodRes",Nautical.MergeNauticalFoodRes],t[10603]=["Nautical.StartNauticalTripRes",Nautical.StartNauticalTripRes],t[10604]=["Nautical.FinishNauticalTripRes",Nautical.FinishNauticalTripRes],t[10701]=["FishingGame.GetFishGameInfoRes",FishingGame.GetFishGameInfoRes],t[10702]=["FishingGame.PlayFishGameRes",FishingGame.PlayFishGameRes],t[10703]=["FishingGame.GetFishingFishInfoRes",FishingGame.GetFishingFishInfoRes],t}static getNotifyProtoMap(){var t={};return t[1001]=["PlayerPushMsg.TestMsg",PlayerPushMsg.TestMsg],t[1002]=["PlayerPushMsg.ReddotMsg",PlayerPushMsg.ReddotMsg],t}}class Zt{constructor(){this._protoBuf=protobuf,this._requestProtoIDs=Jt.getRequestMap(),this._responseProtoIDs=Jt.getResponseMap(),this._notifyProtoIDs=Jt.getNotifyProtoMap(),this._loadedHandler=null,this._eventDispatcher=new Laya.EventDispatcher}static getInstance(){return Zt.instance?Zt.instance:Zt.instance=new Zt}init(t){this._loadedHandler=t,null!=this._loadedHandler&&this._loadedHandler.run()}getOpcode(t){return this._requestProtoIDs[t][0]}encodeRequest(t,e){var i=this._requestProtoIDs[t][1];if(!i)return console.error("没有找到协议信息: "+t),null;var s=i.verify(e);if(s)throw Error(s);return i.encode(e).finish()}decodeResponse(t,e){var i=this._responseProtoIDs[t][0];if(!i)return console.error("没有ID为: "+t+" 的协议！"),null;var s=this._responseProtoIDs[t][1];return s?s.decode(e):(console.error("没有找到协议信息: "+i),null)}decodeNotify(t,e){var i=this._notifyProtoIDs[t][0];if(!i)return console.error("没有ID为: "+t+" 的协议！"),null;var s=this._notifyProtoIDs[t][1];return s?s.decode(e):(console.error("没有找到协议信息: "+i),null)}encodeNotify(t,e){var i=this._notifyProtoIDs[t][0];if(!i)return console.error("没有ID为: "+t+" 的协议！"),null;var s=this._notifyProtoIDs[t][1];if(!s)return console.error("没有找到协议信息: "+i),null;var a=s.verify(e);if(a)throw Error(a);return s.encode(e).finish()}registerNotifyCallback(t,e,i,s){this._eventDispatcher.offAll("NotifyCallback_"+t),this._eventDispatcher.on("NotifyCallback_"+t,e,i,s)}handlerNotify(t,e){this._eventDispatcher.event("NotifyCallback_"+t,e)}}class Yt{constructor(t,e,i){this._requestName=t,this._param=e,this._handler=i,this._buffer=null}getRequestName(){return this._requestName}getParam(){return this._param}getHandler(){return this._handler}setBuffer(t){this._buffer=t}getBuffer(){return this._buffer}}class Qt{constructor(){this._initFinished=!1,this._waitInitHandlers=new Array,this._connectReady=!1,this._heartTimer=Laya.timer,this._socket=new Laya.Socket,this._socket.endian=Laya.Socket.BIG_ENDIAN,this._socket.on(Laya.Event.OPEN,this,this._openHandler),this._socket.on(Laya.Event.MESSAGE,this,this._receiveHandler),this._socket.on(Laya.Event.CLOSE,this,this._closeHandler),this._socket.on(Laya.Event.ERROR,this,this._errorHandler),this._msgId=0,this._waitSendRequests=new Array,this._sendingRequest=null}static getInstance(){return Qt.instance?Qt.instance:Qt.instance=new Qt}init(t){this._protoManager=Zt.getInstance(),this._protoManager.init(t)}initFinish(){for(this._initFinished=!0,console.debug("==== init web socket finish!!!");this._waitInitHandlers.length>0;){let t=this._waitInitHandlers.shift();null!=t&&(console.debug("==== waiting init handler run: "),console.debug(t),t.run())}}login(t,e,i){if(this._initFinished)console.debug("========= login ========="),this._rid=e.rid,this._token=e.token,this._sdkName=e.sdkName,this._socket.connectByUrl(t),this._loginHandler=i,this._loginUrl=t;else{console.debug("not finished, register login handler");var s=new Array(t,e,i);this._waitInitHandlers.push(Laya.Handler.create(this,this.login,s))}}reconnect(t){this._rid&&this._aesKey&&this._loginUrl?(console.debug("========= reconnect ========="),this._socket.connectByUrl(this._loginUrl),this._reconnecting=!0,this._reconnectedHandler=t):console.log("rid or loginUrl or aesKey not init")}logout(){this._connectReady=!1,this._heartTimer.clear(this,this._onHeartBeat),this._socket.cleanSocket(),this._socket.close(),this._clearNetStatus(),a.getInstance().postEvent("LOGOUT")}sendRequest(t,e,i){if(this._initFinished){if(this._reconnecting){var s=new Array;return s[0]=c.NetError,void i.runWith(s)}if(this._connectReady){var a=new Yt(t,e,i);null!=this._sendingRequest?(console.log("----- current sending msg: "+this._msgId+", requestName: "+t),console.log(this._sendingRequest),this._waitSendRequests.push(a),console.log(this._waitSendRequests)):this._oncePopReq(a)}else{i=Laya.Handler.create(this,this.sendRequest,Array.from(arguments));this.reconnect(i)}}else{console.debug("not finished, register send request handler");var n=new Array(t,e,i);this._waitInitHandlers.push(Laya.Handler.create(this,this.sendRequest,n))}}_oncePopReq(t){console.debug("===== send request ===== "+t.getRequestName());let e=t.getRequestName(),i=t.getParam();t.getHandler();var s=this._protoManager.getOpcode(e),a=this._protoManager.encodeRequest(e,i),n=new Laya.Byte;n.endian=Laya.Socket.BIG_ENDIAN,n.writeByte(Qt.RequestData),this._msgId++,n.writeInt32(this._msgId),n.writeInt32(s);var r=zt.stringToByte(this._rid);n.writeByte(r.length),n.writeArrayBuffer(r,0,r.length),n.writeInt32(a.length),n.writeArrayBuffer(a,0,a.length);var o=zt.aesEncrypt(n.buffer,this._aesKey),h=new Laya.Byte;h.endian=Laya.Socket.BIG_ENDIAN,h.writeByte(Qt.DataMsg),h.writeInt32(o.byteLength),h.writeArrayBuffer(o,0,o.byteLength),t.setBuffer(h.buffer),this._sendingRequest=t,Laya.timer.once(1e4,this,this._reqTimeout),this._socket.send(h.buffer)}_reqTimeout(){console.log("........ req timeout ......."),null!=this._sendingRequest&&null!=this._sendingRequest.getBuffer()&&(this._socket.send(this._sendingRequest.getBuffer()),Laya.timer.once(1e4,this,this._reqTimeout))}_openHandler(t){if(this._rid)if(this._reconnecting){(r=new Laya.Byte).endian=Laya.Socket.BIG_ENDIAN;var e=zt.stringToByte(this._rid);r.writeByte(e.length),r.writeArrayBuffer(e,0,e.length);var i=zt.paddingBytesTo16Times(e),s=zt.createRandom16Bytes(),a=CryptoJS.AES.encrypt(zt.Int8parse(i),this._aesKey,{iv:CryptoJS.lib.WordArray.create(s,16),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.NoPadding}),n=zt.base64ToBytes(a.toString());r.writeArrayBuffer(s,0,s.length),r.writeInt32(e.length),r.writeArrayBuffer(n,0,n.length),(o=new Laya.Byte).endian=Laya.Socket.BIG_ENDIAN,o.writeByte(Qt.ReconnectMsg),o.writeInt32(r.buffer.byteLength),o.writeArrayBuffer(r.buffer,0,r.buffer.byteLength),this._socket.send(o.buffer),this._socket.flush(),this._connectReady=!0,console.log("reconnect success")}else{var r;(r=new Laya.Byte).endian=Laya.Socket.BIG_ENDIAN;e=zt.stringToByte(this._rid);r.writeByte(e.length),r.writeArrayBuffer(e,0,e.length),this._rsaKey=new JSEncrypt,this._rsaDataLength=this._rsaKey.getKey().n.bitLength()+7>>3;var o,h=zt.base64ToBytes(this._rsaKey.getPublicKeyB64());r.writeInt16(h.length),r.writeArrayBuffer(h,0,h.length),(o=new Laya.Byte).endian=Laya.Socket.BIG_ENDIAN,o.writeByte(Qt.ConnectMsg),o.writeInt32(r.buffer.byteLength),o.writeArrayBuffer(r.buffer,0,r.buffer.byteLength),this._socket.send(o.buffer),this._socket.flush(),this._connectReady=!0}else console.debug("Not have rid")}_receiveHandler(t){var e=new Laya.Byte;e.writeArrayBuffer(t),e.pos=0,e.endian=Laya.Socket.BIG_ENDIAN;var i=e.getByte(),s=e.getInt32(),a=e.readArrayBuffer(s);switch(i){case Qt.EstablishMsg:console.debug("连接成功"),this._heartTimer.clear(this,this._onHeartBeat),this._heartTimer.loop(1e4,this,this._onHeartBeat);var n=this._rsaKey.decrypt(zt.byteToBase64String(new Int8Array(a))),r=new Laya.Byte(zt.rsaIntToBytes(n,this._rsaDataLength));r.endian=Laya.Socket.BIG_ENDIAN;var o=r.getInt16(),h=r.readArrayBuffer(o);this._aesKey=zt.Int8parse(new Int8Array(h)),this._reconnecting?(this._reconnecting=!1,null!=this._reconnectedHandler&&this._reconnectedHandler.run()):this.sendRequest("Player.LoginReq",{rid:this._rid,token:this._token,sdkName:this._sdkName},this._loginHandler);break;case Qt.DataMsg:let t=new Laya.Byte(a);t.endian=Laya.Socket.BIG_ENDIAN;let e=t.getUint32(),l=t.readInt32(),c=t.readArrayBuffer(16),d=t.readArrayBuffer(s-4-4-16),g=new Laya.Byte(zt.aesDecrypt(e,l,c,d,this._aesKey));g.endian=Laya.Socket.BIG_ENDIAN;let p=g.getByte();if(p==Qt.ResponseData){let t=g.readInt32(),e=g.readUint32(),i=g.readUint32();u.updateServerTime(4294967296*e+i);let s=g.readInt32(),a=g.readInt32(),n=new Uint8Array(g.readArrayBuffer(a));this._handlerResponse(t,n,s)}else if(p==Qt.NotifyData){let t=g.readInt32(),e=g.readInt32(),i=new Uint8Array(g.readArrayBuffer(e));this._handlerNotify(t,i)}else console.debug("error msg type: "+p);break;case Qt.ErrorMsg:let I=new Laya.Byte(a);I.endian=Laya.Socket.BIG_ENDIAN;let m=I.getInt32();console.log("*********** "+m+" **********"),1030==m&&(console.log("===== network disconnect ====="),this._clearNetStatus(),this.showMultiLoginTip())}}showMultiLoginTip(){Laya.Dialog.open("ui/MultiLogin.scene",!1)}_closeHandler(t){console.log("------ socket close ------"),this._connectReady&&(this._connectReady=!1,this.reconnect(null),this._heartTimer.clear(this,this._onHeartBeat))}_errorHandler(t){console.log("------- socket error ------"),this._connectReady=!1,this._reconnecting&&(a.getInstance().postEvent("NETWORD_DISCONNECT"),console.log("===== network disconnect ====="),this._clearNetStatus())}_clearNetStatus(){console.log("===== clear net status ======"),this._aesKey=null,this._rsaKey=null,this._connectReady=!1,this._loginUrl=null,this._reconnecting=!1,this._rid=null,this._msgId=0,this._sendingRequest=null}_onHeartBeat(){if(console.log("------- heart beat -------"),this._connectReady){var t=new Laya.Byte;t.endian=Laya.Byte.BIG_ENDIAN,t.writeByte(Qt.HeartbeatMsg),t.writeInt32(0),this._socket.send(t.buffer),this._socket.flush()}else this.reconnect(null),this._heartTimer.clear(this,this._onHeartBeat)}_handlerResponse(t,e,i){if(this._msgId==t&&null!=this._sendingRequest){var s=this._protoManager.getOpcode(this._sendingRequest.getRequestName()),a=new Array;a[0]=i,0==a[0]?a[1]=this._protoManager.decodeResponse(s,e):a[1]={},this._sendingRequest.getHandler().runWith(a),this._sendingRequest=null,Laya.timer.clear(this,this._reqTimeout),this._waitSendRequests.length>0&&this._oncePopReq(this._waitSendRequests.shift())}else console.error("!!!!! msgId wrong or sending request is null: "+t),console.error(this._msgId),console.error(this._sendingRequest)}_handlerNotify(t,e){var i=this._protoManager.decodeNotify(t,e);console.debug(i),this._protoManager.handlerNotify(t,i)}}Qt.ConnectMsg=33,Qt.DataMsg=34,Qt.HeartbeatMsg=35,Qt.EstablishMsg=52,Qt.ErrorMsg=53,Qt.ReconnectMsg=65,Qt.RequestData=1,Qt.ResponseData=2,Qt.NotifyData=3;class $t{static init(t){Qt.getInstance().init(Laya.Handler.create(null,function(){Qt.getInstance().initFinish();const e=Array.from(arguments);t.runWith(e)}))}static sendRequest(t,e,i,s){Qt.getInstance().sendRequest(t,e,Laya.Handler.create(null,function(){const t=Array.from(arguments);0!=t[0]?null!=s&&null!=s?s.runWith(t[0]):console.error("Error Number:"+t[0]):i.runWith(t.slice(1))}))}static login(t,e,i,s,a){let n="dev";Laya.Browser.onMiniGame&&(n="wx"),Qt.getInstance().login(t,{rid:i,sdkName:n,token:s},Laya.Handler.create(null,function(){const t=Array.from(arguments);0!=t[0]?console.error("Error Number:"+t[0]):a.runWith(t.slice(1))}))}static registerNotifyCallback(t,e,i,s){Zt.getInstance().registerNotifyCallback(t,e,i,s)}static logout(t){$t.sendRequest("Player.LogoutReq",{},t)}static onlineCrossDay(t){$t.sendRequest("Player.OnlineCrossDayReq",{},t)}static getFullBag(t){$t.sendRequest("Player.FullBagReq",{},t)}static getAllBuilding(t){$t.sendRequest("Building.GetAllBuildingReq",{},t)}static putBuilding(t,e,i){$t.sendRequest("Building.PutBuildingReq",{buildingId:t,pos:e},i)}static removeBuilding(t,e){$t.sendRequest("Building.RemoveBuildingReq",{buildingId:t},e)}static getAllTasks(t){$t.sendRequest("Task.GetAllTasksReq",{},t)}static getDailyTaskReward(t,e){$t.sendRequest("Task.getDailyTaskRewardReq",{taskId:t},e)}static getTrophyTaskReward(t,e){$t.sendRequest("Task.getTrophyTaskRewardReq",{taskId:t},e)}static getPlayerFoodMenu(t){$t.sendRequest("Food.GetPlayerFoodMenuReq",{},t)}static foodLevelUp(t,e){$t.sendRequest("Food.FoodLevelUpReq",{foodListId:t},e)}static getLetterBoxInfo(t){$t.sendRequest("Scene.GetLetterBoxInfoReq",{},t)}static fetchLetterBox(t){$t.sendRequest("Scene.FetchLetterBoxReq",{},t)}static updateSceneInfo(t,e,i,s,a){i?$t.sendRequest("Scene.UpdateSceneInfoReq",{customData:t,rewards:e,petRewards:i,visitorRewards:s},a):$t.sendRequest("Scene.UpdateSceneInfoReq",{customData:t,rewards:e,visitorRewards:s},a)}static getPetsInfo(t){$t.sendRequest("Pet.GetPlayerPetsInfoReq",{},t)}static adoptPet(t,e){$t.sendRequest("Pet.AdoptPetReq",{roleId:t},e)}static findVisitorGift(t){$t.sendRequest("Scene.FindVisitorGiftReq",{},t)}static getVisitorGiftAll(t,e){$t.sendRequest("Scene.GetVisitorGiftAllReq",{type:t},e)}static getVisitorGiftSingle(t,e){$t.sendRequest("Scene.GetVisitorGiftSingleReq",{id:t},e)}static getNauticalInfo(t){$t.sendRequest("Nautical.GetNauticalInfoReq",{},t)}static mergeNauticalFood(t,e,i){$t.sendRequest("Nautical.MergeNauticalFoodReq",{id:String(t),amount:Number(e)},i)}static startNauticalTrip(t,e){$t.sendRequest("Nautical.MergeNauticalFoodReq",t,e)}static finishNauticalTrip(t){$t.sendRequest("Nautical.FinishNauticalTripReq",{},t)}static getFishGameInfo(t){$t.sendRequest("FishingGame.GetFishGameInfoReq",{},t)}static playFishGame(t,e,i,s,a,n){$t.sendRequest("FishingGame.PlayFishGameReq",{fishingFishId:t,fishingBaitId:e,rewards:i,fishingFishSize:s},a,n)}static getFishingFishInfo(t){$t.sendRequest("FishingGame.GetFishingFishInfoReq",{},t)}}let te,ee,ie="ws://49.232.18.82:14002/gs2",se="2",ae="dev";class ne{static init(){null==ne.inited&&(ne.inited=!0,a.getInstance().registEvent("NETWORD_DISCONNECT",null,ne.restart),a.getInstance().registEvent("SERVICE_ONLINE_CROSSDAY",null,ne.onlineCrossDay),a.getInstance().registEvent("SERVICE_PUT_BUILDING",null,ne.putBuilding),a.getInstance().registEvent("SERVICE_GET_ALLTASKS",null,ne.getAllTasks),a.getInstance().registEvent("SERVICE_GET_TROPHY_TASK_REWARD",null,ne.getTrophyTaskReward),a.getInstance().registEvent("SERVICE_GET_DAILY_TASK_REWARD",null,ne.getDailyTaskReward),a.getInstance().registEvent("SERVICE_GET_PLAYER_FOOD_MENU",null,ne.getPlayerFoodMenu),a.getInstance().registEvent("SERVICE_FOOD_LEVELUP",null,ne.foodLevelUp),a.getInstance().registEvent("SERVICE_UPDATE_SCENE_INFO",null,ne.updateSceneInfo),a.getInstance().registEvent("SERVICE_GET_LETTER_BOX_INFO",null,ne.getLetterBoxInfo),a.getInstance().registEvent("SERVICE_FETCH_LETTER_BOX",null,ne.fetchLetterBox),a.getInstance().registEvent("SERVICE_GET_PETSINFO",null,ne.getPetsInfo),a.getInstance().registEvent("SERVICE_ADOPT_PET",null,ne.adoptPet),a.getInstance().registEvent("SERVICE_FIND_VISITOR_GIFT",null,ne.findVisitorGift),a.getInstance().registEvent("SERVICE_GET_VISITOR_GIFT_ALL",null,ne.getVisitorGiftAll),a.getInstance().registEvent("SERVICE_GET_VISITOR_GIFT_SINGLE",null,ne.getVisitorGiftSingle),a.getInstance().registEvent("SERVICE_GET_FISHING_COLLECTS",null,ne.getFishingFishInfo),a.getInstance().registEvent("SERVICE_GET_FISHING_BASE_INFO",null,ne.getFishGameInfo),a.getInstance().registEvent("SERVICE_FINISH_FISHING_GAME",null,ne.playFishGame),a.getInstance().registEvent("SERVICE_GET_NAUTICAL_INFO",null,ne.getNauticalInfo),a.getInstance().registEvent("SERVICE_MERGE_NAUTICAL_FOOD",null,ne.mergeNauticalFood),a.getInstance().registEvent("SERVICE_START_NAUTICAL_TRIP",null,ne.startNauticalTrip),a.getInstance().registEvent("SERVICE_FINISH_NAUTICAL_TRIP",null,ne.finishNauticalTrip),N.init(),O.init(),p.init(),rt.init(),lt.init(),dt.init(),L.init(),Vt.init(),bt.init())}static restart(){ne.clear(),Laya.Browser.window.location.reload()}static clear(){N.clear(),O.clear(),rt.clear(),Vt.clear(),bt.clear(),R.clear()}static setRid(t){te=t}static getRid(){return Laya.Browser.onMiniGame?te:te+"_"+se}static setToken(t){ae=t}static getToken(){return ae}static setServerTag(t){ee=t}static getServerTag(){return ee}static getServerUrl(){return Laya.Browser.onMiniGame?"wss://fy.hulai.com:17305"+ee:ie}static _updateCurrencyBag(t){if(t){let e=t.currency;Object.getOwnPropertyNames(e).forEach(function(t){let i=e[t],s=i.id,a=i.amount;s==c.RewardType.FISH?N.updateFish(a):s==c.RewardType.STAR&&N.updateStar(a)})}}static _updateFullBag(t){t&&t.currency&&ne._updateCurrencyBag(t)}static _initBuilding(t){if(t){let e=t.buildings;Object.getOwnPropertyNames(e).forEach(function(t){let i=e[t],s=i.id,a=i.position;a?O.replaceBuildingData(s,a):O.addBuildingDataByBid(s)})}}static _updateBuilding(t){O.clear(),ne._initBuilding(t)}static _updatePets(t){t&&t.cats&&bt.updatePets(t.cats)}static _updateTasks(t){t&&lt.updateTasks(t)}static _updateFoods(t){t&&rt.updateFoods(t)}static _updateVisitorGift(t){t&&L.updateVisitorGift(t)}static _updateLetterBox(t){t&&L.updateLetterBox(t)}static _restoreCustomData(t){L.restoreCustomData(t)}static _updateFishGameInfo(t){R.updateBaseData(t)}static _updateFishCollectInfo(t){R.updateCollectData(t)}static _testNotify(){}static _reddotNotify(t){t&&t.type&&(t.type==c.RedDotType.kTask&&lt.setDirty(1),dt.refreshRedPoint(t.type))}static initService(t){ne.init(),$t.init(t),$t.registerNotifyCallback(1001,null,ne._testNotify),$t.registerNotifyCallback(1002,null,ne._reddotNotify)}static login(t,e){let i=function(i){let s=i.bag,a=i.playerBuilding,n=(i.playerPets,i.tasks),r=i.menu,o=i.letterbox,h=i.customData,l=i.fishingGameInfo;ne._updateCurrencyBag(s),ne._initBuilding(a),ne._updatePets(i.playerPets),ne._updateTasks(n),ne._updateFoods(r),ne._updateLetterBox(o),ne._restoreCustomData(h),ne._updateFishGameInfo(l),e&&(Laya.LocalStorage.setItem("user_rid",t),e.runWith([i])),L.scheduleUpdate()};Laya.Browser.onMiniGame?wx.login({success(t){t.code?wx.request({url:"https://fy.hulai.com:17305/gatew",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:"opCode=110001&params={'sdkName': 'wx', 'param':'"+t.code+"'}",success(t){let e=JSON.parse(t.data.data);console.debug("登录发送code服务器返回:"+JSON.stringify(e)),console.debug(e),ne.setToken(e.token),ne.setRid(e.rid),ne.setServerTag(e.gameserverUrl),$t.login(ne.getServerUrl(),"1",ne.getRid(),ne.getToken(),Laya.Handler.create(null,i))},fail(){console.debug("登录发送code服务器返回失败!!!")}}):console.log("登录失败！"+t.errMsg)}}):(ne.setRid(t),$t.login(ne.getServerUrl(),se,ne.getRid(),ne.getToken(),Laya.Handler.create(null,i)))}static onlineCrossDay(t){$t.onlineCrossDay(Laya.Handler.create(null,function(e){let i=e.bag,s=e.tasks;ne._updateCurrencyBag(i),ne._updateTasks(s),t&&t.runWith([e])}))}static getFullBag(t){$t.getFullBag(Laya.Handler.create(null,function(e){let i=e.bag;ne._updateFullBag(i),t&&t.runWith([e])}))}static getAllBuilding(t){$t.getAllBuilding(Laya.Handler.create(null,function(e){let i=e.bag,s=e.playerBuilding;ne._updateCurrencyBag(i),ne._updateBuilding(s),t&&t.runWith([e])}))}static putBuilding(t,e,i){$t.putBuilding(t,e,Laya.Handler.create(null,function(t){let e=t.bag,s=t.letterbox;ne._updateCurrencyBag(e),ne._updateLetterBox(s),i&&i.runWith([t])}))}static removeBuilding(t,e){$t.removeBuilding(t,Laya.Handler.create(null,function(t){let i=t.bag;ne._updateCurrencyBag(i),e&&e.runWith([t])}))}static getAllTasks(t){$t.getAllTasks(Laya.Handler.create(null,function(e){e&&ne._updateTasks(e.tasks),t&&t.runWith([e])}))}static getDailyTaskReward(t,e){$t.getDailyTaskReward(t,Laya.Handler.create(null,function(t){let i=t.tasks,s=t.bag;t.rewards;ne._updateTasks(i),ne._updateCurrencyBag(s),e&&e.runWith([t])}))}static getTrophyTaskReward(t,e){$t.getTrophyTaskReward(t,Laya.Handler.create(null,function(t){let i=t.tasks,s=t.bag;t.rewards;ne._updateTasks(i),ne._updateCurrencyBag(s),e&&e.runWith([t])}))}static getPlayerFoodMenu(t){$t.getPlayerFoodMenu(Laya.Handler.create(null,function(e){e&&ne._updateFoods(e.menu),t&&t.runWith([e])}))}static foodLevelUp(t,e){$t.foodLevelUp(t,Laya.Handler.create(null,function(t){let i=t.menu,s=t.bag;ne._updateFoods(i),ne._updateFullBag(s),e&&e.runWith([t])}))}static getLetterBoxInfo(t){$t.getLetterBoxInfo(Laya.Handler.create(null,function(e){let i=e.letterbox;ne._updateLetterBox(i),t&&t.runWith([e])}))}static fetchLetterBox(t){$t.fetchLetterBox(Laya.Handler.create(null,function(e){let i=e.bag,s=e.letterbox;ne._updateCurrencyBag(i),ne._updateLetterBox(s),t&&t.runWith([e])}))}static updateSceneInfo(t,e,i,s,a){$t.updateSceneInfo(t,e,i,s,Laya.Handler.create(null,function(t){let e=t.bag,i=t.letterbox;ne._updateCurrencyBag(e),ne._updateLetterBox(i),L.dropCache(),a&&a.runWith([t])}))}static getPetsInfo(t){$t.getPetsInfo(Laya.Handler.create(null,function(e){let i=e.playerPets;ne._updatePets(i),t&&t.runWith([e])}))}static adoptPet(t,e){$t.adoptPet(t,Laya.Handler.create(null,function(i){bt.doAdoptPet(t),e&&e.runWith([i])}))}static findVisitorGift(t){$t.findVisitorGift(Laya.Handler.create(null,function(e){let i=e.visitorRewards;ne._updateVisitorGift(i),t&&t.runWith([e])}))}static getVisitorGiftAll(t,e){$t.getVisitorGiftAll(t,Laya.Handler.create(null,function(t){let i=t.bag;t.rewards;ne._updateCurrencyBag(i),L.clearVisitorGift(),e&&e.runWith([t])}))}static getVisitorGiftSingle(t,e){$t.getVisitorGiftSingle(t,Laya.Handler.create(null,function(t){let i=t.bag,s=(t.rewards,t.visitorRewards);ne._updateCurrencyBag(i),ne._updateVisitorGift(s),e&&e.runWith([t])}))}static getNauticalInfo(t){$t.getNauticalInfo(Laya.Handler.create(null,function(e){let i=e.nauticalInfo,s=e.petIds,a=e.nauticalFoods,n=e.nauticalTools;Xt.updateAll(i,s,a,n),t&&t.runWith([e])}))}static mergeNauticalFood(t,e,i){$t.mergeNauticalFood(t,e,Laya.Handler.create(null,function(t){let e=t.bag;ne._updateFullBag(e),i&&i.runWith([t])}))}static startNauticalTrip(t,e){$t.startNauticalTrip(t,Laya.Handler.create(null,function(t){let i=t.nauticalInfo;Xt.updateNauticalInfo(i),e&&e.runWith([t])}))}static finishNauticalTrip(t){$t.finishNauticalTrip(Laya.Handler.create(null,function(e){let i=e.bag;e.rewards;ne._updateFullBag(i),t&&t.runWith([e])}))}static getFishGameInfo(t){$t.getFishGameInfo(Laya.Handler.create(null,function(e){let i=e.bag,s=e.gameInfo;ne._updateCurrencyBag(i),ne._updateFishGameInfo(s),t&&t.runWith([e])}))}static playFishGame(t,e,i,s,a,n){$t.playFishGame(t,e,i,s,Laya.Handler.create(null,function(t){let e=t.bag,i=t.gameInfo;t.actualRewards;ne._updateCurrencyBag(e),ne._updateFishGameInfo(i),a&&a.runWith([t])}),n)}static getFishingFishInfo(t){$t.getFishingFishInfo(Laya.Handler.create(null,function(e){e.fishInfos;ne._updateFishCollectInfo(e.fishInfos),t&&t.runWith([e])}))}}class re{constructor(){this.taskInfo=null,this.completeHandler=null,this.state=0}start(){this.state=1,this.processTask()}setTaskInfo(t){this.taskInfo=t}processTask(){if(console.debug("开始任务------------\x3e"),console.debug(this.taskInfo),"scenePath"==this.taskInfo.type)return g.getInstance().load(),void(this.state=2);"config"!=this.taskInfo.type?"image"==this.taskInfo.type&&(new Laya.Sprite).loadImage(this.taskInfo.source1,Laya.Handler.create(this,function(){console.debug("加载图片:"+String(this.taskInfo.source1)),this.state=2})):r.getInstance().loadConfig(this.taskInfo.source1,Laya.Handler.create(this,function(){console.debug("加载数据表:"+String(this.taskInfo.source1)),this.state=2}))}getState(){return this.state}}class oe{constructor(){this.taskInfos=new Array,this.processHandler=null,this.completeHandler=null,this.taskIndex=0,this.taskMaxLength=0}addTaskInfo(t){let e=new re;e.setTaskInfo(t),this.taskInfos.push(e),this.taskMaxLength=this.taskInfos.length}setHandler(t,e){this.processHandler=t,this.completeHandler=e}update(){if(0!=this.taskInfos.length){let t=this.taskInfos[0];if(1==t.getState())return;if(2==t.getState())return this.taskIndex++,this.taskInfos.splice(0,1),console.debug("结束任务------------\x3e"),console.debug(t),void(this.processHandler&&this.processHandler.runWith([this.taskIndex,this.taskMaxLength]));0==t.getState()&&t.start()}else this.completeHandler&&this.completeHandler.run()}start(){Laya.timer.loop(10,this,this.update)}}class he{constructor(){this.configs=null}static getInstance(){return he.instance?he.instance:he.instance=new he}reset(){this.configArray=r.getInstance().getConfigList(),this.configSize=r.getInstance().getConfigCount()}start(t){this.reset(),Laya.Dialog.open("ui/LoadingDlg.scene",!1,null,Laya.Handler.create(this,function(e){this.loadingUI=e,this.loadingUI.setStyle(1);let i=new oe;i.addTaskInfo({type:"scenePath"});for(let t=0;t<this.configSize;t++){let e=this.configArray[t];i.addTaskInfo({type:"config",source1:e})}i.addTaskInfo({type:"image",source1:"component_coffee/denglong_1.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/denglong_2.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/denglong_3.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/denglong_4.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/ditan_1.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/ditan_2.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/ditan_3.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/ditan_4.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/guitai_1.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/guitai_2.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/guitai_3.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/letter_box_dialog.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maojia_1.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maojia_2.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maojia_3.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maowo1_1.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maowo1_2.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maowo2_1.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maowo2_2.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maowo3_1.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maowo3_2.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maowo4_1.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maowo4_2.png"}),i.addTaskInfo({type:"image",source1:"component_coffee/maowo5.png"}),this.loadingUI.setMaxValue(i.taskMaxLength),i.setHandler(Laya.Handler.create(this,function(t){this.loadingUI.setValue(t)},null,!1),Laya.Handler.create(this,function(){null!=t&&(this.loadingUI=null,t.run(),Laya.Dialog.close("ui/LoadingDlg.scene"))})),i.start()}))}}class le extends Laya.Scene{constructor(){super(),this.sceneId=0}onEnable(){this.input=this.getChildByName("input"),this.getChildByName("loginButton").on(Laya.Event.CLICK,this,this.onLoginClick);let t=Laya.LocalStorage.getItem("user_rid");null!=t&&""!=t&&(this.input.text=t)}onLoginClick(){let t=this.input.text;t?ne.login(t,Laya.Handler.create(this,this.onLogin)):a.getInstance().postEvent("SHOW_TIPS","请输入账号"),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onLogin(){m.getInstance().switchScene(c.CoffeeSceneId,Laya.Handler.create(this,function(t){m.getInstance().loadScene(c.BeachSceneId,Laya.Handler.create(this,function(t){t.visible=!1,Laya.SoundManager.stopSound("sound/beachWave.mp3")}))}))}}class ce extends Laya.Dialog{constructor(){super(),this.showPetId=""}onEnable(){this.show=this.getChildByName("show"),this.text=this.getChildByName("text"),this.text.text="",this.button=this.getChildByName("adopt"),this.button.visible=!1,this.button.on(Laya.Event.CLICK,this,this.onAdoptPet),this.number=this.getChildByName("number"),this.times=this.getChildByName("times"),this.showVisitTimes(0),this.heart1=this.getChildByName("heart1").getChildByName("red"),this.heart2=this.getChildByName("heart2").getChildByName("red"),this.heart3=this.getChildByName("heart3").getChildByName("red"),this.showIntimacyGrade(0),this.getChildByName("close").on(Laya.Event.CLICK,this,this.onCloseClick),this.findDefaultShow();let t=r.getInstance().getConfig("Role"),e=new Array;t.forEach((t,i)=>{e.push(i)}),this.list.array=e,a.getInstance().registEvent("UPDATE_PETS",this,this.updatePets)}isShowPetId(t){return this.showPetId==t}findDefaultShow(){if(""!=this.showPetId)return;let t=r.getInstance().getConfig("Role");for(const[e,i]of t){let t=bt.getPetInfo(e);if(null!=t&&t.getVisitTimes()>0){this.showPetId=e;break}}}findTargetCell(t){for(const e of this.list.cells)if(e.dataSource==t)return e;return null}onCloseClick(){bt.clearAllRedPoint(),a.getInstance().postEvent("REDPOINT_REFRESH",["collect"]),this.close(),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onDisable(){a.getInstance().removeEvent("UPDATE_PETS",this,this.updatePets)}updatePets(){this.list.refresh()}showPet(t){null!=this.cat&&(this.cat.stop(),this.cat.destroy(!0)),this.cat=new Laya.Skeleton,this.show.addChild(this.cat),this.cat.x=this.show.width/2,this.cat.y=this.show.height/2,this.cat.load(t.getSource()+".sk",Laya.Handler.create(this,function(){this.cat.play(t.getDefaultAction(),!0)})),this.text.text=K.get(t.getName()),this.button.visible=t.canAdopt();let e=this.button.getChildByName("redPoint");t.needRedPoint()?e.visible=!0:e.visible=!1;let i=t.getVisitTimes();i>99999&&(i=99999),this.showVisitTimes(i);let s=t.getIntimacyGrade();this.showIntimacyGrade(s)}showVisitTimes(t){this.number.value=t,this.times.x=625+60*t.toString().length}showIntimacyGrade(t){this.heart1.visible=!1,this.heart2.visible=!1,this.heart3.visible=!1,t>0&&(this.heart1.visible=!0),t>1&&(this.heart2.visible=!0),t>2&&(this.heart3.visible=!0)}changeShowPet(t){if(t.getSource()==this.showPetId)return;let e=this.findTargetCell(this.showPetId);null!=e&&e.updateSelected(!1),this.showPetId=t.getId(),this.showPet(t)}onAdoptPet(){if(""==this.showPetId)return void console.error("show pet id is empty!!!");if(!bt.getPetInfo(this.showPetId).canAdopt())return void console.log("pet ["+this.showPetId+"] can not adopt");let t=Laya.Handler.create(this,function(){this.button.visible=!1,bt.getPetInfo(this.showPetId).setAdopted(!0),bt.getPetInfo(this.showPetId).setRedPointStatus(2),this.findTargetCell(this.showPetId).clearRedPoint()});ne.adoptPet(this.showPetId,t),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}}class de extends Laya.List{constructor(){super(),this.vScrollBarSkin="",this.renderHandler=Laya.Handler.create(this,this.updateItem,null,!1)}onSelect(t){}updateItem(t,e){t.setItem(t.dataSource)}}class ge extends Laya.Sprite{constructor(){super()}setItem(t){this.petId=t,this.pet=bt.getPetInfo(this.petId),this.normalPic=this.pet.getNormalPic(),this.grayPic=this.pet.getGrayPic();let e=this.getChildByName("image");this.pet.getVisitTimes()>0?(e.skin=this.normalPic,this.on(Laya.Event.CLICK,this,function(){this.parent.parent.parent.isShowPetId(this.petId)||(this.parent.parent.parent.changeShowPet(this.pet),this.updateSelected(!0))})):e.skin=this.grayPic,this.parent.parent.parent.isShowPetId(t)?(this.parent.parent.parent.showPet(this.pet),this.updateSelected(!0)):this.updateSelected(!1);let i=this.getChildByName("new");this.pet.getNewCome()&&this.pet.getVisitTimes()>0&&(i.visible=!0);let s=this.getChildByName("redPoint");this.pet.needRedPoint()?s.visible=!0:s.visible=!1}updateSelected(t){if(t){let t=this.getChildByName("selected"),e=this.getChildByName("hook");t.visible=!0,e.visible=!0,1==this.pet.getRedPointStatus()&&this.pet.setRedPointStatus(2)}else{let t=this.getChildByName("selected"),e=this.getChildByName("hook");if(t.visible){this.getChildByName("redPoint").visible=!1}t.visible=!1,e.visible=!1}}clearRedPoint(){this.getChildByName("redPoint").visible=!1}}class ue extends Laya.Sprite{constructor(){super(),this.otherRed=null}setCheckFunc(t){this.checkFunc=t}refreshRedPoint(t){if(this.checkFunc){let t=this.checkFunc();this.visible=!!t,null!=this.otherRed&&a.getInstance().postEvent("REDPOINT_REFRESH",[this.otherRed])}}onStart(){this.visible=!1}}class pe extends Laya.Script{constructor(){super(),this.redPointType1=-1,this.redPointType2=null,this.otherRed=null}onEnable(){-1!=this.redPointType1&&dt.registerObject(this.redPointType1,this.owner),null!=this.redPointType2&&"null"!=this.redPointType2&&dt.registerObject(this.redPointType2,this.owner),null!=this.otherRed&&"null"!=this.otherRed&&(this.owner.otherRed=this.otherRed)}onDisable(){-1!=this.redPointType1&&dt.unregisterObject(this.redPointType1,this.owner),null!=this.redPointType2&&"null"!=this.redPointType2&&dt.unregisterObject(this.redPointType2,this.owner)}}class Ie extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("bg").on(Laya.Event.CLICK,this,this.onCloseClick),this.getChildByName("confirm").on(Laya.Event.CLICK,this,this.onConfirmClick),this.showInfo(H.CurrentShopBuilding)}showInfo(t){if(null==t)return void this.close();let e=r.getInstance().getItemById("Building",t);null!=e?(this.title.text=K.get(e.Name),this.desc1.text=K.get(e.Desc1),this.desc2.text=K.get(e.Desc2),this.star.text="+"+e.StarReward,this.cost.text=String(e.Cost),this.icon.skin=e.ShopItems,this.buildingId=t,O.checkBuyBuildingAvailable(t)||this.setGray()):this.close()}setGray(){this.confirm.gray=!0,this.confirm.disabled=!0}onOpened(t){}onCloseClick(){this.close()}onConfirmClick(){if(this.close(),Laya.Dialog.closeAll(),H.CurrentShopBuildingBase)H.CurrentShopBuildingBase.checkIsHigher(this.buildingId)?O.buyBuildingAndPlace(this.buildingId,H.CurrentShopBuildingBase.getId()):O.buyBuilding(this.buildingId,null);else{let t=this.buildingId;O.buyBuilding(this.buildingId,function(){H.PlacingBuilding=t,m.getInstance().switchScene(c.BeachSceneId),a.getInstance().postEvent("PLACE_BUILDING",t)})}Laya.SoundManager.playSound("sound/buyItemSuccess.mp3",1)}}class me extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("close").on(Laya.Event.CLICK,this,this.onCloseClick);let t=r.getInstance().getConfig("FoodsList"),e=new Array;t.forEach((t,i)=>{e.push(i)}),this.list.array=e,this.getChildByName("facility").on(Laya.Event.CLICK,this,this.onFacilityClicked)}onDisable(){a.getInstance().removeEvent("UPDATE_FOODS",this,this.updateFoods)}updateFoods(){this.list.refresh()}onCloseClick(){this.close()}onFacilityClicked(){Laya.Dialog.open("ui/shopPop.scene");let t=this.getChildByName("facility");t.disabled=!0,t.gray=!1;let e=this.getChildByName("shipu");e.selected=!1,e.disabled=!1}}class fe extends Laya.Sprite{constructor(){super()}setItem(t){this.foodListId=t;let e=rt.getCurFoodInList(t);this.getChildByName("title").text=K.get(e.getName());let i=this.getChildByName("icon");i.skin=e.getShopItems(),150!=i.width&&(i.height=150*i.height/i.width,i.width=150);let s=this.getChildByName("upIcon");if(s.visible=!1,this.setGray(!1),e.isLocked())this.setGray(!0),this.on(Laya.Event.CLICK,this,this.showLevelUp);else{rt.getFoodList(t)[e.getLevel()]?(s.visible=!0,this.on(Laya.Event.CLICK,this,this.showLevelUp)):this.off(Laya.Event.CLICK,this,this.showLevelUp)}}setGray(t){if(t){this.getChildByName("icon").gray=!0,this.getChildByName("item").gray=!0}else{this.getChildByName("icon").gray=!1,this.getChildByName("item").gray=!1}}showLevelUp(){H.CurrentFoodListId=this.foodListId,Laya.Dialog.open("ui/foodLevelUpPop.scene",!1)}}class ye extends Laya.Dialog{onOpened(){}onEnable(){let t=r.getInstance().getConfig("FishingBaits");this.configArray=new Array,t.forEach((t,e)=>{this.configArray.push(t)}),this.getChildByName("bg_panel").on(Laya.Event.CLICK,this,function(){this.close()}),this.left_arrow=this.getChildByName("left_arrow"),this.right_arrow=this.getChildByName("right_arrow"),this.showBaitList(),a.getInstance().registEvent("FISHING_BAITS_SELECTED_CHANGE",this,this.changeSelectBaitId)}showBaitList(){let t=0,e=R.getLastBaitId();for(const i of this.configArray){if(i.Id==e)break;t++}this.startIndex=t-t%3,this.endIndex=this.startIndex+3>=this.configArray.length?this.configArray.length:this.startIndex+3,this.changeListItems()}changeListItems(){let t=new Array,e=this.configArray.slice(this.startIndex,this.endIndex);for(const i of e)t.push(i.Id);this.list.array=t,0==this.startIndex?this.left_arrow.visible=!1:(this.left_arrow.visible=!0,this.left_arrow.on(Laya.Event.CLICK,this,this._onLeftArrowChange)),this.endIndex==this.configArray.length?this.right_arrow.visible=!1:(this.right_arrow.visible=!0,this.right_arrow.on(Laya.Event.CLICK,this,this._onRightArrowChange))}_onLeftArrowChange(){this.startIndex<3||(this.startIndex=this.startIndex-3,this.endIndex=this.startIndex+3>=this.configArray.length?this.configArray.length:this.startIndex+3,this.changeListItems())}_onRightArrowChange(){this.startIndex>this.configArray.length-3||(this.startIndex=this.startIndex+3,this.endIndex=this.startIndex+3>=this.configArray.length?this.configArray.length:this.startIndex+3,this.changeListItems())}changeSelectBaitId(t){R.setLastBaitId(t),this.showBaitList()}}class _e extends Laya.Sprite{constructor(){super()}setItem(t){this.baitId=t;let e=r.getInstance().getItemById("FishingBaits",t),i=N.getStar(),s=this.getChildByName("bait_img"),a=this.getChildByName("star_img"),n=this.getChildByName("need_star"),o=this.getChildByName("bait_name"),h=this.getChildByName("bait_introduce"),l=this.getChildByName("hook");s.skin="fishing_game/bait/"+e.img,o.text=K.get(e.name),h.text=K.get(e.introduce),i>=e.StarLimit?(a.visible=!1,n.visible=!1,this.on(Laya.Event.CLICK,this,this.onSelected)):(a.visible=!0,n.text=e.StarLimit.toString(),n.visible=!0,this.off(Laya.Event.CLICK,this,this.onSelected)),R.getLastBaitId()==t?l.visible=!0:l.visible=!1}onSelected(){a.getInstance().postEvent("FISHING_BAITS_SELECTED_CHANGE",[this.baitId])}}class Ce extends Laya.Dialog{onEnable(){this.getChildByName("close").on(Laya.Event.CLICK,this,this.onCloseClick),this.showFishId="",this.show=this.getChildByName("show"),this.name_text=this.getChildByName("name_text"),this.name_text.text="",this.times_text=this.getChildByName("times_text"),this.times_text.text="",this.record_text=this.getChildByName("record_text"),this.record_text.text="",this.findDefaultShow();let t=r.getInstance().getConfig("FishingFishes"),e=new Array;t.forEach((t,i)=>{e.push(i)}),this.list.array=e}onCloseClick(){this.close()}isShowFishId(t){return this.showFishId==t}findDefaultShow(){if(""!=this.showFishId)return;let t=r.getInstance().getConfig("FishingFishes");for(const[e,i]of t){let t=R.getCollectById(e);if(null!=t&&t.getAcquireTimes()>0){this.showFishId=e;break}}}findTargetCell(t){for(const e of this.list.cells)if(e.dataSource==t)return e;return null}updateFishes(){this.list.refresh()}showFish(t){this.name_text.text=K.get(t.getName()),this.times_text.text=t.getAcquireTimes(),this.record_text.text=t.getMaxSize(),this.show.skin=t.getSource()}changeShowFish(t){if(t.getId()==this.showFishId)return;let e=this.findTargetCell(this.showFishId);null!=e&&e.updateSelected(!1),this.showFishId=t.getId(),this.showFish(t)}}class Se extends Laya.Sprite{constructor(){super()}setItem(t){this.fishId=t,this.fish=R.getCollectById(t),this.normalPic=this.fish.getSource(),this.grayPic=this.fish.getGrayPic();let e=this.getChildByName("image");this.fish.getAcquireTimes()>0?(e.skin=this.normalPic,this.on(Laya.Event.CLICK,this,function(){this.parent.parent.parent.isShowFishId(this.fishId)||(this.updateSelected(!0),this.parent.parent.parent.changeShowFish(this.fish))})):(e.skin=this.grayPic,e.alpha=.2),this.parent.parent.parent.isShowFishId(t)?(this.updateSelected(!0),this.parent.parent.parent.showFish(this.fish)):this.updateSelected(!1);let i=this.getChildByName("new");this.fish.getNewCome()&&this.fish.getAcquireTimes()>0&&(i.visible=!0)}updateSelected(t){if(t){let t=this.getChildByName("selected"),e=this.getChildByName("hook");t.visible=!0,e.visible=!0}else{let t=this.getChildByName("selected"),e=this.getChildByName("hook");t.visible=!1,e.visible=!1}}}class Be extends Laya.Dialog{constructor(){super()}onOpened(t){let e=t.reward[0],i=t.reward[1],s=r.getInstance().getItemById("FishingFishes",String(e)),a=this.getChildByName("fish_img");a.loadImage(s.img,Laya.Handler.create(this,function(){a.x-=a.width/2*a.scaleX,a.y-=a.height/2*a.scaleY})),this.getChildByName("name_text").text=K.get(s.name)+": "+String(i);let n=this.getChildByName("new_record"),o=R.getCollectById(e),h=null==o||null==o?0:o.getMaxSize();n.visible=i>h;let l=t.res.actualRewards.rewards;l.sort(function(t,e){return"FISH"==t.id?-1:"FISH"==e.id?1:0}),1==l.length?(this.list.repeatX=1,this.list.spaceX=0,this.list.x=832,this.list.visible=!0):2==l.length?(this.list.repeatX=2,this.list.spaceX=0,this.list.x=673,this.list.visible=!0):3==l.length?(this.list.repeatX=3,this.list.spaceX=-70,this.list.x=593,this.list.visible=!0):this.list.visible=!1,this.list.array=l,Laya.SoundManager.playSound("sound/fishingPerfectSuccess.mp3")}onEnable(){this.bgPanel=this.getChildByName("bg_panel"),this.bgPanel.alpha=.2,this.bgPanel.on(Laya.Event.CLICK,this,function(){this.close(),m.getInstance().switchScene(c.BeachSceneId)})}onDisable(){}}class Te extends Laya.Sprite{constructor(){super()}setItem(t){let e=this.getChildByName("icon");if(this.getChildByName("amount").text=String(t.amount),"FISH"==t.id)e.skin="topui/yugan.png";else{let i=r.getInstance().getItemById("NauticalFoods",t.id);e.skin="fishing_game/reward/"+i.Icon+".png"}}}class Le extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("bg").on(Laya.Event.CLICK,this,this.onCloseClick),this.getChildByName("confirm").on(Laya.Event.CLICK,this,this.onConfirmClick),this.showInfo(H.CurrentFoodListId)}showInfo(t){if(null==t)return void this.close();let e=rt.getNextLevelUpFoodInList(t);if(null==e)return void this.close();this.title.text=K.get(e.getName()),this.desc1.text=K.get(e.getDesc1()),this.time.text=e.getCookingTime()+"s",this.star.text=String(e.getLimit()),this.fish.text="+"+e.getIncome(),this.cost.text=String(e.getCost()),this.icon.skin=e.getShopItems();let i=this.icon;180!=i.width&&(i.height=180*i.height/i.width,i.width=180),this.foodListId=t,this.setGray(rt.checkLevelUpUnAvailable(t))}setGray(t){t?(this.confirm.gray=!0,this.confirm.disabled=!0,this.reason.visible=!0,this.reason.text=t,this.reason.x=563.5-this.reason.width/2):(this.confirm.gray=!1,this.confirm.disabled=!1,this.reason.visible=!1)}onOpened(t){}onCloseClick(){this.close()}onConfirmClick(){this.close(),Laya.Dialog.closeAll();let t=this.foodListId;rt.foodLevelUp(t)}}class we extends Laya.Dialog{constructor(){super(),this.animCat=null,this.bar=null,this.bar2=null,this.bar3=null,this.barSpr=null,this.max=0,this.maxValue=0,this.value=0}setStyle(t){null!=t&&null!=t||(t=2),this.style=t,1==this.style?this.initLoadingStyle1():this.initLoadingStyle2()}onEnable(){this.closeEffect=null,this.popupEffect=null}initLoadingStyle2(){this.barSpr=this.getChildByName("bar"),this.getChildByName("bg").visible=!1,this.barSpr.visible=!1,this.animCat=new Laya.Skeleton,this.animCat.load("loading/loading2.sk",Laya.Handler.create(this,function(){this.animCat.x=913.5,this.animCat.y=1218,this.animCat.play("1",!0)})),this.addChild(this.animCat)}initLoadingStyle1(){this.barSpr=this.getChildByName("bar"),this.max=this.barSpr.width,this.animCat=new Laya.Skeleton,this.animCat.load("loading/loading1.sk",Laya.Handler.create(this,function(){this.animCat.x=913.5,this.animCat.y=1218,this.animCat.play("1",!0)})),this.addChild(this.animCat),this.bar3=new Laya.Skeleton,this.bar3.load("loading/loading1.sk",Laya.Handler.create(this,function(){this.bar3.x=913.5,this.bar3.y=1600,this.bar3.play("4",!0)})),this.addChild(this.bar3),this.bar=new Laya.Skeleton,this.bar.load("loading/loading1.sk",Laya.Handler.create(this,function(){this.bar.x=0,this.bar.y=50,this.bar.play("2",!0)})),this.barSpr.addChild(this.bar),this.bar2=new Laya.Skeleton,this.bar2.load("loading/loading1weiba.sk",Laya.Handler.create(this,function(){this.bar2.y=50,this.bar2.play("3",!0)})),this.barSpr.addChild(this.bar2),this.setValue(0)}onDisable(){}setMaxValue(t){this.maxValue=t}setValue(t){if(1!=this.style)return;0==t&&(t=1e-6),this.value=t;let e=this.value/this.maxValue;this.barSpr.width=this.max*e,this.bar.x=this.barSpr.width-3}}class ve extends Laya.Dialog{constructor(){super(),this.autoDestroyAtClosed=!0}onEnable(){this.getChildByName("shopMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onShopClick),this.getChildByName("sceneMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onSceneMenuClick),this.getChildByName("cookbookMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onCookBookMenuClick),this.getChildByName("illustrationMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onIllustrationMenuClick),this.getChildByName("shareMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onShareMenuClick),this.getChildByName("photoMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onPhotoMenuClick),this.getChildByName("settingMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onSettingMenuClick)}onCloseClick(){this.close()}onShopClick(){Laya.Dialog.open("ui/shopPop.scene")}onSceneMenuClick(){Laya.Dialog.open("ui/SceneSelectDlg.scene",!0,1)}onCookBookMenuClick(){Laya.Dialog.open("ui/cookbookPop.scene")}onIllustrationMenuClick(){a.getInstance().postEvent("SHOW_TIPS","图鉴还未开放")}onShareMenuClick(){a.getInstance().postEvent("SHOW_TIPS","分享还未开放")}onPhotoMenuClick(){a.getInstance().postEvent("SHOW_TIPS","相机还未开放")}onSettingMenuClick(){a.getInstance().postEvent("SHOW_TIPS","设置还未开放")}_onBufferLoaded(t,e){}}class Ee extends Laya.Dialog{constructor(){super()}onEnable(){this.bgPanel=this.getChildByName("bg_panel"),this.bgPanel.alpha=.2,this.bgPanel.on(Laya.Event.CLICK,this,function(){this.close(),a.getInstance().postEvent("NETWORD_DISCONNECT")})}}class be extends Laya.Script{constructor(){super()}onStart(){this.owner.width=2436*Laya.Browser.width/Laya.Browser.height}}class Re extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("bg").on(Laya.Event.CLICK,this,this.onCloseClick),this.getChildByName("confirm").on(Laya.Event.CLICK,this,this.onConfirmClick),this.showInfo(H.CurrentShopBuilding)}showInfo(t){if(null==t)return void this.close();let e=r.getInstance().getItemById("Building",t);if(null!=e){if(this.title.text=K.get(e.Name),this.desc1.text=K.get(e.Desc1),this.desc2.text=K.get(e.Desc2),this.star.text="+"+e.StarReward,this.icon.skin=e.ShopItems,this.buildingId=t,H.CurrentShopBuildingBase&&H.CurrentShopBuildingBase.getBuildingId()==this.buildingId){this.cost="已放置";let t=this.getChildByName("confirm");t.disabled=!0,t.gray=!1}}else this.close()}setGray(){this.confirm.gray=!0,this.confirm.disabled=!0}onOpened(t){}onCloseClick(){this.close(),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onConfirmClick(){this.close(),Laya.Dialog.closeAll(),H.CurrentShopBuildingBase?O.placeBuilding(this.buildingId,H.CurrentShopBuildingBase.getId()):(H.PlacingBuilding=this.buildingId,m.getInstance().switchScene(c.BeachSceneId),a.getInstance().postEvent("PLACE_BUILDING",this.buildingId)),Laya.SoundManager.playSound("sound/buyItemSuccess.mp3",1)}}class xe extends Laya.Dialog{constructor(){super(),this.autoDestroyAtClosed=!0}onEnable(){let t=m.getInstance().getCurrentSceneId();for(let e=1;e<4;++e){let i=this.getChildByName("button_"+String(e));i.tag=e,i.on(Laya.Event.CLICK,this,this.onClickBtn),t==e&&this.moveSelect(i)}}moveSelect(t){this.select.y=t.y-10}onOpened(t){}onClickBtn(t){null!=m.getInstance().getSceneUrl(t.currentTarget.tag)&&(m.getInstance().switchScene(t.currentTarget.tag),this.moveSelect(t.currentTarget),this.close())}onDisable(){}}class ke extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("close").on(Laya.Event.CLICK,this,this.onCloseClick);let t=this.getChildByName("facilityButton");t.on(Laya.Event.CLICK,this,this.onFacilityClicked);let e=this.getChildByName("componentButton");e.on(Laya.Event.CLICK,this,this.onComponentClicked),1==m.getInstance().getCurrentSceneId()?(this.list.setListType(1),e.disabled=!0,e.gray=!1,e.selected=!0,t.selected=!1,t.disabled=!1):(this.list.setListType(2),t.disabled=!0,t.gray=!1,t.selected=!0,e.selected=!1,e.disabled=!1),this.getChildByName("shipu").on(Laya.Event.CLICK,this,this.onCookBookClicked)}onCloseClick(){this.close(),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onComponentClicked(){let t=this.getChildByName("facilityButton");t.selected=!1,t.disabled=!1;let e=this.getChildByName("componentButton");e.disabled=!0,e.gray=!1,this.list.setListType(1),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onFacilityClicked(){let t=this.getChildByName("facilityButton");t.disabled=!0,t.gray=!1;let e=this.getChildByName("componentButton");e.selected=!1,e.disabled=!1,this.list.setListType(2),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onCookBookClicked(){Laya.Dialog.open("ui/cookbookPop.scene");let t=this.getChildByName("shipu");t.disabled=!0,t.gray=!1;let e=this.getChildByName("facility");e.selected=!1,e.disabled=!1,Laya.SoundManager.playSound("sound/clickSound.mp3",1)}}class Ae extends Laya.List{constructor(){super(),this.repeatX=1,this._type=0,this.renderHandler=Laya.Handler.create(this,this.updateItem,null,!1),Laya.loader.load("prefab/ui/CommonComponentItem.json",Laya.Handler.create(this,this.onPrefabLoaded),null,Laya.Loader.JSON)}onEnable(){this.scrollBar.sizeGrid="8,6,8,6,0"}setListType(t){if(this._itemRender1||(this._itemRender1=this.itemRender),this._type!=t)if(this._type=t,1==t){this.x=454,this.repeatX=1,this.array=null,this.itemRender=this._itemRender1;let t=O.getLocationsByBaseType(1);this.array=t}else this._itemRender2&&(this.array=null,this.itemRender=this._itemRender2,this.setCommonComponentData())}setCommonComponentData(){this.x=454,this.repeatX=3;let t=O.getLocationsByBaseType(2),e=new Array;t.forEach(t=>{e=e.concat(t.getFixedBuildings())});let i=Array.from(new Set(e));this.array=i}onPrefabLoaded(t){let e=new Laya.Prefab;e.json=t,this._prefab=e,this._itemRender2=function(){return Laya.Pool.getItemByCreateFun("CommonComponentItem",e.create,e)},2==this._type&&(this.array=null,this.itemRender=this._itemRender2,this.setCommonComponentData())}onSelect(t){}updateItem(t,e){t.setItem(t.dataSource)}}class Ne extends Laya.Box{constructor(){super()}setItem(t){this.location=t,this.getChildByName("title").text=K.get(t.getListName()),Laya.loader.load("prefab/ui/SceneComponentItem.json",Laya.Handler.create(this,this.onPrefabLoaded),null,Laya.Loader.JSON)}onPrefabLoaded(t){let e=new Laya.Prefab;e.json=t;let i=10;this.location.getFixedBuildings().forEach(t=>{let s=Laya.Pool.getItemByCreateFun("SceneComponentItem",e.create,e);s.x=i,s.y=145,i+=300,s.setBuildingId(t,this.location),this.addChild(s)})}}class De extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("close").on(Laya.Event.CLICK,this,this.onCloseClick);let t=this.getChildByName("achievementBtn");t.on(Laya.Event.CLICK,this,this.onAchievementClicked);let e=t.getChildByName("redPoint");e.setCheckFunc(lt.hasCompletedTrophyTask),e.refreshRedPoint();let i=this.getChildByName("dailyBtn");i.on(Laya.Event.CLICK,this,this.onDailyClicked);let s=i.getChildByName("redPoint");s.setCheckFunc(lt.hasCompletedDailyTask),s.refreshRedPoint(),this.onTaskRefresh(),lt.getAllTasks(Laya.Handler.create(this,this.onTaskRefresh)),a.getInstance().registEvent("UPDATE_TASKS",this,this.updateTasks)}onDisable(){a.getInstance().removeEvent("UPDATE_TASKS",this,this.updateTasks)}onTaskRefresh(){let t=this.getChildByName("achievementBtn"),e=this.getChildByName("dailyBtn");lt.hasCompletedDailyTask()?(e.selected=!0,this.onDailyClicked()):lt.hasCompletedTrophyTask()?(t.selected=!0,this.onAchievementClicked()):(e.selected=!0,this.onDailyClicked())}updateTasks(){this.list.refresh()}onCloseClick(){this.close()}onDailyClicked(){let t=this.getChildByName("achievementBtn");t.selected=!1,t.disabled=!1;let e=this.getChildByName("dailyBtn");e.disabled=!0,e.gray=!1;let i=r.getInstance().getConfig("TaskList"),s=new Array;i.forEach((t,e)=>{t.TaskType==c.TaskType.kDaily&&s.push(e)}),s.sort(function(t,e){return i.get(t).Order-i.get(e).Order}),this.list.array=s}onAchievementClicked(){let t=this.getChildByName("achievementBtn");t.disabled=!0,t.gray=!1;let e=this.getChildByName("dailyBtn");e.selected=!1,e.disabled=!1;let i=r.getInstance().getConfig("TaskList"),s=new Array;i.forEach((t,e)=>{t.TaskType==c.TaskType.kTrophy&&s.push(e)}),s.sort(function(t,e){return i.get(t).Order-i.get(e).Order}),this.list.array=s}}class Me extends Laya.Sprite{constructor(){super()}onEnable(){this.getChildByName("receive").on(Laya.Event.CLICK,this,this.receive)}setItem(t){this.taskListId=t;let e=lt.getCurrentTask(t);this.taskId=e.getId(),this.getChildByName("title").text=K.get(e.getName()),this.getChildByName("desc").title=K.get(e.getDesc()),this.getChildByName("bar").value=e.getCurrent()/e.getTarget();let i=this.getChildByName("progress");i.text=K.short(e.getCurrent())+"/"+K.short(e.getTarget());let s=this.getChildByName("reward");s.text="+"+K.short(e.getReward());let a=this.getChildByName("rewardIcon");e.getRewardType()==c.RewardType.FISH?a.texture="topui/yugan.png":a.texture="topui/xingxing.png",i.x=460-(i.width>50?i.width/2:i.width/2+7),s.x=545,a.x=491,s.x+s.width>642&&(s.x=642-s.width,a.x=491+s.x-545);let n=this.getChildByName("received"),r=this.getChildByName("receive");this.getChildByName("progressing").visible=e.getStatus()==c.TaskStatus.kRunning,n.visible=e.getStatus()==c.TaskStatus.kRewarded,r.visible=e.getStatus()==c.TaskStatus.kCompleted}receive(){r.getInstance().getItemById("TaskList",this.taskListId).TaskType==c.TaskType.kDaily?lt.getDailyTaskReward(this.taskId):lt.getTrophyTaskReward(this.taskId)}}class Fe extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("close").on(Laya.Event.CLICK,this,this.onCloseClick),this.common=this.getChildByName("commonBtn"),this.common.on(Laya.Event.CLICK,this,this.onCommonClicked),this.double=this.getChildByName("doubleBtn"),this.double.on(Laya.Event.CLICK,this,this.onDoubleClicked),this.fish=this.getChildByName("fish"),this.star=this.getChildByName("star"),this.refresh(),L.findVisitorGift(Laya.Handler.create(this,this.refresh)),a.getInstance().registEvent("FETCH_ONE_VISITOR_GIFT",this,this._fetchOne)}onDisable(){a.getInstance().removeEvent("FETCH_ONE_VISITOR_GIFT",this,this._fetchOne)}onCloseClick(){this.close()}refresh(){let t=0,e=0,i=L.getVisitorGifts();if(i){let s=new Array;for(const a of i)if(!a.fetched){s.push(a);let i=a.reward;i[1]==c.RewardType.FISH?t+=i[0]:i[1]==c.RewardType.STAR&&(e+=i[0])}this.list.array=s}this.fish.text="X"+String(t),this.star.text="X"+String(e),0==t&&0==e?(this.common.disabled=!0,this.double.disabled=!0):(this.common.disabled=!1,this.double.disabled=!1)}_fetchOne(){let t=0,e=0;if(this.list.array)for(const i of this.list.array)if(!i.fetched){let s=i.reward;s[1]==c.RewardType.FISH?t+=s[0]:s[1]==c.RewardType.STAR&&(e+=s[0])}this.fish.text="X"+String(t),this.star.text="X"+String(e),0==t&&0==e?(this.common.disabled=!0,this.double.disabled=!0):(this.common.disabled=!1,this.double.disabled=!1)}_fetchAll(){for(const t of this.list.array)t.fetch();this.list.refresh(),this.fish.text="X0",this.star.text="X0",this.common.disabled=!0,this.double.disabled=!0}onCommonClicked(){L.getVisitorGiftAll(c.FetchType.DIRECT,Laya.Handler.create(this,this._fetchAll))}onDoubleClicked(){L.getVisitorGiftAll(c.FetchType.AD,Laya.Handler.create(this,this._fetchAll))}}class Pe extends Laya.Sprite{constructor(){super()}onEnable(){this.receive=this.getChildByName("receive"),this.receive.on(Laya.Event.CLICK,this,this.fetch)}setItem(t){this.visitorReward=t;let e=r.getInstance().getItemById("Role",t.catConfigId),i=r.getInstance().getItemById("Building",t.buildingId);this.titleText=this.getChildByName("title"),this.headIcon=this.getChildByName("headIcon"),this.building=this.getChildByName("building"),this.reward=this.getChildByName("reward"),this.rewardIcon=this.getChildByName("rewardIcon"),this.received=this.getChildByName("received"),this.titleText.text=K.get(e.Name),this.building.skin=i.ShopItems;let s=t.reward;this.reward.text="+"+K.short(s[0]),s[1]==c.RewardType.FISH?this.rewardIcon.texture="topui/yugan.png":this.rewardIcon.texture="topui/xingxing.png",this.receive.visible=!t.fetched,this.received.visible=!!t.fetched}fetch(){this.receive.disabled=!0,L.getVisitorGiftSingle(this.visitorReward.id,Laya.Handler.create(this,this.onFetch))}onFetch(){console.debug("onFetch"),this.visitorReward.fetch(),this.receive.visible=!1,this.received.visible=!0,a.getInstance().postEvent("FETCH_ONE_VISITOR_GIFT")}}class Oe extends Laya.Script{constructor(){super()}switchBtn(){let t=m.getInstance().getCurrentSceneId();this.leftBtn=this.owner.getChildByName("leftBtn"),this.rightBtn=this.owner.getChildByName("rightBtn"),t==c.CoffeeSceneId?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):t==c.BeachSceneId&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1)}onEnable(){this.leftBtn=this.owner.getChildByName("leftBtn"),this.rightBtn=this.owner.getChildByName("rightBtn"),this.leftBtn.on(Laya.Event.CLICK,this,function(){Laya.SoundManager.playSound("sound/clickSound.mp3",1),m.getInstance().switchScene(c.CoffeeSceneId)}),this.rightBtn.on(Laya.Event.CLICK,this,function(){Laya.SoundManager.playSound("sound/clickSound.mp3",1),m.getInstance().switchScene(c.BeachSceneId)}),this.switchBtn(),a.getInstance().registEvent("switch_arrow_btn",this,this.switchBtn)}onDisable(){}}class Ue extends Laya.Script{constructor(){super()}onEnable(){this.shop=this.owner.getChildByName("shop"),this.shop.on(Laya.Event.CLICK,this,this.onShopClick)}onShopClick(){Laya.SoundManager.playSound("sound/clickSound.mp3",1),Laya.Dialog.open("ui/shopPop.scene")}}class Ge extends Laya.Sprite{constructor(){super()}setItem(t){this.setBuildingId(t,null)}setBuildingId(t,e){if(null==t)return;let i=r.getInstance().getItemById("Building",t);if(null==i)return;this.buildingId=t,this.location=e,this.item=this.getChildByName("item");let s=this.getChildByName("title");s.text=K.get(i.Name),s.width=140,s.align="center";let a=this.getChildByName("icon");i.ShopItems.substr(i.ShopItems.lastIndexOf(".")-1,1);if(Laya.loader.load([{url:i.ShopItems,type:Laya.Loader.IMAGE}],Laya.Handler.create(this,function(){a.skin=i.ShopItems;let t=128/a.displayWidth,e=134/a.displayHeight;t<=e?(a.scaleX=t,a.scaleY=t):(a.scaleX=e,a.scaleY=e)})),O.checkBuildingUnlocked(t))if(O.hasBuildingDataByBid(t)){let i=O.getBuildingDataByBid(t);e&&i.getLocationData(),this.on(Laya.Event.CLICK,this,this.showPlacePop)}else this.on(Laya.Event.CLICK,this,this.showBuyPop);else this.on(Laya.Event.CLICK,this,this.showUnlock,[i.Limit])}disable(){this.getChildByName("icon");this.disabled=!0}showUnlock(t){a.getInstance().postEvent("SHOW_TIPS","需要"+t+"星星才能解锁")}showBuyPop(){1!=this.disabled&&(H.CurrentShopBuildingBase=this.location,H.CurrentShopBuilding=this.buildingId,Laya.Dialog.open("ui/confirmPop.scene",!1))}showPlacePop(){1!=this.disabled&&(H.CurrentShopBuildingBase=this.location,H.CurrentShopBuilding=this.buildingId,Laya.Dialog.open("ui/placePop.scene",!1))}}class He extends Laya.Tree{constructor(){super()}onEnable(){this.status=1,this.setting=this.getChildByName("settings"),this.setting.on(Laya.Event.CLICK,this,this.onSettingMenuClick),this.photo=this.getChildByName("photo"),this.photo.on(Laya.Event.CLICK,this,this.onPhotoMenuClick),this.share=this.getChildByName("share"),this.share.on(Laya.Event.CLICK,this,this.onShareMenuClick),this.collect=this.getChildByName("collect"),this.collect.on(Laya.Event.CLICK,this,this.onCollectMenuClick),this.task=this.getChildByName("task"),this.task.on(Laya.Event.CLICK,this,this.onTaskClick),this.updown=this.getChildByName("updown"),this.updown.on(Laya.Event.CLICK,this,this.onUpDownClick);let t=this.task.getChildByName("redPoint");t.setCheckFunc(lt.hasCompletedTask),t.refreshRedPoint();let e=this.collect.getChildByName("redPoint");e.setCheckFunc(bt.needRedPoint),e.refreshRedPoint();let i=this.updown.getChildByName("redPoint");i.setCheckFunc(this.checkUpdownRed),i.refreshRedPoint(),this.updateStatus(),this.downTimeline=new Laya.TimeLine,this.upTimeline=new Laya.TimeLine,this.createDownTimerLine(),this.createUpTimerLine()}createDownTimerLine(){this.downTimeline.to(this.updown,{y:-7},200,null,0).to(this.updown,{y:1370},466,null,0).to(this.updown,{y:1248},100,null,0).to(this.updown,{y:1235},67,null,0).to(this.updown,{y:1290},300,null,0).to(this.setting,{y:0},466,null,-933).to(this.setting,{y:-7},100,null,-467).to(this.setting,{y:0},200,null,-367).to(this.photo,{y:242},466,null,-933).to(this.photo,{y:214},100,null,-467).to(this.photo,{y:228},200,null,-367).to(this.share,{y:525},466,null,-933).to(this.share,{y:465},100,null,-467).to(this.share,{y:493},200,null,-367).to(this.collect,{y:802},466,null,-933).to(this.collect,{y:712},100,null,-467).to(this.collect,{y:758},200,null,-367).to(this.task,{y:1082},466,null,-933).to(this.task,{y:960},100,null,-467).to(this.task,{y:1023},200,null,-367),this.downTimeline.on(Laya.Event.COMPLETE,this,this.onComplete)}createUpTimerLine(){this.upTimeline.to(this.updown,{y:1235},300,null,0).to(this.updown,{y:1248},67,null,0).to(this.updown,{y:1370},100,null,0).to(this.updown,{y:-7},466,null,0).to(this.updown,{y:0},200,null,0).to(this.setting,{y:-7},200,null,-766).to(this.setting,{y:0},100,null,-566).to(this.setting,{y:-228},466,null,-466).to(this.photo,{y:214},200,null,-766).to(this.photo,{y:242},100,null,-566).to(this.photo,{y:-265},466,null,-466).to(this.share,{y:465},200,null,-766).to(this.share,{y:525},100,null,-566).to(this.share,{y:-265},466,null,-466).to(this.collect,{y:712},200,null,-766).to(this.collect,{y:802},100,null,-566).to(this.collect,{y:-265},466,null,-466).to(this.task,{y:960},200,null,-766).to(this.task,{y:1082},100,null,-566).to(this.task,{y:-265},466,null,-466),this.upTimeline.on(Laya.Event.COMPLETE,this,this.onComplete)}onSettingMenuClick(){a.getInstance().postEvent("SHOW_TIPS","设置还未开放"),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onPhotoMenuClick(){a.getInstance().postEvent("SHOW_TIPS","相机还未开放"),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onShareMenuClick(){a.getInstance().postEvent("SHOW_TIPS","分享还未开放"),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onCollectMenuClick(){ne.getPetsInfo(Laya.Handler.create(null,Laya.Dialog.open("ui/CollectPop.scene"))),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onTaskClick(){Laya.Dialog.open("ui/taskPop.scene"),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}onUpDownClick(){1==this.status?this.downTimeline.play():this.upTimeline.play(),Laya.SoundManager.playSound("sound/clickSound.mp3",1)}updateStatus(){1==this.status?(this.setting.y=-228,this.photo.y=-265,this.share.y=-265,this.collect.y=-265,this.task.y=-265,this.updown.y=0):(this.setting.y=0,this.photo.y=228,this.share.y=493,this.collect.y=758,this.task.y=1023,this.updown.y=1290)}onComplete(){console.log("动画播放完成了"),this.status=3-this.status,this.updateStatus()}checkUpdownRed(){return ht.getInstance().hasCompletedTask()||T.getInstance().needRedPoint()}}class Ve extends Laya.Script{constructor(){super()}onEnable(){let t=this.owner.getChildByName("xingxing"),e=this.owner.getChildByName("xiaoyugan");this.fishText=e.getChildByName("fish_text"),this.starText=t.getChildByName("star_text"),this.updateFish(N.getFish()),this.updateStar(N.getStar()),a.getInstance().registEvent("UPDATE_FISH",this,this.updateFish),a.getInstance().registEvent("UPDATE_STAR",this,this.updateStar)}updateFish(t){this.fishText.text=String(t)}updateStar(t){this.starText.text=String(t)}}class qe{static init(){let t=Laya.ClassUtils.regClass;t("scene/BeachScene.js",q),t("form/Bowl.js",X),t("core/component/ViewAdjust.js",z),t("guide/Guide.js",J),t("core/component/ViewAlignment.js",Z),t("form/ClickVisitorGiftBtn.js",Y),t("scene/CoffeeScene.js",tt),t("form/ClickAddCatBtn.js",et),t("scene/FishingScene.js",it),t("core/component/ViewAlign.js",st),t("scene/LoginScene.js",le),t("form/CollectPop.js",ce),t("form/CommonList.js",de),t("form/CollectItem.js",ge),t("form/RedPoint.js",ue),t("form/RedPointType.js",pe),t("form/ConfirmPop.js",Ie),t("form/CookBookPop.js",me),t("form/CookBookItem.js",fe),t("form/FishingBaitsSelect.js",ye),t("form/FishingBaitsItem.js",_e),t("form/FishingCollectPop.js",Ce),t("form/FishingCollectItem.js",Se),t("form/FishingDialog.js",Be),t("form/FishingRewardItem.js",Te),t("form/FoodLevelUpPop.js",Le),t("form/LoadingUI.js",we),t("form/Menu.js",ve),t("form/MultiLoginDialog.js",Ee),t("core/component/ViewMid.js",be),t("form/PlacePop.js",Re),t("form/SceneSelectDlg.js",xe),t("form/ShopPop.js",ke),t("form/ShopList.js",Ae),t("form/ShopItem.js",Ne),t("form/TaskPop.js",De),t("form/TaskItem.js",Me),t("form/VisitorGiftPop.js",Fe),t("form/VisitorGiftItem.js",Pe),t("form/ArrowUI.js",Oe),t("form/BottomUINew.js",Ue),t("form/BuildingItem.js",Ge),t("form/LeftUI.js",He),t("form/TopUI.js",Ve)}}qe.width=1827,qe.height=2436,qe.scaleMode="fixedheight",qe.screenMode="vertical",qe.alignV="middle",qe.alignH="center",qe.startScene="scene/CoffeeScene.scene",qe.sceneRoot="",qe.debug=!1,qe.stat=!1,qe.physicsDebug=!0,qe.exportSceneToJson=!0,qe.init();new class{constructor(){window.Laya3D?Laya3D.init(qe.width,qe.height):Laya.init(qe.width,qe.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=qe.scaleMode,Laya.stage.screenMode=qe.screenMode,Laya.stage.alignV=qe.alignV,Laya.stage.alignH=qe.alignH,Laya.stage.frameRate="slow",Laya.URL.exportSceneToJson=qe.exportSceneToJson,Laya.Browser.onMiniGame&&(Laya.URL.basePath="https://raw.githubusercontent.com/sw28363807/sunwen/master/",Laya.MiniAdpter.nativefiles=["config/","js/","libs/","bg/","prefab/","scene/","ui/","shopitems/","loading/","sound/","fileconfig.json","game.js","game.json","index.js","project.config.json","unpack.json","version.json","weapp-adapter.js"]),(qe.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),qe.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),qe.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onProtoInit(){console.debug("显示登录场景"),m.getInstance().switchScene(c.LoginSceneId,Laya.Handler.create(this,function(t){}))}getObj(t){return t()}onLogin(t){}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){a.getInstance().registEvent("SHOW_TIPS",this,this._showDefaultTip),he.getInstance().start(Laya.Handler.create(this,function(){ne.initService(Laya.Handler.create(this,this.onProtoInit))}))}_initTip(){1!=this._tipInited&&(this.offsetX=0,this._tipInited=!0,this.tipBackColor="#ffffff",this.tipDelay=2e3,this._tipBox=new Laya.UIComponent,this._tipBox.addChild(this._tipText=new Laya.Text),this._tipText.fontSize=40,this._tipText.x=this._tipText.y=5,Laya.ILaya.stage.addChild(this._tipBox),this._tipBox.zOrder=1e4)}_showDefaultTip(t){this._initTip(),Laya.ILaya.timer.clear(this,this._hideTip),this._tipText.text=t;let e=this._tipBox.graphics;e.clear(!0),e.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,this.tipBackColor),this._tipBox.visible=!0,this._showToStage(this._tipBox,50,-100),Laya.ILaya.timer.once(this.tipDelay,this,this._hideTip,[],!0)}_showToStage(t,e=0,i=0){let s=t.getBounds();t.x=Laya.ILaya.stage.mouseX+e+this.offsetX,t.y=Laya.ILaya.stage.mouseY+i,t.x+s.width>Laya.ILaya.stage.width&&(t.x-=s.width+e),t.y+s.height>Laya.ILaya.stage.height&&(t.y-=s.height+i)}_hideTip(){this._tipBox.visible=!1,Laya.ILaya.timer.clear(this,this._hideTip)}}}();