!function(){"use strict";class t{constructor(){this.eventDispatcher=new Laya.EventDispatcher}static getInstance(){return t.instance?t.instance:t.instance=new t}postEvent(t,e){this.eventDispatcher.event(t,e)}registEvent(t,e,i){this.removeEvent(t,e,i),this.eventDispatcher.on(t,e,i)}removeEvent(t,e,i){this.eventDispatcher.off(t,e,i,!1)}removeAllEvent(){this.eventDispatcher.offAll(eventName)}}let e=".txt";class i{constructor(){this._Protobuf=Laya.Browser.window.protobuf,this._root=new this._Protobuf.Root,this._root._owner=this,this._configs=new Map,this._loadingProtos=new Map,this._configHandlers=new Map}static getInstance(){return i.instance?i.instance:i.instance=new i}loadConfig(t,i){if(this._configs.has(t))return void(i&&i.runWith(this._configs.get(t)));i&&(this._configHandlers.has(t)?this._configHandlers.get(t).push(i):this._configHandlers.set(t,new Array(i)));let n=this._root.lookup("pattern."+t);n?Laya.loader.load("config/"+t+e,Laya.Handler.create(this,this._onBufferLoaded,[n,t]),null,Laya.Loader.BUFFER):(this._loadingProtos.set(t,!0),this._Protobuf.load("proto/"+t+"Client.proto",this._root,this._onProtoLoaded))}getConfig(t){return this._configs.has(t)?this._configs.get(t):(this.loadConfig(t),null)}loadItemById(t,e,i){this.loadConfig(t,Laya.Handler.create(this,this._processItemHandler,[e,i]))}getItemById(t,e){let i=this.getConfig(t);return i?i.get(e):null}_processItemHandler(t,e,i){let n=i.get(t);e.runWith(n)}_onProtoLoaded(t,e){let i=e._owner;if(t)throw t;i._processLoadedProtos()}_processLoadedProtos(){let t=this._root,i=this._loadingProtos,n=this;i.forEach(function(a,s){if(a){let a=t.lookup("pattern."+s);a&&(i.delete(s),Laya.loader.load("config/"+s+e,Laya.Handler.create(n,n._onBufferLoaded,[a,s]),null,Laya.Loader.BUFFER))}})}_onBufferLoaded(t,e,i){let n=new Map,a=new Laya.Byte(i);for(a.endian=Laya.Byte.BIG_ENDIAN;a.pos<a.length;){let e=a.readInt16(),i=a.readUint8Array(a.pos,e),s=t.decode(i);n.set(s.Id,s)}this._configs.set(e,n),this._processConfigHandlers(e,n)}_processConfigHandlers(t,e){if(e){this._configHandlers.get(t).forEach(function(t){t.runWith(e)}),this._configHandlers.delete(t)}}}class n{constructor(){this._fish=0,this._star=0}update(t){this.updateFish(t.fish),this.updateStar(t.star)}updateFish(t){this._fish=Number(t)}updateStar(t){this._star=Number(t)}getStar(){return this._star}getFish(){return this._fish}}class a{constructor(){this._player=new n}static getInstance(){return a.instance?a.instance:a.instance=new a}getFish(){return this._player.getFish()}updateFish(t){this._player.updateFish(t)}getStar(){return this._player.getStar()}updateStar(t){this._player.updateStar(t)}clear(){this._player=new n}}class s{static init(){t.getInstance().registEvent("REFRESH_FISH",null,s.cumulateFish),a.getInstance().clear()}static getFish(){return a.getInstance().getFish()}static cumulateFish(e,i){console.debug("cumulateFish",arguments),t.getInstance().postEvent("SERVICE_RECEIVE_FISH",[e,i])}static updateFish(e){a.getInstance().updateFish(e),t.getInstance().postEvent("UPDATE_FISH",e)}static getStar(){return a.getInstance().getStar()}static updateStar(e){a.getInstance().updateStar(e),t.getInstance().postEvent("UPDATE_STAR",e)}static cumulateStar(t){}static clear(){a.getInstance().clear()}}class r extends Laya.Script{constructor(){super()}onEnable(){let e=this.owner.getChildByName("xingxing"),i=this.owner.getChildByName("xiaoyugan");this.fishText=i.getChildByName("fish_text"),this.starText=e.getChildByName("star_text"),this.updateFish(s.getFish()),this.updateStar(s.getStar()),t.getInstance().registEvent("UPDATE_FISH",this,this.updateFish),t.getInstance().registEvent("UPDATE_STAR",this,this.updateStar)}updateFish(t){this.fishText.text=String(t)}updateStar(t){this.starText.text=String(t)}}class o extends Laya.Skeleton{constructor(t){super(),this.catData=t,this.loop=!0,this.curAnim="",this.maskAnim=null,this.loadedHandlers=new Array,this.eventHandlers=new Array,this.completeHandlers=new Array,this.activeAI=!1,this.zOrder=50}getIsActive(){return this.activeAI}setIsActive(t){this.activeAI=t}getData(){return this.catData}addLoadedHandler(t){this.loadedHandlers.push(t)}addCompleteHandler(t){this.completeHandlers.push(t)}addEventHandlers(t){this.eventHandlers.push(t)}loadAnim(t){this.load(t,Laya.Handler.create(this,this.onLoadedExt))}playAnim(t,e=!0){this.play(t,!0),this.loop=e,this.curAnim=t}getCurAnim(){return this.curAnim}onCompleteExt(){this.completeHandlers.forEach(function(t){t()}),this.loop&&this.play(this.curAnim,!1)}onEventExt(t){this.eventHandlers.forEach(function(e){e(t)})}onLoadedExt(){this.showSkinByIndex(1),this.loadedHandlers.forEach(function(t){t()}),this.initMaskAnim()}registerMouseDown(t,e){let i=new Laya.Panel;i.mouseThrough=!0,i.width=200,i.height=200,i.centerX=.5,i.y=-200,i.on(Laya.Event.MOUSE_DOWN,t,e),this.panel=i,this.addChild(i)}initMaskAnim(){this.maskAnim=new Laya.Skeleton,this.maskAnim.load("anim/UIdonghua.sk",Laya.Handler.create(this,function(){this.maskAnim.y=-250,this.addChild(this.maskAnim),this.maskAnim.visible=!1}))}showMaskAnim(t){this.maskAnim.visible=!0,this.playAnim("lick1"),this.maskAnim.play("tanhao"),Laya.timer.once(400,this,function(){this.hideMaskAnim(),null!=t&&t.run()})}hideMaskAnim(){this.maskAnim.stop(),this.maskAnim.visible=!1}onDestroy(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}}class l{constructor(){}static getSign(t){return t>=0?1:-1}static randomSign(){return Math.random()>.5?-1:1}static randomExt(t){let e=Math.random();return Math.ceil(e*t)-1}static randomExt2(t,e){let i=e-t;return t+l.randomExt(i)}static randomRangePoint(t,e){let i=t.x+l.randomSign()*l.randomExt(e),n=t.y+l.randomSign()*l.randomExt(e);return new Laya.Point(i,n)}static fadeout(t,e,i){t.alpha=1,Laya.Tween.to(t,{alpha:0},e,null,i,0)}static fadein(t,e,i){t.alpha=0,Laya.Tween.to(t,{alpha:1},e,null,i,0)}}class h{constructor(){this.locationData=null,this._curBuildingId=null}setData(t){this.locationData=t}getId(){return this.locationData.Id}getX(){return Number(this.locationData.Pos[0])}getY(){return Number(this.locationData.Pos[1])}getSelectionX(){return Number(this.locationData.PosSelection[0])}getSelectionY(){return Number(this.locationData.PosSelection[1])}getOrder(){return Number(this.locationData.Order)}getBaseType(){return this.locationData.BaseType}getZOrder(){return Number(this.locationData.ZOrder)}getListName(){return this.locationData.ListName}getBaseSize(){return this.locationData.BaseSize}getPathPointIndex(){return Number(this.locationData.PathPointIndex)}getFixedBuildings(){return this.locationData.FixedBuildings}getBelongScene(){return this.locationData.BelongScene}checkBuildingAvailable(t){let e=this.getFixedBuildings(),i=!1;for(let n of e)if(n==t)return i=!0,!0;return i}setBuildingId(t){this._curBuildingId=t}getBuildingId(){return this._curBuildingId}checkIsHigher(t){if(1!=this.getBaseType())return!0;{let e=this.getFixedBuildings();if(!this._curBuildingId)return!0;for(let i of e){if(i==this._curBuildingId)return!0;if(i==t)return!1}}}clear(){this._curBuildingId=null}}class c{constructor(){this.locationMap=new Map,this.initLocations()}static getInstance(){return c.instance?c.instance:c.instance=new c}initLocations(){let t=i.getInstance().getConfig("BuildingBase"),e=this;t.forEach(function(t){let i=new h;i.setData(t),e.locationMap.set(Number(t.Id),i)})}clear(){this.locationMap.forEach(t=>{t.clear()})}getLocation(t){return this.locationMap.get(Number(t))}getLocationsByBaseType(t){let e=new Array;return this.locationMap.forEach(i=>{i.getBaseType()==t&&e.push(i)}),e.sort(function(t,e){return t.getOrder()-e.getOrder()}),e}}class d{constructor(t){this.catWeightedMap=new Map,this.catWeightedSum=0,this.config=i.getInstance().getItemById("Building",String(t)),this.config.CustomerInvite.forEach(t=>{if(""!=t){let e=t.split(":");this.catWeightedMap.set(String(e[0]),Number(e[1])),this.catWeightedSum+=Number(e[1])}}),this.locationData=null,this.hasIdleBuildingRoot=!1,this.anims=new Array,this.dropPoint=null}getCatWeightedSum(){return this.catWeightedSum}getId(){return this.config.Id}getSource(){return this.config.Source}getLocationData(){return this.locationData}setLocationData(t){this.locationData=t}getCatWeightedMap(){return this.catWeightedMap}getCatWeightedArray(){let t=new Array;return this.catWeightedMap.forEach((e,i)=>{t.push({w:e,n:i})}),t.sort(function(t,e){return t.w<e.w}),t}getBelongScene(){return this.config.BelongScene}getCost(){return this.config.Cost}getStar(){return this.config.StarReward}getLimit(){return this.config.Limit}getSpecialTpye(){return this.config.SpecialTpye}getSpecialValue(){return this.config.SpecialValue}getAutoIncome(){let t=0;return null!=this.config.AutoIncome&&(t=Number(this.config.AutoIncome)),t}isSupportAction(t){for(let e=0;e<this.config.SupportActions.length;++e){let i=this.config.SupportActions[e];if(null!=i&&""!=i&&t==i)return!0}return!1}}class g{constructor(){this.buildingMap=new Map,this.buildingMap.set(1,{weighted:0,list:new Array,catWeightedMap:new Map,autoIncome:0}),this.buildingMap.set(2,{weighted:0,list:new Array,catWeightedMap:new Map,autoIncome:0}),this.buildingMap.set(3,{weighted:0,list:new Array,catWeightedMap:new Map,autoIncome:0})}static getInstance(){return g.instance?g.instance:g.instance=new g}getSceneIdByBid(t){return i.getInstance().getItemById("Building",String(t)).BelongScene}getBuildingDataListInfo(t){return this.buildingMap.get(Number(t))}getBuildingDataByBid(t){let e=this.getBuildingDataListInfo(this.getSceneIdByBid(t));for(let i=0;i<e.list.length;++i){let n=e.list[i];if(String(n.getId())==String(t))return n}return null}removeBuildingDataByBid(t){let e=this.getBuildingDataListInfo(this.getSceneIdByBid(t));if(null!=e)for(let i=0;i<e.list.length;++i){let n=e.list[i];if(String(t)==n.getId()){let t=n.getCatWeightedMap(),a=n.getAutoIncome();return e.autoIncome=e.autoIncome-a,t.forEach(function(t,i){e.weighted=e.weighted-t;let n=e.catWeightedMap.get(i)-t;e.catWeightedMap.set(i,n)}),e.list.splice(i,1),n}}}addBuildingDataByBid(t){let e=this.getSceneIdByBid(t),i=this.getBuildingDataByBid(t);if(null!=i)return i;let n=(i=new d(String(t))).getCatWeightedMap(),a=i.getAutoIncome(),s=this.buildingMap.get(e);return s.autoIncome=s.autoIncome+a,n.forEach(function(t,e){if(s.weighted=s.weighted+t,s.catWeightedMap.get(e)){let i=s.catWeightedMap.get(e)+t;s.catWeightedMap.set(e,i)}else s.catWeightedMap.set(e,t)}),s.list.push(i),i}getCatWeightedMap(t){return this.buildingMap.get(t).catWeightedMap}getCatWeightedArray(t){let e=this.getCatWeightedMap(t),i=new Array;return e.forEach((t,e)=>{i.push({w:t,n:e})}),i.sort(function(t,e){return t.w<e.w}),i}getAutoIncomeSum(){let t=this.buildingMap.get(1),e=this.buildingMap.get(2);return Number(t.autoIncome)+Number(e.autoIncome)}clear(){}}class u{constructor(){this.sceneMap=new Map}static getInstance(){return u.instance?u.instance:u.instance=new u}getSceneUrl(t){return 1==t?"scene/CoffeeScene.scene":2==t?"scene/BeachScene.scene":3==t?"scene/FishingScene.scene":0==t?"scene/Login.scene":void 0}getScene(t){return this.sceneMap.get(t)}getCurrentSceneId(){return this.currentSceneId}loadScene(t,e){let i=this.sceneMap.get(t);if(null!=i)return i.visible=!0,i.open(),void(null!=e&&e.runWith(i));{let i=this.getSceneUrl(t);for(let t=0;t<Laya.Scene.unDestroyedScenes.length;++t){let n=Laya.Scene.unDestroyedScenes[t];if(i==n.url)return n.open(),n.visible=!0,void(null!=e&&e.runWith(n))}Laya.Scene.open(i,!1,null,new Laya.Handler(this,function(i){this.sceneMap.set(t,i),i.visible=!0,null!=e&&e.runWith(i)}))}}switchScene(t,e){this.currentSceneId!=t&&(this.currentSceneId=t,this.loadScene(t,e))}closeAllScene(){for(let t=Laya.Scene.unDestroyedScenes.length-1;t>=0;--t){Laya.Scene.unDestroyedScenes[t].destroy()}this.sceneMap.clear(),Laya.Scene.gc()}}class y{static init(){}static clear(){g.getInstance().clear(),c.getInstance().clear()}static addBuildingDataByBid(t){g.getInstance().addBuildingDataByBid(t)}static replaceBuildingData(e,i){let n=c.getInstance().getLocation(Number(i));if(null==n)return;let a=n.getBuildingId();if(null!=a){let e=g.getInstance().getBuildingDataByBid(a);t.getInstance().postEvent("REMOVE_BUILDING",e),y.removeBuildingDataByPid(i)}let s=g.getInstance().addBuildingDataByBid(e);if(null==s)return;let r=s.getLocationData();r&&(t.getInstance().postEvent("REMOVE_BUILDING",s),r.setBuildingId(null)),n.setBuildingId(e),s.setLocationData(n),t.getInstance().postEvent("ADD_BUILDING",s)}static getBuildingDataByPid(t){let e=c.getInstance().getLocation(Number(t));if(null==e)return null;let i=e.getBuildingId();return null==i?null:g.getInstance().getBuildingDataByBid(i)}static removeBuildingDataByPid(t){let e=c.getInstance().getLocation(Number(t)),i=e.getBuildingId();if(i){g.getInstance().getBuildingDataByBid(i).setLocationData(null),e.setBuildingId(null)}return null}static randomVisitBuilding(t,e){let i=new Array;if(g.getInstance().getBuildingDataListInfo(t).list.forEach(t=>{null!=t&&null!=t.getLocationData()&&t.isSupportAction(e)&&i.push(t)}),0==i.length)return null;let n=l.randomExt(i.length);return i[n]}static getBuildingDataListInfo(t){return g.getInstance().getBuildingDataListInfo(t)}static getLocationsByBaseType(t){return c.getInstance().getLocationsByBaseType(t)}static hasBuildingDataByBid(t){let e=g.getInstance().getBuildingDataListInfo(g.getInstance().getSceneIdByBid(t));for(let i=0;i<e.list.length;++i){let n=e.list[i];if(String(t)==n.getId())return!0}return!1}static getBuildingDataByBid(t){return g.getInstance().getBuildingDataByBid(t)}static getCatWeightedArray(t){return g.getInstance().getCatWeightedArray(t)}static getAutoIncomeSum(){return g.getInstance().getAutoIncomeSum()}static checkBuildingUnlocked(t){if(y.hasBuildingDataByBid(t))return!0;let e=new d(t);return!(s.getStar()<e.getLimit())}static checkBuyBuildingAvailable(t){if(y.hasBuildingDataByBid(t))return!1;let e=new d(t);return!(s.getFish()<e.getCost())}static checkPlaceBuildingAvailable(t,e){if(!c.getInstance().getLocation(e).checkBuildingAvailable(t))return!1}static buyBuilding(e,i){if(y.checkBuyBuildingAvailable(e)){let n=function(){g.getInstance().addBuildingDataByBid(e),i&&i()};t.getInstance().postEvent("SERVICE_PUT_BUILDING",[e,"",Laya.Handler.create(null,n)])}}static buyBuildingAndPlace(e,i){if(y.checkBuyBuildingAvailable(e)){let n=function(){y.replaceBuildingData(e,i);let t=c.getInstance().getLocation(i);u.getInstance().switchScene(t.getBelongScene())};t.getInstance().postEvent("SERVICE_PUT_BUILDING",[e,i,Laya.Handler.create(null,n)])}}static placeBuilding(e,i){t.getInstance().postEvent("SERVICE_PUT_BUILDING",[e,i,Laya.Handler.create(null,function(){y.replaceBuildingData(e,i);let t=c.getInstance().getLocation(i);u.getInstance().switchScene(t.getBelongScene())})])}}class p{constructor(t){this.config=i.getInstance().getItemById("Role",String(t)),this.catId=++p.catIdMax;let e=new Map;for(let t=0;t<this.config.FavorFoodsList.length;++t){let i=this.config.FavorFoodsList[t].split(":");e.set(String(i[1]),Number(i[0]))}this.foodWeighted=0,this.foodWeightedArray=new Array;let n=this;e.forEach(function(t,e){n.foodWeighted+=t,n.foodWeightedArray.push({c:e,w:Number(t)})}),n.foodWeightedArray.sort(function(t,e){return t.w<e.w}),this.sceneId=0,this.randomFood()}setSceneId(t){this.sceneId=t}getSceneId(){return this.sceneId}setParams(t){this.params=t}getParams(){return this.params}randomFood(){let t=l.randomExt(this.foodWeighted),e=0;for(let i=0;i<this.foodWeightedArray.length;++i){let n=this.foodWeightedArray[i],a=n.w+e;if(e<=t&&t<=a)return n.c;e=a}return null}getCatId(){return this.catId}getConfigId(){return this.config.Id}getSource(){return this.config.Source}getEventVisit(){return this.config.EventVisit}getEventEventTravel(){return this.config.EventTravel}getValueBase(){return this.config.ValueBase}}p.catIdMax=0;class f{constructor(){this.catMap=new Map}static getInstance(){return f.instance?f.instance:f.instance=new f}addCatData(t,e){let i=new p(t);return this.catMap.set(i.getCatId(),i),i.setSceneId(e),i}getCatCountBySceneId(t){let e=0;return this.catMap.forEach((i,n)=>{i.getSceneId()==t&&e++}),e}getCatsBySceneId(t){let e=new Array;return this.catMap.forEach((i,n)=>{i.getSceneId()==t&&e.push(i)}),e}removeCatData(t){this.catMap.delete(t)}getCatData(t){return this.catMap.get(t)}dump(){let t=new Array,e=new Array;return this.catMap.forEach((i,n)=>{1==i.getSceneId()?t.push({id:i.getConfigId(),params:i.getParams()}):2==i.getSceneId()&&e.push({id:i.getConfigId(),params:i.getParams()})}),{scene1:t,scene2:e}}clear(){this.catMap.clear()}}class I{constructor(){this.scene1BasePath=new Array,this.scene1ExtPath0=new Array,this.scene1ExtPath1=new Array,this.scene1ExtPath2=new Array,this.scene1ExtPath3=new Array}static getInstance(){return I.instance?I.instance:I.instance=new I}getZOrderPathPoint(){return 14}getStartPathPoint(){return this.scene1BasePath[0]}_dealPath(t){let e=l.randomExt(2),i=new Array;for(let n=0;n<e+1;++n){let e=l.randomExt(t.length);i.push(t[e])}return i}randomPath(t){let e=new Array;if(1==Number(t)){let t=this._dealPath(this.scene1ExtPath0),i=this._dealPath(this.scene1ExtPath1),n=this._dealPath(this.scene1ExtPath2),a=this._dealPath(this.scene1ExtPath3);for(let t=0;t<=8;++t)e.push(this.scene1BasePath[t]);t.forEach(t=>{e.push(t)});for(let t=9;t<=11;++t)e.push(this.scene1BasePath[t]);i.forEach(t=>{e.push(t)});for(let t=12;t<=16;++t)e.push(this.scene1BasePath[t]);n.forEach(t=>{e.push(t)});for(let t=17;t<=19;++t)e.push(this.scene1BasePath[t]);a.forEach(t=>{e.push(t)}),e.push(this.scene1BasePath[20])}return e}load(){Laya.loader.create("prefab/path/Scene1Path.prefab",Laya.Handler.create(this,function(t){let e=t.create();for(let t=0;t<100;++t){let i=e.getChildByName("b"+String(t));if(null==i)break;this.scene1BasePath.push({i:t,x:i.x,y:i.y})}for(let t=0;t<100;++t){let i=e.getChildByName("p0"+String(t));if(null==i)break;this.scene1ExtPath0.push({i:-1,x:i.x,y:i.y})}for(let t=0;t<100;++t){let i=e.getChildByName("p1"+String(t));if(null==i)break;this.scene1ExtPath1.push({i:-1,x:i.x,y:i.y})}for(let t=0;t<100;++t){let i=e.getChildByName("p2"+String(t));if(null==i)break;this.scene1ExtPath2.push({i:-1,x:i.x,y:i.y})}for(let t=0;t<100;++t){let i=e.getChildByName("p3"+String(t));if(null==i)break;this.scene1ExtPath3.push({i:-1,x:i.x,y:i.y})}}))}}class m{}m.LoginSceneId=0,m.CoffeeSceneId=1,m.BeachSceneId=2,m.FishingSceneId=3,m.TaskType={kDaily:2,kTrophy:1},m.TaskStatus={kRewarded:-1,kCompleted:1,kRunning:0},m.RedDotType={kTask:100},m.RewardType={fish:"FISH",star:"STAR"},m.SyncDelay=1e4,m.LetterBoxInterval=6e4,m.NetError=7770001;class C{static init(){t.getInstance().registEvent("CUSTOMDATA_CAT_RESTORE",null,C.restore)}static addCatData(t,e,i){let n=f.getInstance().addCatData(t,e);return n.setParams(i),n}static getCatsBySceneId(t){return f.getInstance().getCatsBySceneId(t)}static getCatCountBySceneId(t){return f.getInstance().getCatCountBySceneId(t)}static removeCatData(e,i){let n=f.getInstance().removeCatData(e,i);i==m.CoffeeSceneId?t.getInstance().postEvent("REMOVE_COFFEE_CAT",e):t.getInstance().postEvent("REMOVE_BEACH_CAT",n)}static getCatData(t){return f.getInstance().getCatData(t)}static randomFood(t){let e=null,n=t.randomFood();return i.getInstance().getConfig("Foods").forEach((t,i)=>{t.Type==n&&(e=t)}),e}static dump(){let t=JSON.stringify(obj);return console.debug(t),t}static restore(t){console.debug("restore cats",t),t&&t.scene1&&t.scene1.forEach(t=>{console.debug("restore",t),C.addCatData(t.id,m.CoffeeSceneId,t.params)}),t&&t.scene2&&t.scene1.forEach(t=>{C.addCatData(t.id,m.BeachSceneId,t.params)})}}class B extends Laya.Sprite{constructor(t){super(),this.prefab=null,this.countText=null,this.eventData=t,this.dropFishCount=0}onEnable(){Laya.loader.create("prefab/component/drop_fish.prefab",Laya.Handler.create(this,function(t){this.prefab=t.create(),this.width=this.prefab.width,this.height=this.prefab.height,this.pivotX=this.prefab.width/2,this.pivotY=this.prefab.height/2,this.addChild(this.prefab),this.countText=this.prefab.getChildByName("coutText"),this.countText.visible=!1,l.fadein(this,3e3)}))}addDropFish(){this.dropFishCount++,this.countText&&(this.countText.visible=!0,this.countText.text="+"+String(this.dropFishCount))}onDisable(){}}var L={Left:1,Right:-1};class _{static doMoveTo(t,e,i,n,a){let s=l.randomRangePoint({x:i,y:n},20),r=t.x-s.x,o=t.y-s.y,h=Math.sqrt(r*r+o*o)/e,c=Laya.Tween.to(t,{x:s.x,y:s.y},1e3*h,null,a,0);var d=t.getCurAnim();s.y-t.y>0?"move1"!=d&&t.playAnim("move1",!0):s.y-t.y<0&&"move2"!=d&&t.playAnim("move2",!0);let g=L.Left;return s.x-t.x>0&&(g=L.Right),t.scaleX=Math.abs(t.scaleX)*g,c}static refreshReward(e){if(null==e.buildingExtInfo.getBuildingExtInfoMgr().getDropFishPoint()){let i=_.getReward(e.event,e.valueBase);if(null!=i){let e=Number(i[1]);t.getInstance().postEvent("REFRESH_FISH",e)}}else{let t=e.buildingExtInfo.getBuildingExtInfoMgr().getDropFish();if(t)t.addDropFish();else{let t=new B(e.event);e.buildingExtInfo.getBuildingExtInfoMgr().pushDropFish(t);let i=u.getInstance().getScene(1),n=e.buildingExtInfo.getBuildingExtInfoMgr().getDropFishPointPosition(),a=new Laya.Point(n.x,n.y);e.buildingExtInfo.getBuildingExtInfoMgr().getDropFishPoint().localToGlobal(a,!1,i.root),i.root.addChild(t),t.x=a.x,t.y=a.y,t.zOrder=e.building.zOrder}}}static getReward(t,e){let i=null,n=t.CompleteReward,a=l.randomExt(100)+1;return n.forEach(t=>{if(a>0&&null!=t&&""!=t){let n=t.split(":"),s=Number(n[0]),r=Number(n[1]);s>=a?(i=r*e,a=-1):a-=s}}),i}static randomNextEvent(t,e){if(0==e.NextEvent.length)return null;let i=new Array;for(let n=0;n<e.NextEvent.length;++n){let a=e.NextEvent[n];null!=y.randomVisitBuilding(t,a)&&i.push(a)}return 0==i.length?null:i[l.randomExt(i.length)]}static randomStand(t,e,i){let n=new Array("lick1","rest1","rest2"),a=n[l.randomExt(n.length)];t.playAnim(a,!0),Laya.timer.once(e,t,function(){i.run()})}static findCatMoveBlock(t){if(null==t)return{t:3,b:null};if(0==t.getBuildingExtInfoMgr().getBuildingExtInfoCount())return{t:3,b:null};let e=t.getBuildingExtInfoMgr().getNotBusyBuildingExtInfo();return null!=e?{t:1,b:e}:{t:2,b:null}}static waitCoffeeCatMoveBlock(t,e,i){null!=t&&"lick1"!=t.getCurAnim()&&t.playAnim("lick1");let n=_.findCatMoveBlock(e);1==n.t?null!=n.b&&null!=i&&i.runWith(n.b):2==n.t&&null!=n.b?(new Laya.Timer).once(1e3,this,function(){_.waitCoffeeCatMoveBlock(t,e,i)}):null!=i&&i.runWith(null)}static waitBeachCatMoveBlock(t,e,i){let n=_.findCatMoveBlock(e);1==n.t?null!=n.b&&null!=i&&i.runWith(n.b):2==n.t?(new Laya.Timer).once(1e3,this,function(){_.waitBeachCatMoveBlock(t,e,i)}):null!=i&&i.runWith(null)}}class S extends Laya.Script{constructor(){super(),this.eventCount=0,this.eventActionConfig=i.getInstance().getConfig("ActionEvent"),this.targetEvent=null,this.targetBuildingData=null,this.speed=180,this.path=I.getInstance().randomPath(m.CoffeeSceneId),this.pathIndex=-1,this.upOrder=999999,this.downOrder=50}onMouseDownkCat(){}onStart(){this.owner.registerMouseDown(this,this.onMouseDownkCat),this.owner.playAnim("stand",!0),Laya.timer.loop(2e3,this,this.onActive)}onActive(){let t=u.getInstance().getScene(m.CoffeeSceneId).getBuildingRootInfoCount();u.getInstance().getScene(m.CoffeeSceneId).getActiveCatCount()<=t+6&&(this.resetToVisitEvent(),this.owner.setIsActive(!0),Laya.timer.clear(this,this.onActive))}resetToVisitEvent(){let t=this.owner.catData.getEventVisit();this._doActionEvent(t)}_doActionEvent(t){this._genTarget(t);let e=this.eventActionConfig.get(t);null==e?null!=this.targetBuildingData||this._doLeave():this._doWork(e)}_doLeave(){this._goToTargetIndex(0,new Laya.Handler(this,function(){l.fadeout(this.owner,1e3,new Laya.Handler(this,function(){C.removeCatData(this.owner.getData().getCatId(),m.CoffeeSceneId)}))}))}_genTarget(t){this.targetBuildingData=null,this.targetEvent=null;let e=y.randomVisitBuilding(m.CoffeeSceneId,t);null!=e&&(this.targetBuildingData=e,this.targetEvent=event)}_gotoBuilding(t,e){let i=t.getLocationData().getPathPointIndex();for(let t=0;t<this.path.length;++t){if(this.path[t].i==i){i=t;break}}this._goToTargetIndexAndStand(i,e)}_goToTargetIndexAndStand(t,e){l.randomExt(100)>97?_.randomStand(this.owner,3e3+l.randomExt(6e3),new Laya.Handler(this,function(){this._goToTargetIndex(t,e)})):this._goToTargetIndex(t,e)}_goToTargetIndex(t,e){if(this.pathIndex!=t){-1==this.pathIndex&&(this.pathIndex=0);let i=t-this.pathIndex;i>0?this.pathIndex++:i<0&&this.pathIndex--;let n=this.path[this.pathIndex];_.doMoveTo(this.owner,this.speed,n.x,n.y,new Laya.Handler(this,function(){n.i==I.getInstance().getZOrderPathPoint()&&(t>this.pathIndex?this.owner.zOrder=this.upOrder:t<this.pathIndex&&(this.owner.zOrder=this.downOrder)),this._goToTargetIndexAndStand(t,e)}))}else null!=e&&e.run()}_doWork(t){"VISIT"==t.Type?this._doActionEvent(_.randomNextEvent(m.CoffeeSceneId,t)):this._gotoBuilding(this.targetBuildingData,new Laya.Handler(this,function(){let e=u.getInstance().getScene(m.CoffeeSceneId).getBuilding(this.targetBuildingData.getId());_.waitCoffeeCatMoveBlock(this.owner,e,new Laya.Handler(this,function(i){null!=e&&null!=i?(i.setIsBusy(!0),this.owner.showMaskAnim(new Laya.Handler(this,function(){l.fadeout(this.owner,500,new Laya.Handler(this,function(){let n=1;"REST"==t.Type&&(n=2);e.showInteractCat(n,this.owner.catData,i,6e3,new Laya.Handler(this,function(n){l.fadein(this.owner,500,new Laya.Handler(this,function(){i.setIsBusy(!1),null!=n?(_.refreshReward({event:t,buildingExtInfo:i,building:e,valueBase:this.owner.catData.getValueBase()}),this.eventCount++,this.eventCount>=2?this._doLeave():this._doActionEvent(_.randomNextEvent(m.CoffeeSceneId,t))):this._doLeave()}))}))}))}))):this.resetToVisitEvent()}))}))}}class E{constructor(){}static getInstance(){return E.instance?E.instance:E.instance=new E}createCoffeeCat(t,e,i){let n=new o(t);return n.loadAnim(t.getSource()+".sk"),n.addComponent(S),n.addLoadedHandler(function(){e.addChild(n),n.playAnim("lick1",!0),l.fadein(n,500,new Laya.Handler(this,function(){null!=i&&i()}))}),n}}class b{constructor(){this.buildingRoot=null,this.move=null,this.isBusy=!1,this.isFlip=!1,this.buildingExtInfoMgr=null}setBuildingExtInfoMgr(t){this.buildingExtInfoMgr=t}getBuildingExtInfoMgr(){return this.buildingExtInfoMgr}addToBuildingRoot(t){null!=this.buildingRoot&&this.buildingRoot.addChild(t)}setBuildingRoot(t){this.buildingRoot=t,null!=this.buildingRoot&&(this.buildingRoot.mouseThrough=!0)}getBuildingRoot(){return this.buildingRoot}setMove(t){this.move=t.split(":")}getMove(){return this.move}getBuildingRootWidth(){return this.buildingRoot.width}getBuildingRootHalfWidth(){return this.getBuildingRootWidth()/2}getBuildingRootHeight(){return this.buildingRoot.height}getBuildingRootHalfHeight(){return this.getBuildingRootHeight()/2}randomCatMove(){if(null!=this.move){let t=l.randomExt(this.move.length);return this.move[t]}return null}setIsBusy(t){this.isBusy=t}getIsBusy(){return this.isBusy}setIsFlip(t){this.isFlip=t}getIsFlip(){return this.isFlip}onCatEatRemoveFunc(t){this._onRemoveCatFunc(t)}onCatRestRemoveFunc(t){this._onRemoveCatFunc(t)}onFadeInFunc(t){this._onRemoveCatFunc(t)}onTimeOutRemoveCatFunc(t){t.menuTipPrefab.isClicked=!0,t.anim.visible=!0,t.menuTipPrefab.visible=!1,t.anim.play("shengqi",!0);let e=t.cat,i=t.handler;t.catData;Laya.timer.once(1e3,this,this._onRemoveCatFunc,new Array({cat:e,handler:i}))}_onRemoveCatFunc(t){t.cat.removeSelf(),t.handler.runWith(t.catData)}cleanBuildingExtInfo(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}}class w{constructor(t){this.buildingData=t,this.dropPoint=null,this.dropFishArray=null,this.buildingExtInfoArray=new Array}pushBuildingExtInfo(t){t.setBuildingExtInfoMgr(this),this.buildingExtInfoArray.push(t)}getNotBusyBuildingExtInfo(){for(let t=0;t<this.buildingExtInfoArray.length;++t){let e=this.buildingExtInfoArray[t];if(0==e.getIsBusy())return e}return null}getBuildingExtInfoCount(){return this.buildingExtInfoArray.length}clearInteractCat(){for(let t=0;t<this.buildingExtInfoArray.length;++t){let e=this.buildingExtInfoArray[t],i=e.getBuildingRoot();if(null!=e&&null!=i)for(let t=0;t<i.numChildren;++t){let t=i.getChildAt(0);null!=t&&C.removeCatData(t.getData().getCatId(),this.buildingData.getBelongScene())}}}setDropFishPoint(t){this.dropPoint=t,null!=this.dropPoint&&(this.dropFishArray=new Array,this.dropPoint.on(Laya.Event.MOUSE_DOWN,this,function(){for(let t=0;t<this.dropFishArray.length;++t){let e=this.dropFishArray[t];e.zOrder=9999999;let i=400+l.randomExt(400);Laya.Tween.to(e,{x:1400,y:73},i,null,Laya.Handler.create(this,function(){e.removeSelf()}),0)}this.dropFishArray.splice(0,this.dropFishArray.length)}))}pushDropFish(t){this.dropFishArray.push(t)}getDropFish(){return 0==this.dropFishArray.length?null:this.dropFishArray[0]}getDropFishPoint(){return this.dropPoint}getDropFishPointPosition(){return new Laya.Point(this.dropPoint.width/2,this.dropPoint.height/2)}cleanBuildingExtInfoMgr(){for(let t=0;t<this.buildingExtInfoArray.length;++t)this.buildingExtInfoArray[t].cleanBuildingExtInfo()}}class v{constructor(t,e,i,n,a){this.cat=t,Laya.loader.create("prefab/component/cat_menu_tip.prefab",Laya.Handler.create(this,function(t){this.menuTipPrefab=t.create(),this.buildingExtInfo=e,this.anim=i,this.time=n,this.handler=a,this.initCatMenuTip()}))}initCatMenuTip(){let t=this.handler,e=this.cat,i=this.cat.getData(),n=this.anim,a=this.menuTipPrefab;this.cat.addChild(this.menuTipPrefab);let s=C.randomFood(this.cat.getData()),r=this.menuTipPrefab.getChildByName("meals_img");r.loadImage(s.Source,Laya.Handler.create(this,function(){r.x-=r.width/2*r.scaleX,r.y-=r.height/2*r.scaleY})),this.menuTipPrefab.y=-250,this.menuTipPrefab.x=-10;let o=new Laya.Panel;o.width=200,o.height=200,o.centerX=.5,o.y=-o.height,this.cat.addChild(o),o.on(Laya.Event.CLICK,this,function(){1!=this.menuTipPrefab.isClicked&&(Laya.timer.clear(this.buildingExtInfo,this.buildingExtInfo.onTimeOutRemoveCatFunc),e.playAnim("eat1"),this.menuTipPrefab.isClicked=!0,this.menuTipPrefab.visible=!1,this.anim.visible=!0,this.anim.play("chifan2",!0),Laya.timer.once(this.time,this.buildingExtInfo,this.buildingExtInfo.onCatEatRemoveFunc,new Array({cat:e,handler:t,catData:i})))}),Laya.timer.once(1e4,this.buildingExtInfo,this.buildingExtInfo.onTimeOutRemoveCatFunc,new Array({anim:n,cat:e,handler:t,catData:i,menuTipPrefab:a}))}}class T extends Laya.Tree{constructor(){super(),this.buildingData=null,this.anim=null,this.prefab=null,this.buildingExtInfoMgr=null,this.mouseThrough=!0}setData(t){this.buildingData=t,this.buildingExtInfoMgr=new w(this.buildingData)}getData(){return this.buildingData}onDisable(){}cleanBuilding(){this.getBuildingExtInfoMgr().cleanBuildingExtInfoMgr(),this.getBuildingExtInfoMgr().clearInteractCat()}getBuildingExtInfoMgr(){return this.buildingExtInfoMgr}judgeTouch(){let t=this.prefab.getChildByName("touch");null!=t&&t.on(Laya.Event.CLICK,this,this.onClick)}judgeAnim(){for(let t=0;t<5;++t){let e=this.prefab.getChildByName("spineAnim_"+String(t));if(null==e||null==e.text||""==e.text)break;{let t=e.text.split(":"),i=t[0],n=t[1],a=new Laya.Skeleton;a.load(i,Laya.Handler.create(this,function(){this.prefab.addChild(a),a.x=e.x,a.y=e.y,a.play(n,!0)}))}}}judgeDropPoint(){let t=this.prefab.getChildByName("dropPoint");t&&this.buildingExtInfoMgr.setDropFishPoint(t)}judgeBuildingRoot(){for(let t=0;t<5;++t){let e=new b,i=this.prefab.getChildByName("buildingRoot_"+String(t)),n=this.prefab.getChildByName("move_"+String(t)),a=1;if(null!=this.prefab.getChildByName("flip_"+String(t))&&(a=-1),null==i)break;e.setBuildingRoot(i),e.setMove(n.text),e.setIsBusy(!1),e.setIsFlip(a),this.buildingExtInfoMgr.pushBuildingExtInfo(e)}}loadResource(t,e){-1!=t.indexOf(".prefab")&&Laya.loader.create(t,Laya.Handler.create(this,function(t){this.prefab=t.create(),this.prefab.mouseThrough=!0,this.width=this.prefab.width,this.height=this.prefab.height,this.pivotX=this.prefab.width/2,this.pivotY=this.prefab.height/2,this.addChild(this.prefab),this.judgeDropPoint(),this.judgeTouch(),this.judgeAnim(),this.judgeBuildingRoot(),null!=e&&e()}))}showInteractCat(t,e,i,n,a){if(null!=i){let s=new o(e);return s.loadAnim(e.getSource()+".sk"),s.addLoadedHandler(function(){if(i.addToBuildingRoot(s),s.playAnim(i.randomCatMove()),s.x=i.getBuildingRootHalfWidth(),s.y=i.getBuildingRootHalfHeight(),s.scaleX=i.getIsFlip()*Math.abs(s.scaleX),0==t)l.fadein(s,500,new Laya.Handler(this,function(){Laya.timer.once(n,i,i.onFadeInFunc,new Array({cat:s,handler:a,catData:e}))}));else if(1==t){let t=new Laya.Skeleton;t.load("anim/UIdonghua.sk",Laya.Handler.create(this,function(){t.y=-150,s.addChild(t),t.visible=!1;new v(s,i,t,n,a)}))}else 2==t&&Laya.timer.once(n,i,i.onCatRestRemoveFunc,new Array({cat:s,handler:a,catData:e}))}),s}return null}onClick(){u.getInstance().switchScene(m.FishingSceneId),t.getInstance().postEvent("NEXT_GUIDE")}}class k extends Laya.Script{constructor(){super(),t.getInstance().registEvent("FORCE_ATTRACT_COFFEE_CAT",this,this.onForceAttractCat),this.catVisitWeightedArray=null,this.catDataArray=new Array}onEnable(){this.catDataArray=C.getCatsBySceneId(m.CoffeeSceneId),Laya.timer.loop(2e3,this,this.onAddCatData),Laya.timer.loop(1e4+l.randomExt(5e3),this,this.onAttractCat)}onDisable(){}onForceAttractCat(){this.onAttractCat()}onAttractCat(){if(this.catDataArray.length>0){let e=u.getInstance().getScene(m.CoffeeSceneId).getBuildingRootInfoCount();if(u.getInstance().getScene(m.CoffeeSceneId).getCatCount()<e+12){let e=this.catDataArray.pop();t.getInstance().postEvent("ADD_COFFEE_CAT",e)}}}onAddCatData(){this.catVisitWeightedArray=y.getCatWeightedArray(1);let t=y.getBuildingDataListInfo(1).weighted,e=l.randomExt(t),i={w:-1},n=null;for(let t=0;t<this.catVisitWeightedArray.length;++t){let a=this.catVisitWeightedArray[t];if(e>i.w&&e<a.w+i.w){n=a;break}i.w+=a.w}if(null!=n){if(C.getCatCountBySceneId(m.CoffeeSceneId)<30){let t=I.getInstance().getStartPathPoint();if(null!=t){let e="Cat1";l.randomExt(100)>=50&&(e="Cat3");let i=C.addCatData(e,m.CoffeeSceneId,{initPosition:l.randomRangePoint(new Laya.Point(t.x,t.y),100)});this.catDataArray.push(i)}}}}}class x{constructor(){}static get(t){return i.getInstance().getItemById("Const",String(t)).Value}static getArray(t){let e=x.get(t);return JSON.parse(e)}}class A extends Laya.Script{constructor(){super(),this.catVisitWeightedArray=null;let t=x.getArray("TravelTriggerGaps");this.randomTime=1e3*l.randomExt2(Number(t[0]),Number(t[1]))}onEnable(){this.catVisitWeightedArray=this.owner.getData().getCatWeightedArray(),this.catWeightedSum=this.owner.getData().getCatWeightedSum(),Laya.timer.loop(this.randomTime,this,this.onStartAttractCat)}onDisable(){}onStartAttractCat(){let t=l.randomExt(this.catWeightedSum),e={w:-1},i=null;for(let n=0;n<this.catVisitWeightedArray.length;++n){let a=this.catVisitWeightedArray[n];if(t>e.w&&t<a.w+e.w){i=a;break}e.w+=a.w}if(null!=i){let t=this.owner.getData(),e="Cat1";l.randomExt(100)>=50&&(e="Cat3");let i=new p(e),n=u.getInstance().getScene(2).getBuilding(t.getId()),a=_.findCatMoveBlock(n).b;if(null!=a){a.setIsBusy(!0);let t=x.getArray("TravelKeepTime"),e=l.randomExt2(Number(t[0]),Number(t[1]));n.showInteractCat(0,i,a,1e3*e,new Laya.Handler(this,function(t){a.setIsBusy(!1)}))}}}}class D{constructor(){this.cacheFish=0}static getInstance(){return D.instance?D.instance:D.instance=new D}getCapacity(){return this.capacity}setCapacity(t){this.capacity=t}getCacheFish(){return this.cacheFish}setCacheFish(t){this.cacheFish=t}setLastUpdateTime(t){this.lastUpdateMillis=t}getLastUpdateTime(){return this.lastUpdateMillis}clear(){this.cacheFish=0}}class R{static getTimeNowOnServer(){return+new Date+this.serverTsModify}static updateServerTime(t){let e=this.getTimeNowOnServer()-t;Math.abs(e)<2e3?(this.averageDelay=Math.trunc((this.averageDelay*this.calcCount+e)/(this.calcCount+1)),this.calcCount++,this.calcCount>1e3&&(this.calcCount=100)):(this.averageDelay=50,this.calcCount=0),this.serverTsModify=t+this.averageDelay-+new Date}}R.serverTsModify=0,R.calcCount=0,R.averageDelay=50;class N{static init(){}static scheduleUpdate(){Laya.timer.loop(m.SyncDelay,N,N.updateSceneInfo,[],!0,!0)}static forceUpdate(t){N.updateSceneInfo(t),N.scheduleUpdate()}static updateSceneInfo(e){let i=JSON.stringify({cats:f.getInstance().dump()});t.getInstance().postEvent("SERVICE_UPDATE_SCENE_INFO",[i,[{id:"FISH",count:1}],Laya.Handler.create(null,function(t){e&&e.runWith([t])})])}static restoreCustomData(e){let i=JSON.parse(e);t.getInstance().postEvent("CUSTOMDATA_CAT_RESTORE",[i.cats])}static getLetterBoxInfo(e){t.getInstance().postEvent("SERVICE_GET_LETTER_BOX_INFO",[e])}static fetchLetterBox(e){t.getInstance().postEvent("SERVICE_FETCH_LETTER_BOX",[e])}static updateLetterBox(e){if(null!=e.capacity&&D.getInstance().setCapacity(e.capacity),D.getInstance().setCacheFish(e.fishToReward||0),e.lastUpdateMillis){let t=e.lastUpdateMillis;0==t&&null==(t=D.getInstance().getLastUpdateTime())&&(t=R.getTimeNowOnServer()),D.getInstance().setLastUpdateTime(t)}t.getInstance().postEvent("UPDATE_LETTER_BOX")}static setCacheFish(t){D.getInstance().setCacheFish(t)}static getCacheFish(){return D.getInstance().getCacheFish()}static getCacheFishCapacity(){return D.getInstance().getCapacity()}static getLetterBoxNextUpdateInterval(){return(D.getInstance().getLastUpdateTime()||R.getTimeNowOnServer())+m.LetterBoxInterval-R.getTimeNowOnServer()}static clear(){Laya.timer.clear(null,N.updateSceneInfo)}}class P extends Laya.Script{constructor(){super(),this.costText=null,this.letterTip=null}onEnable(){this.autoIncomeLimit=N.getCacheFishCapacity()||this.owner.getData().getSpecialValue(),this.letterTip=this.owner.prefab.getChildByName("letter_tip"),this.costText=this.letterTip.getChildByName("cost_text"),this.letterTip.on(Laya.Event.MOUSE_DOWN,this,this.onClickTip),t.getInstance().registEvent("UPDATE_LETTER_BOX",this,this.updateLetterBox),this.updateLetterBox()}onClickTip(){if(N.getCacheFish()>0){this.costText.text=String(0),this.letterTip.visible=!1,N.fetchLetterBox();let t=N.getLetterBoxNextUpdateInterval()+500;for(;t<=5e3;)t+=m.LetterBoxInterval;Laya.timer.once(t,this,this.onAddCatTip,[],!0)}}onAddCatTip(){let t=y.getAutoIncomeSum(),e=N.getCacheFish();console.debug("onAddCatTip",e,t);let i=Number(e)+Number(t);i>=this.autoIncomeLimit&&(i=this.autoIncomeLimit),N.setCacheFish(i),this.costText.text=String(i),this.letterTip.visible=!0,N.getLetterBoxInfo();let n=N.getLetterBoxNextUpdateInterval()+500;for(;n<=5e3;)n+=m.LetterBoxInterval;Laya.timer.once(n,this,this.onAddCatTip,[],!0)}updateLetterBox(){let t=N.getCacheFish();this.costText.text=String(t),this.letterTip.visible=t>0;let e=N.getLetterBoxNextUpdateInterval()+500;for(;e<=0;)e+=m.LetterBoxInterval;Laya.timer.once(e,this,this.onAddCatTip,[],!0)}onDisable(){t.getInstance().removeEvent("UPDATE_LETTER_BOX",this,this.updateLetterBox),Laya.timer.clear(this,this.onAddCatTip)}}class M{constructor(){}static getInstance(){return M.instance?M.instance:M.instance=new M}createBuilding(t,e,i){var n=new T;return n.setData(t),n.loadResource(t.getSource(),function(){e.addChild(n);let a=t.getLocationData();n.pos(Number(a.getX()),Number(a.getY())),n.zOrder=Number(a.getZOrder());let s=t.getBelongScene();s==m.CoffeeSceneId||s==m.BeachSceneId&&n.addComponent(A),1==t.getSpecialTpye()&&n.addComponent(P),l.fadein(n,1e3,new Laya.Handler(this,function(){null!=i&&i()}))}),n}static createBuildingBaseSelector(t,e){let i=new Laya.Sprite;return i.loadImage("facility/jianzhu"+(t.getBaseSize()+1)+".png"),i.mouseEnabled=!0,e.addChild(i),i.pos(Number(t.getSelectionX()),Number(t.getSelectionY())),i.zOrder=Number(t.getZOrder()),i}}class F{}class H{constructor(t,e){this._level=e,this._unlocked=!1,this._config=t}unlock(){this._unlocked=!0}isLocked(){return!this._unlocked}getId(){return this._config.Id}getName(){return this._config.Name}getDesc1(){return this._config.Desc1}getShopItems(){return this._config.ShopItems}getLimit(){return this._config.Limit}getCost(){return this._config.Cost}getIncome(){return this._config.Income}getCookingTime(){return this._config.CookingTime}getLevel(){return this._level}clear(){this._unlocked=!1}}class O{constructor(){this._foodsMap=new Map,this.foodListMap=new Map,this.cookBook=new Map,this.initFoods()}static getInstance(){return O.instance?O.instance:O.instance=new O}initFoods(){let t=i.getInstance().getConfig("FoodsList"),e=i.getInstance().getConfig("Foods"),n=this;t.forEach(function(t){let i=new Array;JSON.parse(t.foodsList).forEach(t=>{let a=String(t.foodId),s=Number(t.lv),r=new H(e.get(a),s);n._foodsMap.set(a,r),i.push(r)}),i.sort(function(t,e){return t.getLevel()-e.getLevel()}),n.foodListMap.set(t.Id,i),n.cookBook.set(t.Id,i[0])})}clear(){this._foodsMap.forEach(t=>{t.clear()});let t=this;this.foodListMap.forEach((e,i)=>{t.cookBook.set(i,e[0])})}getFood(t){return this._foodsMap.get(t)}getFoodList(t){return this.foodListMap.get(t)}getCurFoodInList(t){return this.cookBook.get(String(t))}updateFood(t,e){let i=this.foodListMap.get(t),n=this.cookBook.get(t);if(n.isLocked()&&n.getLevel()==e)return n.unlock(),!0;if(n.getLevel()!=e){let n=i[e-1];if(n){this.cookBook.set(t,n);for(let t=0;t<=e-1;t++)i[t].unlock();return!0}}return!1}getNextLevelUpFoodInList(t){let e=this.getCurFoodInList(t);if(e.isLocked())return e;return this.getFoodList(t)[e.getLevel()]}getAvailableFood(t){let e=this.cookBook.get(t);return e.isLocked()?null:e}}class U{static init(){}static clear(){O.getInstance().clear()}static updateFoods(e){if(e.menu){let i=!1;Object.getOwnPropertyNames(e.menu).forEach(t=>{let n=e.menu[t];i=O.getInstance().updateFood(t,n)||i}),i&&t.getInstance().postEvent("UPDATE_FOODS")}}static getFood(t){return O.getInstance().getFood(t)}static getFoodList(t){return O.getInstance().getFoodList(t)}static getCurFoodInList(t){return O.getInstance().getCurFoodInList(t)}static getAvailableFood(t){return O.getInstance().getAvailableFood(t)}static getNextLevelUpFoodInList(t){return O.getInstance().getNextLevelUpFoodInList(t)}static checkLevelUpUnAvailable(t){let e=U.getNextLevelUpFoodInList(t);return e.getLimit()>s.getStar()?"评价不足":e.getCost()>s.getFish()&&"还差"+String(e.getCost()-s.getFish())+"鱼干"}static getPlayerFoodMenu(e){t.getInstance().postEvent("SERVICE_GET_PLAYER_FOOD_MENU",[e])}static foodLevelUp(e,i){t.getInstance().postEvent("SERVICE_FOOD_LEVELUP",[e,i])}}class W{constructor(t){this.config=i.getInstance().getItemById("Task",t)}getId(){return this.config.Id}getName(){return this.config.Name}getDesc(){return this.config.Desc}setProgress(t,e){return(t!=this.current||e!=this.target||1==this.rewarded)&&(this.current=t,this.target=e,this.rewarded=!1,!0)}getCurrent(){return this.current?this.current>this.getTarget()?this.getTarget():this.current:0}getTarget(){return this.target?this.target:this.config.ConditionValue}getRewardType(){return this.config.RewardType}getReward(){return this.config.Reward}getStatus(){return this.rewarded?m.TaskStatus.kRewarded:this.getCurrent()>=this.getTarget()?m.TaskStatus.kCompleted:m.TaskStatus.kRunning}setRewarded(){return!this.rewarded&&(this.rewarded=!0,this.current=this.getTarget(),!0)}}class q{constructor(){this.dailyTaskMap=new Map,this.trophyTaskMap=new Map,this.initTasks()}initTasks(){let t=i.getInstance().getConfig("TaskList"),e=this;t.forEach(function(t,i){let n=e.dailyTaskMap;t.TaskType==m.TaskType.kTrophy&&(n=e.trophyTaskMap),n.set(t.Id,new W(t.List[0]))})}static getInstance(){return q.instance?q.instance:q.instance=new q}setDirty(t){this.dirtyFlag=t}hasCompletedTask(){if(1==this.dirtyFlag)return!0;if(-1==this.dirtyFlag)return!1;return this.hasCompletedDailyTask()||this.hasCompletedTrophyTask()}hasCompletedDailyTask(){let t=!1;return this.dailyTaskMap.forEach(function(e,i){e.getStatus()==m.TaskStatus.kCompleted&&(t=!0)}),t}hasCompletedTrophyTask(){let t=!1;return this.trophyTaskMap.forEach(function(e,i){e.getStatus()==m.TaskStatus.kCompleted&&(t=!0)}),t}getCurrentTask(t){let e=i.getInstance().getItemById("TaskList",t),n=this.dailyTaskMap;return e.TaskType==m.TaskType.kTrophy&&(n=this.trophyTaskMap),n.get(t)}updateTask(t,e,n,a,s){s&&s.delete(t);let r=i.getInstance().getItemById("TaskList",t),o=this.dailyTaskMap;r.TaskType==m.TaskType.kTrophy&&(o=this.trophyTaskMap);let l=o.get(t);return l.getId()==e?l.setProgress(n,a):((l=new W(e)).setProgress(n,a),o.set(t,l),!0)}getChecklist(){let t=new Map;return i.getInstance().getConfig("TaskList").forEach(function(e,i){t.set(i,!0)}),t}setUnUpdatedTaskCompleted(t){let e=!1;if(t){let n=this;t.forEach(function(t,a){if(t){let t=i.getInstance().getItemById("TaskList",a),s=n.dailyTaskMap;t.TaskType==m.TaskType.kTrophy&&(s=n.trophyTaskMap);let r=s.get(a);r.getId()==t.List[t.List.length-1]?r.setRewarded()&&(e=!0):((r=new W(t.List[t.List.length-1])).setRewarded(),s.set(a,r),e=!0)}})}return e}clear(){this.dailyTaskMap.clear(),this.trophyTaskMap.clear(),this.initTasks()}}class G{static init(){}static setDirty(t){q.getInstance().setDirty(t)}static updateTasks(e){q.getInstance().setDirty(null);let i=e.dailyTasks,n=e.trophyTasks,a=q.getInstance().getChecklist(),s=!1;[i,n].forEach(t=>{t&&Object.getOwnPropertyNames(t).forEach(e=>{let i=t[e],n=i.id,r=i.taskListId,o=i.current,l=i.target;s=q.getInstance().updateTask(r,n,o,l,a)||s})}),(s=q.getInstance().setUnUpdatedTaskCompleted(a)||s)&&t.getInstance().postEvent("UPDATE_TASKS"),t.getInstance().postEvent("REDPOINT_REFRESH",["task"])}static hasCompletedTask(){return q.getInstance().hasCompletedTask()}static hasCompletedDailyTask(){return q.getInstance().hasCompletedDailyTask()}static hasCompletedTrophyTask(){return q.getInstance().hasCompletedTrophyTask()}static getCurrentTask(t){return q.getInstance().getCurrentTask(t)}static getAllTasks(e){t.getInstance().postEvent("SERVICE_GET_ALLTASKS",[e])}static getDailyTaskReward(e,i){t.getInstance().postEvent("SERVICE_GET_DAILY_TASK_REWARD",[e,i])}static getTrophyTaskReward(e,i){t.getInstance().postEvent("SERVICE_GET_TROPHY_TASK_REWARD",[e,i])}}class V{constructor(){this.redPointMap=new Map}static getInstance(){return V.instance?V.instance:V.instance=new V}registerObject(t,e){let i=this.redPointMap.get(t);null==i&&(i=new Map,this.redPointMap.set(t,i)),i.set(e,!0)}unregisterObject(t,e){let i=this.redPointMap.get(t);null!=i&&i.delete(e)}refreshRedPoint(t,e){let i=this.redPointMap.get(t);console.debug("refresh red point map",i),null!=i&&i.forEach((t,i)=>{i.refreshRedPoint(e)})}clear(){this.redPointMap.clear()}}class K{static init(){t.getInstance().registEvent("REDPOINT_REFRESH",null,K.refreshRedPoint)}static registerObject(t,e){V.getInstance().registerObject(t,e)}static unregisterObject(t,e){V.getInstance().unregisterObject(t,e)}static refreshRedPoint(t,e){V.getInstance().refreshRedPoint(t,e)}}class j{static stringToByte(t){var e,i,n=new Array;e=t.length;for(var a=0;a<e;a++)(i=t.charCodeAt(a))>=65536&&i<=1114111?(n.push(i>>18&7|240),n.push(i>>12&63|128),n.push(i>>6&63|128),n.push(63&i|128)):i>=2048&&i<=65535?(n.push(i>>12&15|224),n.push(i>>6&63|128),n.push(63&i|128)):i>=128&&i<=2047?(n.push(i>>6&31|192),n.push(63&i|128)):n.push(255&i);return n}static byteToString(t){if("string"==typeof t)return t;for(var e="",i=t,n=0;n<i.length;n++){var a=i[n].toString(2),s=a.match(/^1+?(?=0)/);if(s&&8==a.length){for(var r=s[0].length,o=i[n].toString(2).slice(7-r),l=1;l<r;l++)o+=i[l+n].toString(2).slice(2);e+=String.fromCharCode(parseInt(o,2)),n+=r-1}else e+=String.fromCharCode(i[n])}return e}static bytesToHexString(t){return Array.from(t,function(t){return("0"+(255&t).toString(16)).slice(-2)}).join("")}static hexString2Bytes(t){var e=0,i=t.length;if(i%2!=0)return null;i/=2;for(var n=new Array,a=0;a<i;a++){var s=t.substr(e,2),r=parseInt(s,16);n.push(r),e+=2}return n}static base64ToBytes(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var i=[],n=0,a=0;n<t.length;a=++n%4)0!=a&&i.push((e.indexOf(t.charAt(n-1))&Math.pow(2,-2*a+8)-1)<<2*a|e.indexOf(t.charAt(n))>>>6-2*a);return i}static byteToBase64String(t){for(var e="",i=new Uint8Array(t),n=i.byteLength,a=0;a<n;a++)e+=String.fromCharCode(i[a]);return window.btoa(e)}static Int8parse(t){for(var e=t.length,i=[],n=0;n<e;n++)i[n>>>2]|=(255&t[n])<<24-n%4*8;return CryptoJS.lib.WordArray.create(i,e)}static rsaIntToBytes(t,e){for(var i=t.toByteArray(),n=0;n<i.length&&0==i[n];)++n;if(i.length-n!=e-1||2!=i[n])return null;for(++n;0!=i[n];)if(++n>=i.length)return null;for(var a=[];++n<i.length;){var s=255&i[n];a.push(s)}return a}static createRandom16Bytes(){for(var t=new Int8Array(16),e=0;e<16;e++){var i=Math.floor(65536*Math.random());t[e]=255&i}return t}static paddingBytesTo16Times(t){var e=t instanceof Array?t.length:t.byteLength;if(e%16==0)return new Int8Array(t);var i=new Int8Array(e+16-e%16);if(t instanceof Array)for(var n=0;n<e;n++)i[n]=t[n];else i.set(new Int8Array(t),0);for(n=0;n<16-e%16;n++)i[e+n]=0;return i}static aesEncrypt(t,e){var i=new Laya.Byte;i.endian=Laya.Socket.BIG_ENDIAN;var n=j.paddingBytesTo16Times(t),a=CRC32.buf(new Uint8Array(t)),s=j.createRandom16Bytes(),r=CryptoJS.AES.encrypt(j.Int8parse(n),e,{iv:CryptoJS.lib.WordArray.create(s,16),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.NoPadding}),o=j.base64ToBytes(r.toString());return i.writeInt32(a),i.writeInt32(t.byteLength),i.writeArrayBuffer(s,0,s.length),i.writeArrayBuffer(o,0,o.length),i.buffer}static aesDecrypt(t,e,i,n,a){var s=CryptoJS.AES.decrypt(j.byteToBase64String(new Int8Array(n)),a,{iv:CryptoJS.lib.WordArray.create(new Int8Array(i),16),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.NoPadding}),r=j.hexString2Bytes(s.toString()),o=new Laya.Byte(r).readArrayBuffer(e);return CRC32.buf(new Uint8Array(o))!=t?null:o}}class X{constructor(){}static getRequestMap(){var t={"Player.LoginReq":10001,"Player.LogoutReq":10002,"Player.OnlineCrossDayReq":10003,"Building.GetAllBuildingReq":10101,"Building.PutBuildingReq":10102,"Building.RemoveBuildingReq":10103,"Scene.UpdateSceneInfoReq":10201,"Scene.FetchLetterBoxReq":10202,"Scene.GetLetterBoxInfoReq":10203,"Task.GetAllTasksReq":10301,"Task.getDailyTaskRewardReq":10302,"Task.getTrophyTaskRewardReq":10303,"Food.GetPlayerFoodMenuReq":10401,"Food.FoodLevelUpReq":10402};return t}static getResponseMap(){var t={10001:"Player.LoginRes",10002:"Player.LogoutRes",10003:"Player.OnlineCrossDayRes",10101:"Building.GetAllBuildingRes",10102:"Building.PutBuildingRes",10103:"Building.RemoveBuildingRes",10201:"Scene.UpdateSceneInfoRes",10202:"Scene.FetchLetterBoxRes",10203:"Scene.GetLetterBoxInfoRes",10301:"Task.GetAllTasksRes",10302:"Task.getDailyTaskRewardRes",10303:"Task.getTrophyTaskRewardRes",10401:"Food.GetPlayerFoodMenuRes",10402:"Food.FoodLevelUpRes"};return t}static getNotifyProtoMap(){var t={1001:"PlayerPushMsg.TestMsg",1002:"PlayerPushMsg.ReddotMsg"};return t}}class z{constructor(){this._protoBuf=Laya.Browser.window.protobuf,this._requestRoot=new this._protoBuf.Root,this._notifyRoot=new this._protoBuf.Root,this._requestRoot._owner=this,this._notifyRoot._owner=this,this._requestProtoIDs=X.getRequestMap(),this._responseProtoIDs=X.getResponseMap(),this._notifyProtoIDs=X.getNotifyProtoMap(),this._totalProtoCount=0,this._loadedProtoCount=0,this._loadedHandler=null,this._eventDispatcher=new Laya.EventDispatcher}static getInstance(){return z.instance?z.instance:z.instance=new z}init(t){this._loadedHandler=t,this._totalProtoCount=0;var e={},i={};for(var n in this._requestProtoIDs){var a=n.split(".");e["res/protocol/request/"+(this._requestProtoIDs[n]-this._requestProtoIDs[n]%100)+"_"+a[0]+".proto"]=1}for(var n in this._notifyProtoIDs){i["res/protocol/notify/"+(n-n%100)+"_"+(a=this._notifyProtoIDs[n].split("."))[0]+".proto"]=1}for(var n in e)this._totalProtoCount++,this._protoBuf.load(n,this._requestRoot,this._onLoadProto);for(var n in i)this._totalProtoCount++,this._protoBuf.load(n,this._notifyRoot,this._onLoadProto)}_onLoadProto(t,e){if(t)throw t;e._owner._loadedProtoCount++,e._owner._loadedProtoCount>=e._owner._totalProtoCount&&e._owner._loadedHandler&&e._owner._loadedHandler.run()}onEnable(){}onDisable(){}getOpcode(t){return this._requestProtoIDs[t]}encodeRequest(t,e){var i=this._requestRoot.lookup(t);if(!i)return console.error("没有找到协议信息: "+t),null;var n=i.verify(e);if(n)throw Error(n);return i.encode(e).finish()}decodeResponse(t,e){var i=this._responseProtoIDs[t];if(!i)return console.error("没有ID为: "+t+" 的协议！"),null;var n=this._requestRoot.lookup(i);return n?n.decode(e):(console.error("没有找到协议信息: "+i),null)}decodeNotify(t,e){var i=this._notifyProtoIDs[t];if(!i)return console.error("没有ID为: "+t+" 的协议！"),null;var n=this._notifyRoot.lookup(i);return n?n.decode(e):(console.error("没有找到协议信息: "+i),null)}encodeNotify(t,e){var i=this._notifyProtoIDs[t];if(!i)return console.error("没有ID为: "+t+" 的协议！"),null;var n=this._notifyRoot.lookup(i);if(!n)return console.error("没有找到协议信息: "+i),null;var a=n.verify(e);if(a)throw Error(a);return n.encode(e).finish()}registerNotifyCallback(t,e,i,n){this._eventDispatcher.offAll("NotifyCallback_"+t),this._eventDispatcher.on("NotifyCallback_"+t,e,i,n)}handlerNotify(t,e){this._eventDispatcher.event("NotifyCallback_"+t,e)}}class J{constructor(t,e,i){this._requestName=t,this._param=e,this._handler=i,this._buffer=null}getRequestName(){return this._requestName}getParam(){return this._param}getHandler(){return this._handler}setBuffer(t){this._buffer=t}getBuffer(){return this._buffer}}class Y{constructor(){this._initFinished=!1,this._waitInitHandlers=new Array,this._connectReady=!1,this._heartTimer=Laya.timer,this._socket=new Laya.Socket,this._socket.endian=Laya.Socket.BIG_ENDIAN,this._socket.on(Laya.Event.OPEN,this,this._openHandler),this._socket.on(Laya.Event.MESSAGE,this,this._receiveHandler),this._socket.on(Laya.Event.CLOSE,this,this._closeHandler),this._socket.on(Laya.Event.ERROR,this,this._errorHandler),this._msgId=0,this._waitSendRequests=new Array,this._sendingRequest=null}static getInstance(){return Y.instance?Y.instance:Y.instance=new Y}init(t){this._protoManager=z.getInstance(),this._protoManager.init(t)}initFinish(){for(this._initFinished=!0,console.debug("==== init web socket finish!!!");this._waitInitHandlers.length>0;){let t=this._waitInitHandlers.shift();null!=t&&(console.debug("==== waiting init handler run: "),console.debug(t),t.run())}}login(t,e,i){if(this._initFinished)console.debug("========= login ========="),this._rid=e.rid,this._socket.connectByUrl(t),this._loginHandler=i,this._loginUrl=t;else{console.debug("not finished, register login handler");var n=new Array(t,e,i);this._waitInitHandlers.push(Laya.Handler.create(this,this.login,n))}}reconnect(t){this._rid&&this._aesKey&&this._loginUrl?(console.debug("========= reconnect ========="),this._socket.connectByUrl(this._loginUrl),this._reconnecting=!0,this._reconnectedHandler=t):console.log("rid or loginUrl or aesKey not init")}logout(){this._connectReady=!1,this._heartTimer.clear(this,this._onHeartBeat),this._socket.cleanSocket(),this._socket.close(),this._clearNetStatus(),t.getInstance().postEvent("LOGOUT")}sendRequest(t,e,i){if(this._initFinished){if(this._reconnecting){var n=new Array;return n[0]=m.NetError,void i.runWith(n)}if(this._connectReady){var a=new J(t,e,i);null!=this._sendingRequest?(console.log("----- current sending msg: "+this._msgId+", requestName: "+t),console.log(this._sendingRequest),this._waitSendRequests.push(a),console.log(this._waitSendRequests)):this._oncePopReq(a)}else{i=Laya.Handler.create(this,this.sendRequest,Array.from(arguments));this.reconnect(i)}}else{console.debug("not finished, register send request handler");var s=new Array(t,e,i);this._waitInitHandlers.push(Laya.Handler.create(this,this.sendRequest,s))}}_oncePopReq(t){console.debug("===== send request ===== "+t.getRequestName());let e=t.getRequestName(),i=t.getParam();t.getHandler();var n=this._protoManager.getOpcode(e),a=this._protoManager.encodeRequest(e,i),s=new Laya.Byte;s.endian=Laya.Socket.BIG_ENDIAN,s.writeByte(Y.RequestData),this._msgId++,s.writeInt32(this._msgId),s.writeInt32(n);var r=j.stringToByte(this._rid);s.writeByte(r.length),s.writeArrayBuffer(r,0,r.length),s.writeInt32(a.length),s.writeArrayBuffer(a,0,a.length);var o=j.aesEncrypt(s.buffer,this._aesKey),l=new Laya.Byte;l.endian=Laya.Socket.BIG_ENDIAN,l.writeByte(Y.DataMsg),l.writeInt32(o.byteLength),l.writeArrayBuffer(o,0,o.byteLength),t.setBuffer(l.buffer),this._sendingRequest=t,Laya.timer.once(1e4,this,this._reqTimeout),this._socket.send(l.buffer)}_reqTimeout(){console.log("........ req timeout ......."),null!=this._sendingRequest&&null!=this._sendingRequest.getBuffer()&&(this._socket.send(this._sendingRequest.getBuffer()),Laya.timer.once(1e4,this,this._reqTimeout))}_openHandler(t){if(this._rid)if(this._reconnecting){(r=new Laya.Byte).endian=Laya.Socket.BIG_ENDIAN;var e=j.stringToByte(this._rid);r.writeByte(e.length),r.writeArrayBuffer(e,0,e.length);var i=j.paddingBytesTo16Times(e),n=j.createRandom16Bytes(),a=CryptoJS.AES.encrypt(j.Int8parse(i),this._aesKey,{iv:CryptoJS.lib.WordArray.create(n,16),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.NoPadding}),s=j.base64ToBytes(a.toString());r.writeArrayBuffer(n,0,n.length),r.writeInt32(e.length),r.writeArrayBuffer(s,0,s.length),(o=new Laya.Byte).endian=Laya.Socket.BIG_ENDIAN,o.writeByte(Y.ReconnectMsg),o.writeInt32(r.buffer.byteLength),o.writeArrayBuffer(r.buffer,0,r.buffer.byteLength),this._socket.send(o.buffer),this._socket.flush(),this._connectReady=!0,console.log("reconnect success")}else{var r;(r=new Laya.Byte).endian=Laya.Socket.BIG_ENDIAN;e=j.stringToByte(this._rid);r.writeByte(e.length),r.writeArrayBuffer(e,0,e.length),this._rsaKey=new JSEncrypt,this._rsaDataLength=this._rsaKey.getKey().n.bitLength()+7>>3;var o,l=j.base64ToBytes(this._rsaKey.getPublicKeyB64());r.writeInt16(l.length),r.writeArrayBuffer(l,0,l.length),(o=new Laya.Byte).endian=Laya.Socket.BIG_ENDIAN,o.writeByte(Y.ConnectMsg),o.writeInt32(r.buffer.byteLength),o.writeArrayBuffer(r.buffer,0,r.buffer.byteLength),this._socket.send(o.buffer),this._socket.flush(),this._connectReady=!0}else console.debug("Not have rid")}_receiveHandler(t){var e=new Laya.Byte;e.writeArrayBuffer(t),e.pos=0,e.endian=Laya.Socket.BIG_ENDIAN;var i=e.getByte(),n=e.getInt32(),a=e.readArrayBuffer(n);switch(i){case Y.EstablishMsg:console.debug("连接成功"),this._heartTimer.clear(this,this._onHeartBeat),this._heartTimer.loop(1e4,this,this._onHeartBeat);var s=this._rsaKey.decrypt(j.byteToBase64String(new Int8Array(a))),r=new Laya.Byte(j.rsaIntToBytes(s,this._rsaDataLength));r.endian=Laya.Socket.BIG_ENDIAN;var o=r.getInt16(),l=r.readArrayBuffer(o);this._aesKey=j.Int8parse(new Int8Array(l)),this._reconnecting?(this._reconnecting=!1,null!=this._reconnectedHandler&&this._reconnectedHandler.run()):this.sendRequest("Player.LoginReq",{rid:this._rid},this._loginHandler);break;case Y.DataMsg:var h=new Laya.Byte(a);h.endian=Laya.Socket.BIG_ENDIAN;var c=h.getUint32(),d=h.readInt32(),g=h.readArrayBuffer(16),u=h.readArrayBuffer(n-4-4-16),y=new Laya.Byte(j.aesDecrypt(c,d,g,u,this._aesKey));y.endian=Laya.Socket.BIG_ENDIAN;var p=y.getByte();if(p==Y.ResponseData){var f=y.readInt32(),I=y.readInt32(),m=y.readInt32();R.updateServerTime(4294967296*I+m);var C=y.readInt32(),B=y.readInt32(),L=new Uint8Array(y.readArrayBuffer(B));this._handlerResponse(f,L,C)}else if(p==Y.NotifyData){var _=y.readInt32();B=y.readInt32(),L=new Uint8Array(y.readArrayBuffer(B));this._handlerNotify(_,L)}else console.debug("error msg type: "+p)}}_closeHandler(t){console.log("------ socket close ------"),this._connectReady&&(this._connectReady=!1,this.reconnect(null),this._heartTimer.clear(this,this._onHeartBeat))}_errorHandler(e){console.log("------- socket error ------"),this._connectReady=!1,this._reconnecting&&(t.getInstance().postEvent("NETWORD_DISCONNECT"),console.log("===== network disconnect ====="),this._clearNetStatus())}_clearNetStatus(){console.log("===== clear net status ======"),this._aesKey=null,this._rsaKey=null,this._connectReady=!1,this._loginUrl=null,this._reconnecting=!1,this._rid=null,this._msgId=0,this._sendingRequest=null}_onHeartBeat(){if(console.log("------- heart beat -------"),this._connectReady){var t=new Laya.Byte;t.endian=Laya.Byte.BIG_ENDIAN,t.writeByte(Y.HeartbeatMsg),t.writeInt32(0),this._socket.send(t.buffer),this._socket.flush()}else this.reconnect(null),this._heartTimer.clear(this,this._onHeartBeat)}_handlerResponse(t,e,i){if(this._msgId==t&&null!=this._sendingRequest){var n=this._protoManager.getOpcode(this._sendingRequest.getRequestName()),a=new Array;a[0]=i,0==a[0]?a[1]=this._protoManager.decodeResponse(n,e):a[1]={},this._sendingRequest.getHandler().runWith(a),this._sendingRequest=null,Laya.timer.clear(this,this._reqTimeout),this._waitSendRequests.length>0&&this._oncePopReq(this._waitSendRequests.shift())}else console.error("!!!!! msgId wrong or sending request is null: "+t),console.error(this._msgId),console.error(this._sendingRequest)}_handlerNotify(t,e){var i=this._protoManager.decodeNotify(t,e);console.debug(i),this._protoManager.handlerNotify(t,i)}}Y.ConnectMsg=33,Y.DataMsg=34,Y.HeartbeatMsg=35,Y.EstablishMsg=52,Y.ErrorMsg=53,Y.ReconnectMsg=65,Y.RequestData=1,Y.ResponseData=2,Y.NotifyData=3;let Z,Q="ws://49.232.18.82:40001",$="1";class tt{static init(t){Y.getInstance().init(Laya.Handler.create(null,function(){Y.getInstance().initFinish();const e=Array.from(arguments);t.runWith(e)}))}static sendRequest(t,e,i){Y.getInstance().sendRequest(t,e,Laya.Handler.create(null,function(){const t=Array.from(arguments);0!=t[0]?console.error("Error Number:"+t[0]):i.runWith(t.slice(1))}))}static login(t,e){Y.getInstance().login(Q,{rid:t+"_"+$},Laya.Handler.create(null,function(){const t=Array.from(arguments);0!=t[0]?console.error("Error Number:"+t[0]):e.runWith(t.slice(1))}))}static registerNotifyCallback(t,e,i,n){z.getInstance().registerNotifyCallback(t,e,i,n)}static logout(t){tt.sendRequest("Player.LogoutReq",{},t)}static onlineCrossDay(t){tt.sendRequest("Player.OnlineCrossDayReq",{},t)}static getAllBuilding(t){tt.sendRequest("Building.GetAllBuildingReq",{},t)}static putBuilding(t,e,i){tt.sendRequest("Building.PutBuildingReq",{buildingId:t,pos:e},i)}static removeBuilding(t,e){tt.sendRequest("Building.RemoveBuildingReq",{buildingId:t},e)}static addCat(t,e){tt.sendRequest("Cat.AddCatReq",{catId:t},e)}static getAllTasks(t){tt.sendRequest("Task.GetAllTasksReq",{},t)}static getDailyTaskReward(t,e){tt.sendRequest("Task.getDailyTaskRewardReq",{taskId:t},e)}static getTrophyTaskReward(t,e){tt.sendRequest("Task.getTrophyTaskRewardReq",{taskId:t},e)}static getPlayerFoodMenu(t){tt.sendRequest("Food.GetPlayerFoodMenuReq",{},t)}static foodLevelUp(t,e){tt.sendRequest("Food.FoodLevelUpReq",{foodListId:t},e)}static getLetterBoxInfo(t){tt.sendRequest("Scene.GetLetterBoxInfoReq",{},t)}static fetchLetterBox(t){tt.sendRequest("Scene.FetchLetterBoxReq",{},t)}static updateSceneInfo(t,e,i){tt.sendRequest("Scene.UpdateSceneInfoReq",{customData:t,rewards:e},i)}}class et{static init(){null==et.inited&&(et.inited=!0,t.getInstance().registEvent("NETWORD_DISCONNECT",null,et.restart),t.getInstance().registEvent("SERVICE_ONLINE_CROSSDAY",null,et.onlineCrossDay),t.getInstance().registEvent("SERVICE_PUT_BUILDING",null,et.putBuilding),t.getInstance().registEvent("SERVICE_ADD_CAT",null,et.addCat),t.getInstance().registEvent("SERVICE_RECEIVE_FISH",null,et.receiveFish),t.getInstance().registEvent("SERVICE_GET_ALLTASKS",null,et.getAllTasks),t.getInstance().registEvent("SERVICE_GET_TROPHY_TASK_REWARD",null,et.getTrophyTaskReward),t.getInstance().registEvent("SERVICE_GET_DAILY_TASK_REWARD",null,et.getDailyTaskReward),t.getInstance().registEvent("SERVICE_GET_PLAYER_FOOD_MENU",null,et.getPlayerFoodMenu),t.getInstance().registEvent("SERVICE_FOOD_LEVELUP",null,et.foodLevelUp),t.getInstance().registEvent("SERVICE_UPDATE_SCENE_INFO",null,et.updateSceneInfo),t.getInstance().registEvent("SERVICE_GET_LETTER_BOX_INFO",null,et.getLetterBoxInfo),t.getInstance().registEvent("SERVICE_FETCH_LETTER_BOX",null,et.fetchLetterBox),s.init(),y.init(),C.init(),U.init(),G.init(),K.init(),N.init())}static restart(){et.clear(),Laya.Browser.window.location.reload()}static clear(){s.clear(),y.clear(),U.clear()}static setRid(t){Z=t}static getRid(){return Z}static _updateBag(t){if(t){let e=t.items;Object.getOwnPropertyNames(e).forEach(function(t){let i=e[t],n=i.id,a=i.count;"FISH"==n?s.updateFish(a):"STAR"==n&&s.updateStar(a)})}}static _initBuilding(t){if(t){let e=t.buildings;Object.getOwnPropertyNames(e).forEach(function(t){let i=e[t],n=i.id,a=i.position;a?y.replaceBuildingData(n,a):y.addBuildingDataByBid(n)})}}static _updateBuilding(t){y.clear(),et._initBuilding(t)}static _initCats(t){if(t){let e=t.cats;e&&Object.getOwnPropertyNames(e).forEach(function(t){let i=e[t];i.id,i.intimacy})}}static _updateTasks(t){t&&G.updateTasks(t)}static _updateFoods(t){t&&U.updateFoods(t)}static _updateLetterBox(t){t&&N.updateLetterBox(t)}static _restoreCustomData(t){t&&N.restoreCustomData(t)}static _testNotify(){}static _reddotNotify(t){t&&t.type&&(t.type==m.RedDotType.kTask&&G.setDirty(1),K.refreshRedPoint(t.type))}static initService(t){et.init(),tt.init(t),tt.registerNotifyCallback(1001,null,et._testNotify),tt.registerNotifyCallback(1002,null,et._reddotNotify)}static login(t,e){tt.login(t,Laya.Handler.create(null,function(i){et.setRid(t);let n=i.bag,a=i.playerBuilding,s=i.tasks,r=i.menu,o=i.letterbox,l=i.customData;et._updateBag(n),et._initBuilding(a),et._initCats(i.playerCats),et._updateTasks(s),et._updateFoods(r),et._updateLetterBox(o),et._restoreCustomData(l),e&&e.runWith([i]),N.scheduleUpdate()}))}static onlineCrossDay(t){tt.onlineCrossDay(Laya.Handler.create(null,function(e){let i=e.bag,n=e.tasks;et._updateBag(i),et._updateTasks(n),t&&t.runWith([e])}))}static getAllBuilding(t){tt.getAllBuilding(Laya.Handler.create(null,function(e){let i=e.bag,n=e.playerBuilding;et._updateBag(i),et._updateBuilding(n),t&&t.runWith([e])}))}static getAllTasks(t){tt.getAllTasks(Laya.Handler.create(null,function(e){e&&et._updateTasks(e.tasks),t&&t.runWith([e])}))}static getPlayerFoodMenu(t){tt.getPlayerFoodMenu(Laya.Handler.create(null,function(e){e&&et._updateFoods(e.menu),t&&t.runWith([e])}))}static putBuilding(t,e,i){tt.putBuilding(t,e,Laya.Handler.create(null,function(t){let e=t.bag,n=t.letterbox;et._updateBag(e),et._updateLetterBox(n),i&&i.runWith([t])}))}static removeBuilding(t,e){tt.removeBuilding(t,Laya.Handler.create(null,function(t){let i=t.bag;et._updateBag(i),e&&e.runWith([t])}))}static addCat(t,e){}static getDailyTaskReward(t,e){tt.getDailyTaskReward(t,Laya.Handler.create(null,function(t){let i=t.tasks,n=t.bag;t.rewards;et._updateTasks(i),et._updateBag(n),e&&e.runWith([t])}))}static getTrophyTaskReward(t,e){tt.getTrophyTaskReward(t,Laya.Handler.create(null,function(t){let i=t.tasks,n=t.bag;t.rewards;et._updateTasks(i),et._updateBag(n),e&&e.runWith([t])}))}static foodLevelUp(t,e){tt.foodLevelUp(t,Laya.Handler.create(null,function(t){let i=t.menu,n=t.bag;et._updateFoods(i),et._updateBag(n),e&&e.runWith([t])}))}static getLetterBoxInfo(t){tt.getLetterBoxInfo(Laya.Handler.create(null,function(e){let i=e.letterbox;et._updateLetterBox(i),t&&t.runWith([e])}))}static fetchLetterBox(t){tt.fetchLetterBox(Laya.Handler.create(null,function(e){let i=e.bag,n=e.letterbox;et._updateBag(i),et._updateLetterBox(n),t&&t.runWith([e])}))}static updateSceneInfo(t,e,i){tt.updateSceneInfo(t,e,Laya.Handler.create(null,function(t){let e=t.bag,n=t.letterbox;et._updateBag(e),et._updateLetterBox(n),i&&i.runWith([t])}))}}class it extends Laya.Scene{constructor(){super(),this.sceneId=m.BeachSceneId,this.catMap=new Map,this.buildingMap=new Map}onAwake(){t.getInstance().registEvent("ADD_BUILDING",this,this.addBuilding),t.getInstance().registEvent("REMOVE_BUILDING",this,this.removeBuilding),t.getInstance().registEvent("PLACE_BUILDING",this,this.placeBuilding),this.root=this.getChildByName("root"),this.onBg(),this.onInitBuilding(),this.chooseLayer.on(Laya.Event.CLICK,this,this.onChooseLayerClick),F.PlacingBuilding&&this.placeBuilding(F.PlacingBuilding)}onBg(){this.bgAnim=new Laya.Skeleton,this.bgAnim.load("anim/skeleton.sk",Laya.Handler.create(this,function(){this.root.addChild(this.bgAnim),this.bgAnim.scaleX=1.2,this.bgAnim.scaleY=1.2,this.bgAnim.x=890,this.bgAnim.y=1200}))}onInitBuilding(){let t=y.getBuildingDataListInfo(this.sceneId).list;for(var e=0;e<t.length;++e){let i=t[e],n=i.getId();if(null==this.buildingMap.get(n)&&null!=i.getLocationData()){let t=M.getInstance().createBuilding(i,this.root,null);this.buildingMap.set(n,t)}}}onEnable(){}addBuilding(t){if(t.getBelongScene()==this.sceneId){let e=M.getInstance().createBuilding(t,this.root,null);this.buildingMap.set(t.getId(),e)}}removeBuilding(t){if(t.getBelongScene()==this.sceneId&&this.buildingMap.has(t.getId())){this.buildingMap.get(t.getId()).destroy(),this.buildingMap.delete(t.getId())}}placeBuilding(t){let e=y.getLocationsByBaseType(2),i=new Array;e.forEach(e=>{e.getBelongScene()==this.sceneId&&e.checkBuildingAvailable(t)&&i.push(e)}),i.length>0&&(F.PlacingBuilding=null,this.showLocationSelect(i,t))}getBuilding(t){for(var[e,i]of this.buildingMap)if(Number(e)==Number(t))return i;return null}showLocationSelect(t,e){this.chooseLayer.removeChildren(),this.chooseLayer.visible=!0,t.forEach(t=>{let i=M.createBuildingBaseSelector(t,this.chooseLayer,null);i.baseId=t.getId(),i.buildingId=e,i.on(Laya.Event.CLICK,this,this.onClick)})}onClick(t){let e=t.currentTarget.buildingId,i=t.currentTarget.baseId;y.placeBuilding(e,i),this.chooseLayer.visible=!1}onChooseLayerClick(){this.chooseLayer.visible=!1}}class nt extends Laya.Script{constructor(){super(),this.align=0}onStart(){if(this.owner)if(0==this.align){let t=Laya.Browser.height/2436,e=1827*t;this.owner.x=(Laya.Browser.width/2-e/2)/t}else 1==this.align&&this.owner.popup()}}class at extends Laya.Script{constructor(){super(),this.alignment=1,this.offsetX=0}onEnable(){let t=Laya.Browser.height/2436;1==this.alignment?this.owner.x=Laya.Browser.width/t+this.offsetX:2==this.alignment&&(this.owner.x=this.offsetX)}onDisable(){}}class st extends Laya.Script{constructor(){super()}onEnable(){this.leftBtn=this.owner.getChildByName("leftBtn"),this.rightBtn=this.owner.getChildByName("rightBtn");let t=u.getInstance().getCurrentSceneId();t==m.CoffeeSceneId?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):t==m.BeachSceneId&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1),this.leftBtn.on(Laya.Event.CLICK,this,function(){u.getInstance().switchScene(m.CoffeeSceneId)}),this.rightBtn.on(Laya.Event.CLICK,this,function(){u.getInstance().switchScene(m.BeachSceneId)})}onDisable(){}}class rt extends Laya.Script{constructor(){super(),this.guideAnim=null,t.getInstance().registEvent("NEXT_GUIDE",this,this.onNextGuide)}onAwake(){this.guideAnim=new Laya.Skeleton,this.guideAnim.load("anim/maozhua.sk",Laya.Handler.create(this,function(){this.guideAnim.x=406,this.guideAnim.y=2051,this.guideAnim.scaleX=.6,this.guideAnim.scaleY=.6,this.guideAnim.play("2",!0)})),this.owner.getChildByName("root").addChild(this.guideAnim)}onEnable(){}onNextGuide(){this.guideAnim.stop(),this.guideAnim.visible=!1}onDisable(){}}class ot extends Laya.Sprite{setCheckFunc(t){this.checkFunc=t}refreshRedPoint(t){if(this.checkFunc){let t=this.checkFunc();this.visible=!!t}}onStart(){this.visible=!1}}class lt extends Laya.Script{constructor(){super(),this.redPointType1=-1,this.redPointType2=null}onEnable(){-1!=this.redPointType1&&K.registerObject(this.redPointType1,this.owner),null!=this.redPointType2&&"null"!=this.redPointType2&&K.registerObject(this.redPointType2,this.owner)}onDisable(){-1!=this.redPointType1&&K.unregisterObject(this.redPointType1,this.owner),null!=this.redPointType2&&"null"!=this.redPointType2&&K.unregisterObject(this.redPointType2,this.owner)}}class ht extends Laya.Script{constructor(){super()}onEnable(){this.menu=this.owner.getChildByName("menu"),this.menu.on(Laya.Event.CLICK,this,this.onMenuClick),this.task=this.owner.getChildByName("task"),this.task.on(Laya.Event.CLICK,this,this.onTaskClick);let t=this.task.getChildByName("redPoint");t.setCheckFunc(G.hasCompletedTask),t.refreshRedPoint()}onTaskClick(){Laya.Dialog.open("ui/taskPop.scene")}onMenuClick(){Laya.Dialog.open("ui/menu.scene")}}class ct extends Laya.Scene{constructor(){super(),this.sceneId=m.CoffeeSceneId,this.catMap=new Map,this.buildingMap=new Map}onAwake(){t.getInstance().registEvent("ADD_COFFEE_CAT",this,this.addCat),t.getInstance().registEvent("REMOVE_COFFEE_CAT",this,this.removeCat),t.getInstance().registEvent("ADD_BUILDING",this,this.addBuilding),t.getInstance().registEvent("REMOVE_BUILDING",this,this.removeBuilding)}onInitBuilding(){let t=y.getBuildingDataListInfo(this.sceneId).list;for(var e=0;e<t.length;++e){let i=t[e],n=i.getId();if(null==this.buildingMap.get(n)&&null!=i.getLocationData()){let t=M.getInstance().createBuilding(i,this.root,null);this.buildingMap.set(n,t)}}}onEnable(){this.root=this.getChildByName("root"),this.onInitBuilding()}addCat(t){let e=t.getParams(),i=e.initPosition.x,n=e.initPosition.y;var a=E.getInstance().createCoffeeCat(t,this.root,null);a.pos(i,n),this.catMap.set(t.getCatId(),a)}removeCat(t){for(var[e,i]of this.catMap)if(Number(e)==Number(t)){this.catMap.get(t).destroy(),this.catMap.delete(t);break}}addBuilding(t){if(t.getBelongScene()==this.sceneId){let e=M.getInstance().createBuilding(t,this.root,null);this.buildingMap.set(t.getId(),e)}}removeBuilding(t){if(t.getBelongScene()==this.sceneId&&this.buildingMap.has(t.getId())){let e=this.buildingMap.get(t.getId());e.cleanBuilding(),this.buildingMap.delete(t.getId()),e.destroy()}}getBuilding(t){for(var[e,i]of this.buildingMap)if(Number(e)==Number(t))return i;return null}getBuildingRootInfoCount(){let t=0;for(var[e,i]of this.buildingMap)t+=i.getBuildingExtInfoMgr().getBuildingExtInfoCount();return t}getCatCount(){return this.catMap.size}getActiveCatCount(){let t=0;for(var[e,i]of this.catMap)i.getIsActive()&&t++;return t}}class dt extends Laya.Script{constructor(){super(),this.maxCount=10,this.count=this.maxCount}onAwake(){this.countLabel=this.owner.getChildByName("AddCatTxt")}onEnable(){this.countLabel.text=String(this.count),this.owner.on(Laya.Event.MOUSE_DOWN,this,function(){u.getInstance().getScene(m.CoffeeSceneId).getCatCount()>=15?t.getInstance().postEvent("SHOW_TIPS","场景内猫的数量达到上限15只"):(this.count--,0==this.count&&(this.count=this.maxCount,t.getInstance().postEvent("FORCE_ATTRACT_COFFEE_CAT")),this.countLabel.text=String(this.count))})}onDisable(){}}class gt extends Laya.Script{constructor(){super(),this.timer=new Laya.Timer}onEnable(){this.timer.loop(500,this,this.sortCatZOrder)}sortCatZOrder(){let t=new Array,e=new Array;function sortByOrder(t,e){return t.y>=e.y}this.owner.catMap.forEach((i,n)=>{i.zOrder>=999999?t.push(i):e.push(i)}),t.sort(sortByOrder),e.sort(sortByOrder);for(let e=0;e<t.length;++e)t[e].zOrder=999999+e;for(let t=0;t<e.length;++t)e[t].zOrder=50+t}onDisable(){}}class ut extends Laya.Scene{constructor(){super()}onAwake(){this.leftLimit=0,this.rightLimit=0,this.targetX=0,this.speed=0,this.velocity=-3.001,this.initSpeed=40,this.gameState=1,this.tickTimer=new Laya.Timer,this.root=this.getChildByName("root"),this.startBtn=this.root.getChildByName("start_btn"),this.startBtn.on(Laya.Event.CLICK,this,this.onClickStartGame),this.endBtn=this.root.getChildByName("end_btn"),this.endBtn.on(Laya.Event.CLICK,this,this.onClickEndGame),this.fishVernier=this.root.getChildByName("fish_vernier"),this.initLimit(),this.initAnims(),this.resetGame(),this.initData(),this.tickTimer.loop(30,this,this.onUpdate)}initAnims(){this.animCat=new Laya.Skeleton,this.root.addChild(this.animCat),this.animCat.load("anim/diaoyu.sk",Laya.Handler.create(this,function(){this.animCat.x=600,this.animCat.y=900,this.animCat.stop()}));let t=new Laya.Skeleton;t.load("anim/diaoyuchangjing.sk",Laya.Handler.create(this,function(){t.play("changjing",!0),t.x=600,t.y=1200})),this.root.addChild(t)}initData(){this.dataMap=new Map;let t=this.root.getChildByName("left_limit1").x,e=this.root.getChildByName("left_limit2").x,i=this.root.getChildByName("left_limit3").x,n=this.root.getChildByName("right_limit1").x,a=this.root.getChildByName("right_limit2").x,s=this.root.getChildByName("right_limit3").x,r=new Array;r.push({min:i,max:s}),this.dataMap.set(1,r);let o=new Array;o.push({min:e,max:i}),o.push({min:s,max:a}),this.dataMap.set(2,o);let l=new Array;l.push({min:t,max:e}),l.push({min:a,max:n}),this.dataMap.set(3,l);let h=new Array;h.push({min:n,max:99999}),h.push({min:-99999,max:t}),this.dataMap.set(4,h)}getResult(){let t=0,e=this.fishVernier.x;return this.dataMap.forEach((i,n)=>{for(let a=0;a<i.length;++a){let s=i[a];if(e<=s.max&&e>=s.min){t=n;break}}}),t}startGame(){this.resetGame(),this.gameState=1,this.startBtn.visible=!1,this.endBtn.visible=!0,this.animCat.visible=!0,this.targetX=this.rightLimit,this.animCat.play("diaoyu1",!0),(new Laya.Timer).once(1300,this,function(){this.animCat.play("diaoyu2",!0)}),this.tickTimer.resume()}onUpdate(){let t=l.getSign(this.targetX-this.fishVernier.x);this.fishVernier.x+=t*(this.speed+1e-4),this.fishVernier.x>this.rightLimit&&(this.fishVernier.x=this.rightLimit,this.targetX=this.leftLimit),this.fishVernier.x<this.leftLimit&&(this.fishVernier.x=this.leftLimit,this.targetX=this.rightLimit),2==this.gameState&&(this.speed+=this.velocity,this.speed<=0&&(this.gameState=3,this.tickTimer.pause(),this.animCat.play("diaoyu3",!0),(new Laya.Timer).once(900,this,function(){this.animCat.stop();let t=this.getResult();Laya.Dialog.open("ui/FishingDialog.scene",!1,{result:t,baits:l.randomExt(3)+1})})))}resetGame(){this.tickTimer.pause(),this.speed=this.initSpeed,this.gameState=0,this.fishVernier.x=this.leftLimit,this.targetX=this.rightLimit,this.startBtn.visible=!0,this.endBtn.visible=!1,this.animCat.visible=!1}initLimit(){let t=this.root.getChildByName("left_limit"),e=this.root.getChildByName("right_limit");this.leftLimit=t.x,this.rightLimit=e.x}onClickStartGame(){0==this.gameState&&this.startGame()}onClickEndGame(){this.gameState=2}onEnable(){this.resetGame()}onDisable(){this.resetGame()}}class yt extends Laya.Scene{constructor(){super(),this.sceneId=0}onEnable(){this.input=this.getChildByName("input"),this.getChildByName("loginButton").on(Laya.Event.CLICK,this,this.onLoginClick);let t=Laya.LocalStorage.getItem("user_rid");null!=t&&""!=t&&(this.input.text=t)}onLoginClick(){let e=this.input.text;e?(this.rid=e,et.login(e,Laya.Handler.create(this,this.onLogin))):t.getInstance().postEvent("SHOW_TIPS","请输入账号")}onLogin(){Laya.LocalStorage.setItem("user_rid",this.rid),u.getInstance().switchScene(m.CoffeeSceneId,Laya.Handler.create(this,function(t){u.getInstance().loadScene(m.BeachSceneId,Laya.Handler.create(this,function(t){t.visible=!1}))}))}}let pt=function(t,e,i){if(t%e==0)return String(t/e)+i;{let n=String(parseInt(10*t/e));return n.slice(0,-2)+"."+n.slice(-1)+i}};class ft{static get(t){let e=i.getInstance().getItemById("Translate",t);if(null!=e)return e.zh_CH}static short(t){return t<1e3?String(t):t<=1e6?pt(t,1e3,"k"):void 0}}class It extends Laya.Dialog{constructor(){super()}onOpened(t){let e=i.getInstance().getItemById("FishingBaits",String(t.baits)),n=i.getInstance().getItemById("FishingResult",String(t.result)),a=1;l.randomExt(100)<=n.specialRate&&(a=2);let s=new Map,r=new Array,o=e.normal;2==a&&(o=e.special);for(let t=0;t<o.length;++t){let e=o[t].split(":");s.set(e[1],Number(e[0]))}let h=0;s.forEach((t,e)=>{h+=Number(t),r.push({w:t,n:e})}),r.sort(function(t,e){return t.w<e.w});let c=l.randomExt(h),d={w:-1},g=null;for(let t=0;t<r.length;++t){let e=r[t];if(c>d.w&&c<e.w+d.w){g=e;break}d.w+=e.w}let u=g.n,y=i.getInstance().getItemById("FishingFishes",String(u)),p=this.getChildByName("fish_img");p.loadImage(y.img,Laya.Handler.create(this,function(){p.x-=p.width/2*p.scaleX,p.y-=p.height/2*p.scaleY}));let f=n.sizeIncrease[0],I=n.sizeIncrease[1],m=l.randomExt2(Number(100*f),Number(100*I))/100;Number(y.size),Math.floor(m*Number(y.size)*Number(y.sizeTimes));this.getChildByName("fish_size").text=String(y.size);let C=n.incomeIncrease[0],B=n.incomeIncrease[1],L=l.randomExt2(Number(100*C),Number(100*B))/100,_=Number(y.income)+Math.floor(L*Number(y.income)*Number(y.incomeTimes));this.getChildByName("fish_income").text=String("+")+String(_),this.getChildByName("name_text").text=ft.get(y.name)+":"}onEnable(){this.bgPanel=this.getChildByName("bg_panel"),this.bgPanel.alpha=.2,this.bgPanel.on(Laya.Event.CLICK,this,function(){this.close(),u.getInstance().switchScene(m.BeachSceneId)})}onDisable(){}}class mt extends Laya.Dialog{constructor(){super(),this.autoDestroyAtClosed=!0}onEnable(){let t=u.getInstance().getCurrentSceneId();for(let e=1;e<4;++e){let i=this.getChildByName("button_"+String(e));i.tag=e,i.on(Laya.Event.CLICK,this,this.onClickBtn),t==e&&this.moveSelect(i)}}moveSelect(t){this.select.y=t.y-10}onOpened(t){}onClickBtn(t){null!=u.getInstance().getSceneUrl(t.currentTarget.tag)&&(u.getInstance().switchScene(t.currentTarget.tag),this.moveSelect(t.currentTarget),this.close())}onDisable(){}}class Ct extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("bg").on(Laya.Event.CLICK,this,this.onCloseClick),this.getChildByName("confirm").on(Laya.Event.CLICK,this,this.onConfirmClick),this.showInfo(F.CurrentShopBuilding)}showInfo(t){if(null==t)return void this.close();let e=i.getInstance().getItemById("Building",t);null!=e?(this.title.text=ft.get(e.Name),this.desc1.text=ft.get(e.Desc1),this.desc2.text=ft.get(e.Desc2),this.star.text="+"+e.StarReward,this.cost.text=String(e.Cost),this.icon.skin=e.ShopItems,this.buildingId=t,y.checkBuyBuildingAvailable(t)||this.setGray()):this.close()}setGray(){this.confirm.gray=!0,this.confirm.disabled=!0}onOpened(t){}onCloseClick(){this.close()}onConfirmClick(){if(this.close(),Laya.Dialog.closeAll(),F.CurrentShopBuildingBase)F.CurrentShopBuildingBase.checkIsHigher(this.buildingId)?y.buyBuildingAndPlace(this.buildingId,F.CurrentShopBuildingBase.getId()):y.buyBuilding(this.buildingId,null);else{let e=this.buildingId;y.buyBuilding(this.buildingId,function(){F.PlacingBuilding=e,u.getInstance().switchScene(m.BeachSceneId),t.getInstance().postEvent("PLACE_BUILDING",e)})}}}class Bt extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("close").on(Laya.Event.CLICK,this,this.onCloseClick);let e=i.getInstance().getConfig("FoodsList"),n=new Array;e.forEach((t,e)=>{n.push(e)}),this.list.array=n,t.getInstance().registEvent("UPDATE_FOODS",this,this.updateFoods),this.getChildByName("facility").on(Laya.Event.CLICK,this,this.onFacilityClicked)}onDisable(){t.getInstance().removeEvent("UPDATE_FOODS",this,this.updateFoods)}updateFoods(){this.list.refresh()}onCloseClick(){this.close()}onFacilityClicked(){Laya.Dialog.open("ui/shopPop.scene");let t=this.getChildByName("facility");t.disabled=!0,t.gray=!1;let e=this.getChildByName("shipu");e.selected=!1,e.disabled=!1}}class Lt extends Laya.List{constructor(){super(),this.vScrollBarSkin="",this.renderHandler=Laya.Handler.create(this,this.updateItem,null,!1)}onSelect(t){}updateItem(t,e){t.setItem(t.dataSource)}}class _t extends Laya.Sprite{constructor(){super()}setItem(t){this.foodListId=t;let e=U.getCurFoodInList(t);this.getChildByName("title").text=ft.get(e.getName()),this.getChildByName("icon").texture=e.getShopItems();let i=this.getChildByName("upIcon");if(i.visible=!1,this.setGray(!1),e.isLocked())this.setGray(!0),this.on(Laya.Event.CLICK,this,this.showLevelUp);else{U.getFoodList(t)[e.getLevel()]?(i.visible=!0,this.on(Laya.Event.CLICK,this,this.showLevelUp)):this.off(Laya.Event.CLICK,this,this.showLevelUp)}}setGray(t){if(t){this.getChildByName("icon").gray=!0,this.getChildByName("item").gray=!0}else{this.getChildByName("icon").gray=!1,this.getChildByName("item").gray=!1}}showLevelUp(){F.CurrentFoodListId=this.foodListId,Laya.Dialog.open("ui/foodLevelUpPop.scene",!1)}}class St extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("bg").on(Laya.Event.CLICK,this,this.onCloseClick),this.getChildByName("confirm").on(Laya.Event.CLICK,this,this.onConfirmClick),this.showInfo(F.CurrentFoodListId)}showInfo(t){if(null==t)return void this.close();let e=U.getNextLevelUpFoodInList(t);null!=e?(this.title.text=ft.get(e.getName()),this.desc1.text=ft.get(e.getDesc1()),this.time.text=e.getCookingTime()+"s",this.star.text=String(e.getLimit()),this.fish.text="+"+e.getIncome(),this.cost.text=String(e.getCost()),this.icon.skin=e.getShopItems(),this.foodListId=t,this.setGray(U.checkLevelUpUnAvailable(t))):this.close()}setGray(t){t?(this.confirm.gray=!0,this.confirm.disabled=!0,this.reason.visible=!0,this.reason.text=t,this.reason.x=563.5-this.reason.width/2):(this.confirm.gray=!1,this.confirm.disabled=!1,this.reason.visible=!1)}onOpened(t){}onCloseClick(){this.close()}onConfirmClick(){this.close(),Laya.Dialog.closeAll();let t=this.foodListId;U.foodLevelUp(t)}}class Et extends Laya.Dialog{constructor(){super(),this.autoDestroyAtClosed=!0}onEnable(){this.getChildByName("shopMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onShopClick),this.getChildByName("sceneMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onSceneMenuClick),this.getChildByName("cookbookMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onCookBookMenuClick),this.getChildByName("illustrationMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onIllustrationMenuClick),this.getChildByName("shareMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onShareMenuClick),this.getChildByName("photoMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onPhotoMenuClick),this.getChildByName("settingMenu").getChildByName("menu").on(Laya.Event.CLICK,this,this.onSettingMenuClick)}onCloseClick(){this.close()}onShopClick(){Laya.Dialog.open("ui/shopPop.scene")}onSceneMenuClick(){Laya.Dialog.open("ui/SceneSelectDlg.scene",!0,1)}onCookBookMenuClick(){Laya.Dialog.open("ui/cookbookPop.scene")}onIllustrationMenuClick(){t.getInstance().postEvent("SHOW_TIPS","图鉴还未开放")}onShareMenuClick(){t.getInstance().postEvent("SHOW_TIPS","分享还未开放")}onPhotoMenuClick(){t.getInstance().postEvent("SHOW_TIPS","相机还未开放")}onSettingMenuClick(){t.getInstance().postEvent("SHOW_TIPS","设置还未开放")}_onBufferLoaded(t,e){}}class bt extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("bg").on(Laya.Event.CLICK,this,this.onCloseClick),this.getChildByName("confirm").on(Laya.Event.CLICK,this,this.onConfirmClick),this.showInfo(F.CurrentShopBuilding)}showInfo(t){if(null==t)return void this.close();let e=i.getInstance().getItemById("Building",t);if(null!=e){if(this.title.text=ft.get(e.Name),this.desc1.text=ft.get(e.Desc1),this.desc2.text=ft.get(e.Desc2),this.star.text="+"+e.StarReward,this.icon.skin=e.ShopItems,this.buildingId=t,F.CurrentShopBuildingBase&&F.CurrentShopBuildingBase.getBuildingId()==this.buildingId){this.cost="已放置";let t=this.getChildByName("confirm");t.disabled=!0,t.gray=!1}}else this.close()}setGray(){this.confirm.gray=!0,this.confirm.disabled=!0}onOpened(t){}onCloseClick(){this.close()}onConfirmClick(){this.close(),Laya.Dialog.closeAll(),F.CurrentShopBuildingBase?y.placeBuilding(this.buildingId,F.CurrentShopBuildingBase.getId()):(F.PlacingBuilding=this.buildingId,u.getInstance().switchScene(m.BeachSceneId),t.getInstance().postEvent("PLACE_BUILDING",this.buildingId))}}class wt extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("close").on(Laya.Event.CLICK,this,this.onCloseClick);let t=this.getChildByName("facilityButton");t.on(Laya.Event.CLICK,this,this.onFacilityClicked);let e=this.getChildByName("componentButton");e.on(Laya.Event.CLICK,this,this.onComponentClicked),1==u.getInstance().getCurrentSceneId()?(this.list.setListType(1),e.disabled=!0,e.gray=!1,e.selected=!0,t.selected=!1,t.disabled=!1):(this.list.setListType(2),t.disabled=!0,t.gray=!1,t.selected=!0,e.selected=!1,e.disabled=!1),this.getChildByName("shipu").on(Laya.Event.CLICK,this,this.onCookBookClicked)}onCloseClick(){this.close()}onComponentClicked(){let t=this.getChildByName("facilityButton");t.selected=!1,t.disabled=!1;let e=this.getChildByName("componentButton");e.disabled=!0,e.gray=!1,this.list.setListType(1)}onFacilityClicked(){let t=this.getChildByName("facilityButton");t.disabled=!0,t.gray=!1;let e=this.getChildByName("componentButton");e.selected=!1,e.disabled=!1,this.list.setListType(2)}onCookBookClicked(){Laya.Dialog.open("ui/cookbookPop.scene");let t=this.getChildByName("shipu");t.disabled=!0,t.gray=!1;let e=this.getChildByName("facility");e.selected=!1,e.disabled=!1}}class vt extends Laya.List{constructor(){super(),this.repeatX=1,this._type=0,this.renderHandler=Laya.Handler.create(this,this.updateItem,null,!1),Laya.loader.load("prefab/ui/CommonComponentItem.json",Laya.Handler.create(this,this.onPrefabLoaded),null,Laya.Loader.JSON)}onEnable(){this.scrollBar.sizeGrid="8,6,8,6,0"}setListType(t){if(this._itemRender1||(this._itemRender1=this.itemRender),this._type!=t)if(this._type=t,1==t){this.x=454,this.repeatX=1,this.array=null,this.itemRender=this._itemRender1;let t=y.getLocationsByBaseType(1);this.array=t}else this._itemRender2&&(this.array=null,this.itemRender=this._itemRender2,this.setCommonComponentData())}setCommonComponentData(){this.x=454,this.repeatX=3;let t=y.getLocationsByBaseType(2),e=new Array;t.forEach(t=>{e=e.concat(t.getFixedBuildings())});let i=Array.from(new Set(e));this.array=i}onPrefabLoaded(t){let e=new Laya.Prefab;e.json=t,this._prefab=e,this._itemRender2=function(){return Laya.Pool.getItemByCreateFun("CommonComponentItem",e.create,e)},2==this._type&&(this.array=null,this.itemRender=this._itemRender2,this.setCommonComponentData())}onSelect(t){}updateItem(t,e){t.setItem(t.dataSource)}}class Tt extends Laya.Box{constructor(){super()}setItem(t){this.location=t,this.getChildByName("title").text=ft.get(t.getListName()),Laya.loader.load("prefab/ui/SceneComponentItem.json",Laya.Handler.create(this,this.onPrefabLoaded),null,Laya.Loader.JSON)}onPrefabLoaded(t){let e=new Laya.Prefab;e.json=t;let i=10;this.location.getFixedBuildings().forEach(t=>{let n=Laya.Pool.getItemByCreateFun("SceneComponentItem",e.create,e);n.x=i,n.y=145,i+=300,n.setBuildingId(t,this.location),this.addChild(n)})}}class kt extends Laya.Dialog{constructor(){super()}onEnable(){this.getChildByName("close").on(Laya.Event.CLICK,this,this.onCloseClick);let e=this.getChildByName("achievementBtn");e.on(Laya.Event.CLICK,this,this.onAchievementClicked);let i=e.getChildByName("redPoint");i.setCheckFunc(G.hasCompletedTrophyTask),i.refreshRedPoint();let n=this.getChildByName("dailyBtn");n.on(Laya.Event.CLICK,this,this.onDailyClicked);let a=n.getChildByName("redPoint");a.setCheckFunc(G.hasCompletedDailyTask),a.refreshRedPoint(),this.onTaskRefresh(),G.getAllTasks(Laya.Handler.create(this,this.onTaskRefresh)),t.getInstance().registEvent("UPDATE_TASKS",this,this.updateTasks)}onDisable(){t.getInstance().removeEvent("UPDATE_TASKS",this,this.updateTasks)}onTaskRefresh(){let t=this.getChildByName("achievementBtn"),e=this.getChildByName("dailyBtn");G.hasCompletedDailyTask()?(e.selected=!0,this.onDailyClicked()):G.hasCompletedTrophyTask()?(t.selected=!0,this.onAchievementClicked()):(e.selected=!0,this.onDailyClicked())}updateTasks(){this.list.refresh()}onCloseClick(){this.close()}onDailyClicked(){let t=this.getChildByName("achievementBtn");t.selected=!1,t.disabled=!1;let e=this.getChildByName("dailyBtn");e.disabled=!0,e.gray=!1;let n=i.getInstance().getConfig("TaskList"),a=new Array;n.forEach((t,e)=>{t.TaskType==m.TaskType.kDaily&&a.push(e)}),a.sort(function(t,e){return n.get(t).Order-n.get(e).Order}),this.list.array=a}onAchievementClicked(){let t=this.getChildByName("achievementBtn");t.disabled=!0,t.gray=!1;let e=this.getChildByName("dailyBtn");e.selected=!1,e.disabled=!1;let n=i.getInstance().getConfig("TaskList"),a=new Array;n.forEach((t,e)=>{t.TaskType==m.TaskType.kTrophy&&a.push(e)}),a.sort(function(t,e){return n.get(t).Order-n.get(e).Order}),this.list.array=a}}class xt extends Laya.Sprite{constructor(){super()}onEnable(){this.getChildByName("receive").on(Laya.Event.CLICK,this,this.receive)}setItem(t){this.taskListId=t;let e=G.getCurrentTask(t);this.taskId=e.getId(),this.getChildByName("title").text=ft.get(e.getName()),this.getChildByName("desc").title=ft.get(e.getDesc()),this.getChildByName("bar").value=e.getCurrent()/e.getTarget();let i=this.getChildByName("progress");i.text=ft.short(e.getCurrent())+"/"+ft.short(e.getTarget());let n=this.getChildByName("reward");n.text="+"+ft.short(e.getReward());let a=this.getChildByName("rewardIcon");"FISH"==e.getRewardType()?a.texture="topui/yugan.png":a.texture="topui/xingxing.png",i.x=460-(i.width>50?i.width/2:i.width/2+7),n.x=545,a.x=491,n.x+n.width>642&&(n.x=642-n.width,a.x=491+n.x-545);let s=this.getChildByName("received"),r=this.getChildByName("receive");this.getChildByName("progressing").visible=e.getStatus()==m.TaskStatus.kRunning,s.visible=e.getStatus()==m.TaskStatus.kRewarded,r.visible=e.getStatus()==m.TaskStatus.kCompleted}receive(){i.getInstance().getItemById("TaskList",this.taskListId).TaskType==m.TaskType.kDaily?G.getDailyTaskReward(this.taskId):G.getTrophyTaskReward(this.taskId)}}class At extends Laya.Sprite{constructor(){super()}setItem(t){this.setBuildingId(t,null)}setBuildingId(t,e){if(null==t)return;let n=i.getInstance().getItemById("Building",t);if(null==n)return;this.buildingId=t,this.location=e,this.item=this.getChildByName("item"),this.getChildByName("title").text=ft.get(n.Name);let a=this.getChildByName("icon");n.ShopItems.substr(n.ShopItems.lastIndexOf(".")-1,1);if(a.skin=n.ShopItems,y.checkBuildingUnlocked(t))if(y.hasBuildingDataByBid(t)){let i=y.getBuildingDataByBid(t);e&&i.getLocationData(),this.on(Laya.Event.CLICK,this,this.showPlacePop)}else this.on(Laya.Event.CLICK,this,this.showBuyPop);else this.on(Laya.Event.CLICK,this,this.showUnlock,[n.Limit])}disable(){this.getChildByName("icon");this.disabled=!0}showUnlock(e){t.getInstance().postEvent("SHOW_TIPS","需要"+e+"星星才能解锁")}showBuyPop(){1!=this.disabled&&(F.CurrentShopBuildingBase=this.location,F.CurrentShopBuilding=this.buildingId,Laya.Dialog.open("ui/confirmPop.scene",!1))}showPlacePop(){1!=this.disabled&&(F.CurrentShopBuildingBase=this.location,F.CurrentShopBuilding=this.buildingId,Laya.Dialog.open("ui/placePop.scene",!1))}}class Dt{static init(){let t=Laya.ClassUtils.regClass;t("scene/BeachScene.js",it),t("core/component/ViewAdjust.js",nt),t("core/component/ViewAlignment.js",at),t("form/TopUI.js",r),t("form/ArrowUI.js",st),t("guide/Guide.js",rt),t("form/RedPoint.js",ot),t("form/RedPointType.js",lt),t("form/BottomUI.js",ht),t("scene/CoffeeScene.js",ct),t("building/CoffeeAttractCatLogic.js",k),t("form/ClickAddCatBtn.js",dt),t("cat/CatZorderLogic.js",gt),t("scene/FishingScene.js",ut),t("scene/LoginScene.js",yt),t("form/FishingDialog.js",It),t("form/SceneSelectDlg.js",mt),t("form/ConfirmPop.js",Ct),t("form/CookBookPop.js",Bt),t("form/CommonList.js",Lt),t("form/CookBookItem.js",_t),t("form/FoodLevelUpPop.js",St),t("form/Menu.js",Et),t("form/PlacePop.js",bt),t("form/ShopPop.js",wt),t("form/ShopList.js",vt),t("form/ShopItem.js",Tt),t("form/TaskPop.js",kt),t("form/TaskItem.js",xt),t("form/BuildingItem.js",At)}}Dt.width=1827,Dt.height=2436,Dt.scaleMode="fixedheight",Dt.screenMode="vertical",Dt.alignV="middle",Dt.alignH="center",Dt.startScene="scene/CoffeeScene.scene",Dt.sceneRoot="",Dt.debug=!1,Dt.stat=!1,Dt.physicsDebug=!0,Dt.exportSceneToJson=!0,Dt.init();class Rt{constructor(){this.configs=null,this.configIndex=0}static getInstance(){return Rt.instance?Rt.instance:Rt.instance=new Rt}reset(){this.configs=new Array("Const","ActionEvent","Role","BuildingBase","Building","Scene","Translate","Foods","FoodsList","Task","TaskList","FishingBaits","FishingFishes","FishingResult"),this.configIndex=0}loadConfig(t){if(this.configIndex<this.configs.length){let e=this.configs[this.configIndex];i.getInstance().loadConfig(e,Laya.Handler.create(this,function(){++this.configIndex,this.loadConfig(t)}))}else null!=t&&t.run()}start(t){this.reset(),this.loadConfig(new Laya.Handler(this,function(){I.getInstance().load(),null!=t&&t.run()}))}}new class{constructor(){window.Laya3D?Laya3D.init(Dt.width,Dt.height):Laya.init(Dt.width,Dt.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=Dt.scaleMode,Laya.stage.screenMode=Dt.screenMode,Laya.stage.alignV=Dt.alignV,Laya.stage.alignH=Dt.alignH,Laya.stage.frameRate="slow",Laya.URL.exportSceneToJson=Dt.exportSceneToJson,(Dt.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),Dt.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),Dt.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),et.initService(Laya.Handler.create(this,this.onProtoInit)),t.getInstance().registEvent("SHOW_TIPS",this,this._showDefaultTip)}onProtoInit(){}onLogin(t){}onItem(t){}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){Rt.getInstance().start(new Laya.Handler(this,function(){u.getInstance().switchScene(m.LoginSceneId,Laya.Handler.create(this,function(t){}))}))}_initTip(){1!=this._tipInited&&(this.offsetX=0,this._tipInited=!0,this.tipBackColor="#ffffff",this.tipDelay=2e3,this._tipBox=new Laya.UIComponent,this._tipBox.addChild(this._tipText=new Laya.Text),this._tipText.fontSize=40,this._tipText.x=this._tipText.y=5,Laya.ILaya.stage.addChild(this._tipBox),this._tipBox.zOrder=1e4)}_showDefaultTip(t){this._initTip(),Laya.ILaya.timer.clear(this,this._hideTip),this._tipText.text=t;let e=this._tipBox.graphics;e.clear(!0),e.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,this.tipBackColor),this._tipBox.visible=!0,this._showToStage(this._tipBox,50,-100),Laya.ILaya.timer.once(this.tipDelay,this,this._hideTip,[],!0)}_showToStage(t,e=0,i=0){let n=t.getBounds();t.x=Laya.ILaya.stage.mouseX+e+this.offsetX,t.y=Laya.ILaya.stage.mouseY+i,t.x+n.width>Laya.ILaya.stage.width&&(t.x-=n.width+e),t.y+n.height>Laya.ILaya.stage.height&&(t.y-=n.height+i)}_hideTip(){this._tipBox.visible=!1,Laya.ILaya.timer.clear(this,this._hideTip)}}}();